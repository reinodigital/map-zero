import{a as k}from"./chunk-YAGYQ226.js";import{a as C}from"./chunk-7H4JIEJ2.js";import{w as I}from"./chunk-UYDUL6F7.js";import{a as A}from"./chunk-QULINWIQ.js";import{A as d,D as v,E as f,J as S,d as h}from"./chunk-GCLW45SM.js";import{X as p,Ya as g,ba as n,j as l,wa as b}from"./chunk-QAVPLLNK.js";var y=class o{dialog=n(I);quoteService=n(S);customToastService=n(A);_statusChange$=new l;statusChange$=this._statusChange$.asObservable();isSendEmailFromDetailComponentSubmitting=b(!1);calculateTotalsOnDetail(e){let{subtotal:t,discounts:a,iva:s}=e.reduce((r,i)=>{let c=i.quantity*i.price,m=i.quantity*(i.price*i.discount/100),E=(c-m)*(v(i.taxRate??"08")/100);return{subtotal:r.subtotal+c,discounts:r.discounts+m,iva:r.iva+E}},{subtotal:0,discounts:0,iva:0}),u=t-a+s;return{iva:s,discounts:a,subtotal:t,total:u}}getTaxRateLabel(e){return f(e)}getStatusBadgeFromQuote(e){let t="badge bg-label-light";switch(e){case"borrador":t="badge bg-label-light";break;case"enviada":t="badge bg-label-primary";break;case"aceptada":t="badge bg-label-success";break;case"rechazada":t="badge bg-label-danger";break;case"facturada":t="badge bg-label-warning";break;case"removida":t="badge bg-label-removed";break;default:break}return t}displayModalQuoteEmail(e){let t={clientName:e.client.name,currency:e.currency,terms:e.terms,total:e.total},a=this.dialog.open(k,{width:"70rem",autoFocus:!1,data:t});a.updatePosition({top:"100px"}),a.afterClosed().subscribe(s=>{if(s){this.isSendEmailFromDetailComponentSubmitting.set(!0);let u=JSON.parse(s);this.quoteService.sendEmail(e.id,u).subscribe(r=>this.processResponse(r))}})}markAsSent(e){this.quoteService.markAsSent(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}markAsAccepted(e){this.quoteService.markAsAccepted(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}markAsDeclined(e){this.quoteService.markAsDeclined(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}markAsInvoiced(e){this.quoteService.markAsInvoiced(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}undoMarkAsAccepted(e){this.quoteService.undoMarkAsAccepted(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}undoMarkAsDeclined(e){this.quoteService.undoMarkAsDeclined(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}undoMarkAsInvoiced(e){this.quoteService.undoMarkAsInvoiced(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}generateUpdatedAtProperty(){return{updatedAt:d(new Date)}}processResponse(e){e&&e.msg?(this.customToastService.add({message:e.msg,type:"success",duration:5e3}),this._statusChange$.next()):this.customToastService.add({message:e.message,type:"error",duration:5e3}),this.isSendEmailFromDetailComponentSubmitting.set(!1)}removeQuote(e){let t=this.dialog.open(C,{width:"60rem",height:"20rem",autoFocus:!1,data:`Est\xE1s seguro/a de que deseas eliminar esta cotizaci\xF3n ${e.quoteNumber} ?`});t.updatePosition({top:"100px"}),t.afterClosed().subscribe(a=>{a&&this.quoteService.removeOne(e.id,d(new Date)).subscribe(s=>this.processResponse(s))})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};var D=class o{transform(e,t="d MMMM y",a="en-US"){return e?h(e,t,a,"UTC"):null}static \u0275fac=function(t){return new(t||o)};static \u0275pipe=g({name:"readableDate",type:o,pure:!0})};export{y as a,D as b};
