import{a as o}from"./chunk-LKCBMVWP.js";import{w as T}from"./chunk-G7SYGITX.js";import{a as f}from"./chunk-IETRKHQE.js";import{e as b,p as S,w as E}from"./chunk-RV3QXS3Q.js";import{X as p,ba as m,wa as r}from"./chunk-BXSYLYWC.js";var A=class l{router=m(b);dialog=m(T);customToastService=m(f);invoiceService=m(E);isFormSubmitting=r(!1);isFormInvoiceAndEmailSubmitting=r(!1);saveAction="save";sendAction="send";markAsSentAction="mark_as_sent";editAction="edit";editAndSendAction="edit_and_send";subtotal=r(0);totalDiscount=r(0);totalTax=r(0);totalAmount=r(0);cleanTotalValues(){this.subtotal.set(0),this.totalDiscount.set(0),this.totalTax.set(0),this.totalAmount.set(0)}calculateTotals(e){let t=e.controls.reduce((c,n)=>{let u=n.get("quantity")?.value||0,s=n.get("price")?.value||0;return c+u*o(s)},0),i=e.controls.reduce((c,n)=>{let u=n.get("quantity")?.value||0,s=n.get("price")?.value||0,v=o(s),I=n.get("discount")?.value||0,g=u*v*I/100;return c+g},0),a=o(t)-o(i),d=0;e.controls.forEach(c=>{let n=c.get("quantity")?.value||0,u=c.get("price")?.value||0,s=o(u),v=c.get("discount")?.value||0,I=n*s*v/100,g=c.get("taxRate")?.value||"08",D=n*s-I;d+=D*S(g)/100}),this.subtotal.set(o(t)),this.totalDiscount.set(o(i)),this.totalTax.set(o(d)),this.totalAmount.set(o(a+d))}verifyInvoiceItems(e){return e.controls.every(t=>this.isInvoiceItemValid(t))}isInvoiceItemValid(e){let t=e.get("quantity")?.value,i=e.get("price")?.value,a=e.get("itemId")?.value;return t>=1&&i>0&&!!a}onSaveAction(e){this.isFormSubmitting.set(!0),this.invoiceService.create(e).subscribe(t=>{t&&t.id?(this.customToastService.add({message:`Factura generada con estado ${t.status} correctamente.`,type:"success",duration:5e3}),this.router.navigateByUrl(`/detail-invoice/${t.id}`)):this.customToastService.add({message:t.message,type:"error",duration:5e3}),this.isFormSubmitting.set(!1)})}onEditAction(e,t){this.isFormSubmitting.set(!0),this.invoiceService.update(e,t).subscribe(i=>{i&&i.id?(this.customToastService.add({message:"Factura actualizada correctamente.",type:"success",duration:5e3}),this.router.navigateByUrl(`/detail-invoice/${i.id}`)):this.customToastService.add({message:i.message,type:"error",duration:5e3}),this.isFormSubmitting.set(!1)})}handleCreateOrEditInvoiceSendingEmailAsWell(e,t=null){}onCreateNewInvoiceSendingEmail(e,t){}onEditInvoiceSendingEmail(e,t,i){}sendInvoiceEmail(e,t){}getCorrectPriceFromItemSelectedEmitter(e,t){let i=e?.invoiceItems.find(a=>a.item.id===t.id);return t.isLoadingExistingItem?i?.price??0:t.salePrice}getCorrectAccountFromItemSelectedEmitter(e,t){let i=e?.invoiceItems.find(a=>a.item.id===t.id);return t.isLoadingExistingItem?i?.account?.id??"":t.saleAccountId??""}getCorrectDescriptionFromItemSelectedEmitter(e,t){let i=e?.invoiceItems.find(a=>a.item.id===t.id);return t.isLoadingExistingItem?i?.description??"":t.description??""}static \u0275fac=function(t){return new(t||l)};static \u0275prov=p({token:l,factory:l.\u0275fac,providedIn:"root"})};export{A as a};
