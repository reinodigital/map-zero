import{a as ee}from"./chunk-A5MLRQVF.js";import"./chunk-NOTS5ZWT.js";import{a as K,b as Q,c as X,d as Y}from"./chunk-ADBCP3CC.js";import{a as Z}from"./chunk-S5LKHTCT.js";import"./chunk-7FLAGI4M.js";import"./chunk-G7SYGITX.js";import{a as U}from"./chunk-QVQJSET7.js";import{a as H}from"./chunk-2JQHP4ZC.js";import{a as J}from"./chunk-T5DHTF52.js";import"./chunk-IETRKHQE.js";import{b as V,d as B,e as G,h as j,k as z,n as W,t as $,u as q}from"./chunk-XXXEA7T5.js";import{f as R,y as M}from"./chunk-NXK32U4M.js";import"./chunk-SF27WFEL.js";import{$a as d,Ab as c,Jb as a,Kb as m,Lb as g,Ma as s,Tb as N,Ub as k,Wa as F,X as I,a as L,b as T,ba as u,fb as f,gc as P,ia as O,ib as y,ja as S,kb as _,na as A,nb as w,ob as D,pb as t,qb as i,rb as h,vb as C,wa as o,zb as b}from"./chunk-BXSYLYWC.js";var x=class e{lastOffsetPurchaseOrdersList=o(0);selectedTabIndex=o(0);statusByIndexMap={0:"",1:"borrador",2:"enviada",3:"esperando_aprobaci\xF3n",4:"aprobada",5:"pagada"};static \u0275fac=function(n){return new(n||e)};static \u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"})};var re=(e,r)=>r.id;function ne(e,r){e&1&&h(0,"i",6)}function ae(e,r){e&1&&h(0,"i",7)}function se(e,r){e&1&&(t(0,"div",18)(1,"div",21)(2,"div",22)(3,"h4",23),a(4,"Loading"),i(),h(5,"i",24),t(6,"p",25),a(7,"Cargando..."),i()()()())}function le(e,r){if(e&1&&(a(0," Todas "),t(1,"span",34),a(2),i()),e&2){let n=c(2);s(2),m(n.totalAll())}}function oe(e,r){if(e&1&&(a(0," Borrador "),t(1,"span",34),a(2),i()),e&2){let n=c(2);s(2),m(n.totalDraft())}}function ce(e,r){if(e&1&&(a(0," Enviadas "),t(1,"span",34),a(2),i()),e&2){let n=c(2);s(2),m(n.totalSent())}}function me(e,r){if(e&1&&(a(0," Esperando aprobaci\xF3n "),t(1,"span",34),a(2),i()),e&2){let n=c(2);s(2),m(n.totalAwaitingApproval())}}function de(e,r){if(e&1&&(a(0," Aprobadas "),t(1,"span",34),a(2),i()),e&2){let n=c(2);s(2),m(n.totalApproved())}}function pe(e,r){if(e&1&&(a(0," Pagadas "),t(1,"span",34),a(2),i()),e&2){let n=c(2);s(2),m(n.totalBilled())}}function ue(e,r){if(e&1&&(t(0,"tr",33)(1,"td"),a(2),i(),t(3,"td"),a(4),i(),t(5,"td"),a(6),N(7,"readableDate"),i(),t(8,"td")(9,"span"),a(10),i()(),t(11,"td"),a(12),i()()),e&2){let n,l=r.$implicit,p=c(2);f("routerLink","/detail-purchase-order/"+l.id),s(2),m(l.purchaseOrderNumber),s(2),m(l.client.name),s(2),m(k(7,8,l.initDate)),s(3),y(p.detailPurchaseOrderService.getStatusBadgeFromPurchaseOrder((n=l==null?null:l.status)!==null&&n!==void 0?n:"")),s(),g(" ",l==null?null:l.status," "),s(2),m(l.total)}}function fe(e,r){if(e&1&&(t(0,"tr")(1,"div",35)(2,"div",36),a(3),i()()()),e&2){let n=c(2);s(3),g(" ",n.isActiveFilters()?"Sin resultados para esa b\xFAsqueda":"Sin resultados en \xF3rdenes de compra"," ")}}function he(e,r){if(e&1){let n=C();t(0,"div",19)(1,"div",3)(2,"div",11)(3,"div",26)(4,"h3"),a(5,"\xD3rdenes de compra"),i(),t(6,"button",27),a(7," + Nueva orden de compra "),i()(),t(8,"mat-tab-group",28),b("selectedTabChange",function(p){O(n);let v=c();return S(v.onTabChange(p))}),t(9,"mat-tab"),d(10,le,3,1,"ng-template",29),i(),t(11,"mat-tab"),d(12,oe,3,1,"ng-template",29),i(),t(13,"mat-tab"),d(14,ce,3,1,"ng-template",29),i(),t(15,"mat-tab"),d(16,me,3,1,"ng-template",29),i(),t(17,"mat-tab"),d(18,de,3,1,"ng-template",29),i(),t(19,"mat-tab"),d(20,pe,3,1,"ng-template",29),i()(),t(21,"div",30)(22,"table",31)(23,"thead")(24,"tr")(25,"th"),a(26,"N\xFAmero"),i(),t(27,"th"),a(28,"Cliente"),i(),t(29,"th"),a(30,"Fecha inicio"),i(),t(31,"th"),a(32,"Estado"),i(),t(33,"th"),a(34,"Monto"),i()()(),t(35,"tbody",32),w(36,ue,13,10,"tr",33,re,!1,fe,4,1,"tr"),i()()()()()()}if(e&2){let n=c();s(8),f("selectedIndex",n.selectedTabIndex()),s(28),D(n.purchaseOrders())}}function be(e,r){if(e&1){let n=C();t(0,"div",20)(1,"app-pagination",37),b("offsetEmitter",function(p){O(n);let v=c();return S(v.detectChangeOffset(p))}),i()()}if(e&2){let n=c();s(),f("total",n.total())("factor",n.limit)("initialOffset",n.offset())}}var E=class e{fb=u($);destroyRef=u(A);purchaseOrderService=u(M);detailPurchaseOrderService=u(ee);listPurchaseOrdersService=u(x);purchaseOrders=o([]);limit=10;offset=P(()=>this.listPurchaseOrdersService.lastOffsetPurchaseOrdersList());total=o(0);isLoading=o(!0);totalAll=o(0);totalDraft=o(0);totalSent=o(0);totalAwaitingApproval=o(0);totalApproved=o(0);totalBilled=o(0);filtersOpen=o(!1);filters=o({});isActiveFilters=o(!1);searchForm=o(this.fb.group({purchaseOrderNumber:["",[]]}));selectedTabIndex=P(()=>this.listPurchaseOrdersService.selectedTabIndex());ngOnInit(){this.fetchAllItems()}fetchAllItems(){this.filters.set(T(L({},this.filters()),{status:this.listPurchaseOrdersService.statusByIndexMap[this.selectedTabIndex()]})),this.purchaseOrderService.fetchAll(this.limit,this.offset(),this.filters()).pipe(U(this.destroyRef)).subscribe(r=>{r&&r.count>=0&&(this.total.set(r.count),this.purchaseOrders.set(r.purchaseOrders),this.totalAll.set(r.total),this.fillOutStatusPurchaseOrder(r.statusCounts??null)),this.isLoading.set(!1)})}fillOutStatusPurchaseOrder(r){r&&(this.totalDraft.set(r.borrador??0),this.totalSent.set(r.enviada??0),this.totalAwaitingApproval.set(r.esperando_aprobaci\u00F3n??0),this.totalApproved.set(r.aprobada??0),this.totalBilled.set(r.pagada??0))}openCloseFilters(){this.filtersOpen.set(!this.filtersOpen())}onTabChange(r){this.listPurchaseOrdersService.selectedTabIndex.set(r.index),this.listPurchaseOrdersService.lastOffsetPurchaseOrdersList.set(0),this.fetchAllItems()}searchFormSubmit(){this.filters.set(this.searchForm().value),this.listPurchaseOrdersService.lastOffsetPurchaseOrdersList.set(0),this.isActiveFilters.set(!0),this.fetchAllItems()}restartFilters(){this.listPurchaseOrdersService.lastOffsetPurchaseOrdersList.set(0),this.isActiveFilters.set(!1),this.filters.set({}),this.listPurchaseOrdersService.selectedTabIndex.set(0),this.searchForm().reset(),this.fetchAllItems()}detectChangeOffset(r){this.isLoading.set(!0),this.listPurchaseOrdersService.lastOffsetPurchaseOrdersList.set(r),this.fetchAllItems()}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=F({type:e,selectors:[["list-purchase-orders"]],decls:25,vars:7,consts:[[1,"main_content"],[3,"primaryText","primaryLink"],[1,"filters","mb-4"],[1,"box"],["data-bs-toggle","collapse","data-bs-target","#collapseFilters","aria-expanded","false","aria-controls","collapseFilters",1,"d-flex","justify-content-between","align-items-center","cp","mb-2",3,"click"],[1,"mb-0"],[1,"fa-solid","fa-window-minimize"],[1,"fa-solid","fa-window-maximize"],["id","collapseFilters",1,"collapse"],[1,"card","card-body"],["autocomplete","off",1,"search_form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],["type","text","formControlName","purchaseOrderNumber"],[1,"d-flex","justify-content-start","mt-4"],["type","submit",1,"btn","btn-success"],["type","button",1,"btn","btn-light","ms-2",3,"click"],[1,"row","animate__animated","animate__fadeIn"],[1,"table_clients"],[1,"d-flex","justify-content-center","w_100","mt-4"],[1,"col-12"],["role","alert",1,"alert","alert-info","text-center"],[1,"alert-heading"],[1,"fa","fa-spin","fa-refresh","fa-2x"],[1,"mb-o"],[1,"d-flex","justify-content-between","mb-3"],["routerLink","/new-purchase-order",1,"btn","btn-primary","mb-2"],[1,"mt-4","mb-3",3,"selectedTabChange","selectedIndex"],["mat-tab-label",""],[1,"table-responsive"],[1,"table"],[1,"animate__animated","animate__fadeIn"],[1,"admin_tr",3,"routerLink"],[1,"text-primary","ms-2"],[1,"w-100","d-flex","justify-content-start"],[1,"alert","alert-warning"],[3,"offsetEmitter","total","factor","initialOffset"]],template:function(n,l){n&1&&(t(0,"div",0),h(1,"breadcrumb",1),t(2,"div",2)(3,"div",3)(4,"div",4),b("click",function(){return l.openCloseFilters()}),t(5,"h3",5),a(6,"Filtrar \xF3rdenes de compra"),i(),d(7,ne,1,0,"i",6)(8,ae,1,0,"i",7),i(),t(9,"div",8)(10,"div",9)(11,"form",10),b("ngSubmit",function(){return l.searchFormSubmit()}),t(12,"div",11)(13,"div",12)(14,"label",13),a(15,"N\xFAmero"),i(),h(16,"input",14),i()(),t(17,"div",15)(18,"button",16),a(19,"Filtrar"),i(),t(20,"button",17),b("click",function(){return l.restartFilters()}),a(21," Restablecer filtros "),i()()()()()()(),d(22,se,8,0,"div",18)(23,he,39,2,"div",19)(24,be,2,3,"div",20),i()),n&2&&(s(),f("primaryText","Vista de compras")("primaryLink","/purchases-overview"),s(6),_(l.filtersOpen()?7:8),s(4),f("formGroup",l.searchForm()),s(11),_(l.isLoading()?22:-1),s(),_(l.isLoading()?-1:23),s(),_(l.total()?24:-1))},dependencies:[q,j,V,B,G,z,W,Y,K,Q,X,H,R,Z,J],encapsulation:2,changeDetection:0})};export{E as default};
