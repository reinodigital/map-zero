import{a as I}from"./chunk-SQSKTF64.js";import{a as f}from"./chunk-SKRCLLK5.js";import{w as A}from"./chunk-5RJIBXIL.js";import{a as S}from"./chunk-QULINWIQ.js";import{A as u,D as g,E as h,K as v}from"./chunk-K4252JJD.js";import{X as p,ba as r,j as m,wa as b}from"./chunk-QAVPLLNK.js";var k=class n{dialog=r(A);quoteService=r(v);customToastService=r(S);_statusChange$=new m;statusChange$=this._statusChange$.asObservable();isSendEmailFromDetailComponentSubmitting=b(!1);calculateTotalsOnDetail(e){let{subtotal:t,discounts:s,iva:a}=e.reduce((i,o)=>{let c=o.quantity*o.price,l=o.quantity*(o.price*o.discount/100),C=(c-l)*(g(o.taxRate??"08")/100);return{subtotal:i.subtotal+c,discounts:i.discounts+l,iva:i.iva+C}},{subtotal:0,discounts:0,iva:0}),d=t-s+a;return{iva:a,discounts:s,subtotal:t,total:d}}getTaxRateLabel(e){return h(e)}getStatusBadgeFromQuote(e){let t="badge bg-label-light";switch(e){case"borrador":t="badge bg-label-light";break;case"enviada":t="badge bg-label-primary";break;case"aceptada":t="badge bg-label-success";break;case"rechazada":t="badge bg-label-danger";break;case"facturada":t="badge bg-label-warning";break;case"removida":t="badge bg-label-removed";break;default:break}return t}displayModalQuoteEmail(e){let t={clientName:e.client.name,currency:e.currency,terms:e.terms,total:e.total},s=this.dialog.open(I,{width:"70rem",autoFocus:!1,data:t});s.updatePosition({top:"100px"}),s.afterClosed().subscribe(a=>{if(a){this.isSendEmailFromDetailComponentSubmitting.set(!0);let d=JSON.parse(a);this.quoteService.sendEmail(e.id,d).subscribe(i=>this.processResponse(i))}})}markAsSent(e){this.quoteService.markAsSent(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}markAsAccepted(e){this.quoteService.markAsAccepted(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}markAsDeclined(e){this.quoteService.markAsDeclined(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}markAsInvoiced(e){this.quoteService.markAsInvoiced(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}undoMarkAsAccepted(e){this.quoteService.undoMarkAsAccepted(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}undoMarkAsDeclined(e){this.quoteService.undoMarkAsDeclined(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}undoMarkAsInvoiced(e){this.quoteService.undoMarkAsInvoiced(e,this.generateUpdatedAtProperty()).subscribe(t=>this.processResponse(t))}generateUpdatedAtProperty(){return{updatedAt:u(new Date)}}processResponse(e){e&&e.msg?(this.customToastService.add({message:e.msg,type:"success",duration:5e3}),this._statusChange$.next()):this.customToastService.add({message:e.message,type:"error",duration:5e3}),this.isSendEmailFromDetailComponentSubmitting.set(!1)}removeQuote(e){let t=this.dialog.open(f,{width:"60rem",height:"20rem",autoFocus:!1,data:`Est\xE1s seguro/a de que deseas eliminar esta cotizaci\xF3n ${e.quoteNumber} ?`});t.updatePosition({top:"100px"}),t.afterClosed().subscribe(s=>{s&&this.quoteService.removeOne(e.id,u(new Date)).subscribe(a=>this.processResponse(a))})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};export{k as a};
