import{a as Q}from"./chunk-ADPLVDJ6.js";import{a as K}from"./chunk-S5LKHTCT.js";import"./chunk-7FLAGI4M.js";import{a as J}from"./chunk-APEJKMLE.js";import"./chunk-G7SYGITX.js";import{a as P}from"./chunk-QVQJSET7.js";import{a as H}from"./chunk-WLTKHXUG.js";import{a as U}from"./chunk-IQYKPJHS.js";import"./chunk-IETRKHQE.js";import"./chunk-XXXEA7T5.js";import{c as q,f as z,w as Y}from"./chunk-RV3QXS3Q.js";import{m as G,n as W,q as $}from"./chunk-SF27WFEL.js";import{$a as E,Ab as p,Ba as N,Jb as i,Kb as u,Lb as v,Ma as a,Ob as j,Tb as b,Ub as B,Vb as y,Wa as L,ba as I,fb as D,ia as x,ib as A,ja as f,kb as s,lb as O,na as M,nb as k,ob as h,pb as e,qb as t,rb as m,vb as S,wa as C,zb as _}from"./chunk-BXSYLYWC.js";var X=()=>[],Z=(n,r)=>r.id;function ee(n,r){if(n&1&&(e(0,"button",13),m(1,"i",38),i(2," Editar "),t()),n&2){let c=p(2);D("routerLink","/edit-invoice/"+c.invoiceId)}}function te(n,r){if(n&1){let c=S();e(0,"button",39),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.markAsPaid(l.invoiceId))}),i(1," Marcar como Pagada "),t()}}function ie(n,r){if(n&1){let c=S();e(0,"li")(1,"button",40),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.markAsAwaitingPayment(l.invoiceId))}),i(2," Marcar como Aprobada "),t()()}}function ne(n,r){n&1&&m(0,"div",16)}function oe(n,r){n&1&&m(0,"i",17)}function ae(n,r){if(n&1){let c=S();e(0,"li")(1,"button",41),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.displayModalInvoiceEmail(l.invoice()))}),m(2,"i",42),i(3," Enviar "),t()()}}function le(n,r){if(n&1){let c=S();e(0,"li")(1,"button",41),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.markAsSent(l.invoiceId))}),m(2,"i",43),i(3," Marcar como Enviada "),t()()}}function ce(n,r){if(n&1){let c=S();e(0,"li")(1,"button",41),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.markAsAwaitingApproval(l.invoiceId))}),m(2,"i",44),i(3," Marcar como Esperando a ser Aprobada "),t()()}}function re(n,r){if(n&1){let c=S();e(0,"li")(1,"button",41),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.markAsAwaitingPayment(l.invoiceId))}),m(2,"i",44),i(3," Marcar como Aprobada "),t()()}}function de(n,r){if(n&1){let c=S();e(0,"li")(1,"button",41),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.markAsPaid(l.invoiceId))}),m(2,"i",44),i(3," Marcar como Pagada "),t()()}}function me(n,r){if(n&1&&(e(0,"li")(1,"button",45),m(2,"i",46),i(3," Editar "),t()()),n&2){let c=p(2);a(),D("routerLink","/edit-invoice/"+c.invoiceId)}}function se(n,r){if(n&1){let c=S();e(0,"li")(1,"button",41),_("click",function(){x(c);let l=p(2);return f(l.detailInvoiceService.removeInvoice(l.invoice()))}),m(2,"i",47),i(3," Remover "),t()()}}function pe(n,r){if(n&1&&(e(0,"span"),m(1,"i",48),i(2),t()),n&2){let c=r.$implicit;a(2),v(" ",c," ")}}function ue(n,r){n&1&&(e(0,"span"),i(1,"_"),t())}function ve(n,r){if(n&1&&(e(0,"tr")(1,"td")(2,"span"),i(3),t()(),e(4,"td")(5,"span"),i(6),t()(),e(7,"td")(8,"span"),i(9),t()(),e(10,"td")(11,"span"),i(12),t()(),e(13,"td")(14,"span"),i(15),t()(),e(16,"td")(17,"span"),i(18),t()(),e(19,"td")(20,"span"),i(21),t()(),e(22,"td",49)(23,"span"),i(24),t()()()),n&2){let c,d,l=r.$implicit,T=p(2);a(3),u(l.item.name),a(3),u(l.description),a(3),u(l.quantity),a(3),u(l.price),a(3),u(l.discount),a(3),u((c=l.account==null?null:l.account.name)!==null&&c!==void 0?c:"_"),a(3),v(" ",T.detailInvoiceService.getTaxRateLabel((d=l.taxRate)!==null&&d!==void 0?d:"")," "),a(3),u(l.amount)}}function _e(n,r){n&1&&(e(0,"tr",30)(1,"td",50),i(2," No existen Art\xEDculos ni servicios en esta factura. "),t()())}function xe(n,r){if(n&1&&(e(0,"div",8)(1,"div",9)(2,"span",10),i(3),t(),e(4,"span"),i(5),t()(),e(6,"div",11)(7,"button",12),i(8,"Imprimir PDF"),t(),E(9,ee,3,1,"button",13)(10,te,2,0,"button",14)(11,ie,3,0,"li"),e(12,"div",15),E(13,ne,1,0,"div",16)(14,oe,1,0,"i",17),e(15,"ul",18),E(16,ae,4,0,"li")(17,le,4,0,"li")(18,ce,4,0,"li")(19,re,4,0,"li")(20,de,4,0,"li")(21,me,4,1,"li")(22,se,4,0,"li"),e(23,"li"),m(24,"div",19),e(25,"small",20),i(26,"Acciones"),t()()()()()(),e(27,"div",21)(28,"div",22)(29,"label"),i(30,"Cliente"),t(),e(31,"span"),i(32),t()(),e(33,"div",22)(34,"label"),i(35,"Fecha inicio"),t(),e(36,"span"),i(37),b(38,"readableDate"),t()(),e(39,"div",22)(40,"label"),i(41,"Fecha expira"),t(),e(42,"span"),i(43),b(44,"readableDate"),t()(),e(45,"div",22)(46,"label"),i(47,"N\xFAmero factura"),t(),e(48,"span"),i(49),t()(),e(50,"div",22)(51,"label"),i(52,"Moneda"),t(),e(53,"span"),i(54),t()(),e(55,"div",22)(56,"label"),i(57,"Estado"),t(),e(58,"span"),i(59),t()(),e(60,"div",22)(61,"label"),i(62,"Actividades econ\xF3micas"),t(),e(63,"div",23),k(64,pe,3,1,"span",null,O,!1,ue,2,0,"span"),t()(),e(67,"div",22)(68,"label"),i(69,"Referencia"),t(),e(70,"span"),i(71),t()()(),e(72,"div",24)(73,"table",25)(74,"thead")(75,"tr")(76,"th",26)(77,"span"),i(78,"Item"),t()(),e(79,"th",27)(80,"span"),i(81,"Descripci\xF3n"),t()(),e(82,"th",28)(83,"span"),i(84," Cantidad "),t()(),e(85,"th",28)(86,"span"),i(87,"Precio"),t()(),e(88,"th",28)(89,"span"),i(90,"Descuento"),t()(),e(91,"th",28)(92,"span"),i(93,"Cuenta"),t()(),e(94,"th",28)(95,"span"),i(96,"Impuesto"),t()(),e(97,"th",29)(98,"span"),i(99,"Monto"),t()()()(),e(100,"tbody"),k(101,ve,25,8,"tr",null,Z,!1,_e,3,0,"tr",30),t()()(),e(104,"div",31)(105,"div",32)(106,"ul",33)(107,"li",34)(108,"span"),i(109,"Subtotal"),t(),e(110,"span"),i(111),b(112,"number"),t()(),e(113,"li",34)(114,"span"),i(115,"Descuento total"),t(),e(116,"span",35),i(117),b(118,"number"),t()(),e(119,"li",34)(120,"span"),i(121,"Impuesto total"),t(),e(122,"span"),i(123),b(124,"number"),t()(),m(125,"div",36),e(126,"li",37)(127,"span"),i(128,"Total"),t(),e(129,"strong"),i(130),b(131,"number"),t()()()()()),n&2){let c,d,l,T,g,R,w,F,o=p();a(3),u((c=o.invoice())==null?null:c.invoiceNumber),a(),A(o.detailInvoiceService.getStatusBadgeFromInvoice((d=(d=o.invoice())==null?null:d.status)!==null&&d!==void 0?d:"")),a(),v(" ",(l=o.invoice())==null?null:l.status," "),a(4),s(o.allowedStatusToBeEditedFromButton.includes(o.invoice().status)?9:-1),a(),s(o.allowedStatusToBePaid.includes(o.invoice().status)?10:-1),a(),s(o.allowedStatusToBeAwaitingPayment.includes(o.invoice().status)?11:-1),a(2),s(o.detailInvoiceService.isSendEmailFromDetailComponentSubmitting()?13:14),a(3),s(o.allowedStatusToBeSent.includes(o.invoice().status)?16:-1),a(),s(o.allowedStatusToMarkAsSent.includes(o.invoice().status)?17:-1),a(),s(o.allowedStatusToBeAwaitingApproval.includes(o.invoice().status)?18:-1),a(),s(o.allowedStatusToBeAwaitingPayment.includes(o.invoice().status)?19:-1),a(),s(o.allowedStatusToBePaid.includes(o.invoice().status)?20:-1),a(),s(o.allowedStatusToBeEdited.includes(o.invoice().status)?21:-1),a(),s(o.allowedStatusToBeRemoved.includes(o.invoice().status)?22:-1),a(10),u((T=o.invoice())==null||T.client==null?null:T.client.name),a(5),u(B(38,30,o.invoice().initDate)),a(6),v(" ",o.invoice().expireDate?B(44,32,o.invoice().expireDate):"_"," "),a(6),v(" ",o.invoice().invoiceNumber," "),a(5),v(" ",o.invoice().currency," "),a(4),A(o.detailInvoiceService.getStatusBadgeFromInvoice((g=(g=o.invoice())==null?null:g.status)!==null&&g!==void 0?g:"")),a(),v(" ",(R=o.invoice())==null?null:R.status," "),a(5),h((w=(w=o.invoice())==null?null:w.receptorActivities)!==null&&w!==void 0?w:j(46,X)),a(7),v(" ",o.invoice().reference?o.invoice().reference:"_"," "),a(30),h((F=o.invoice())==null?null:F.invoiceItems),a(10),u(y(112,34,o.subtotal(),"1.2-2")),a(6),v(" - ",y(118,37,o.totalDiscount(),"1.2-2")," "),a(6),u(y(124,40,o.totalTax(),"1.2-2")),a(7),v(" ",y(131,43,o.totalAmount(),"1.2-2")," ")}}function fe(n,r){if(n&1&&m(0,"tracking-entity",7),n&2){let c=p();D("tracking",c.invoice().tracking)("entity",c.entityData())}}var V=class n{platformId=I(N);activatedRoute=I(q);commonAdminService=I(U);destroyRef=I(M);invoiceService=I(Y);detailInvoiceService=I(Q);entityData=C(null);allowedStatusToBeEditedFromButton=["borrador"];allowedStatusToBeSent=["borrador","enviada","esperando_aprobaci\xF3n","esperando_pago"];allowedStatusToMarkAsSent=["borrador"];allowedStatusToBeAwaitingApproval=["borrador","enviada"];allowedStatusToBeAwaitingPayment=["esperando_aprobaci\xF3n"];allowedStatusToBePaid=["esperando_pago"];allowedStatusToBeEdited=["borrador","enviada","esperando_aprobaci\xF3n"];allowedStatusToBeRemoved=["borrador","enviada"];get isBrowser(){return $(this.platformId)}invoiceId;invoice=C(null);subtotal=C(0);totalDiscount=C(0);totalTax=C(0);totalAmount=C(0);constructor(){this.invoiceId=this.activatedRoute.snapshot.params.id,this.entityData.set({refEntity:"Invoice",refEntityId:this.invoiceId})}ngOnInit(){this.fetchInvoice(),this.detailInvoiceService.statusChange$.pipe(P(this.destroyRef)).subscribe(()=>{this.fetchInvoice()})}fetchInvoice(){this.invoiceService.fetchOne(this.invoiceId).pipe(P(this.destroyRef)).subscribe(r=>{r&&r.id&&(this.invoice.set(r),this.updateTotals())})}updateTotals(){let r=this.detailInvoiceService.calculateTotalsOnDetail(this.invoice()?.invoiceItems??[]);this.subtotal.set(r.subtotal),this.totalDiscount.set(r.discounts),this.totalTax.set(r.iva),this.totalAmount.set(r.total)}comeBackToList(){this.commonAdminService.comeBackToList("/list-invoices")}static \u0275fac=function(c){return new(c||n)};static \u0275cmp=L({type:n,selectors:[["detail-invoice"]],decls:11,vars:6,consts:[[1,"main_content"],[3,"primaryText","primaryLink","secondaryText","secondaryLink"],[1,"box"],[1,"d-flex","justify-content-between","mb-3"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[3,"tracking","entity"],[1,"d-flex","justify-content-between","mb-4"],[1,"d-flex","align-items-center"],[1,"me-3"],[1,"hstack","gap-3"],[1,"btn","btn-outline-secondary"],["type","button",1,"btn","btn-primary",3,"routerLink"],["type","button",1,"btn","btn-success"],[1,"dropdown"],[1,"spinner","ms-1"],["data-bs-toggle","dropdown","aria-expanded","false",1,"fa-solid","fa-ellipsis-vertical","three_points_dropdown"],[1,"dropdown-menu"],[1,"line_divider","mt-3","mb-2"],[1,"ms-3","fs-4"],[1,"row","mb-5"],[1,"col-12","col-md-3","col-lg-2"],[1,"d-flex","flex-column","mt-1"],[1,"row","table_items"],[1,"table","table-sm","mb-3"],[1,"col-2"],[1,"col-3"],[1,"col-1"],[1,"col-1","text-end"],[1,"no-elements"],[1,"row","mt-4"],[1,"col-md-6","col-lg-4","offset-md-6","offset-lg-8"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"text-danger"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"fa-solid","fa-pen-to-square","me-2"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-paper-plane","icon_sent","me-2"],[1,"fa-solid","fa-marker","icon_mark_as_sent","me-2"],[1,"fa-solid","fa-check","icon_accepted","me-2"],["type","button",1,"dropdown-item",3,"routerLink"],[1,"fa-solid","fa-pen-to-square","icon_pencil","me-2"],[1,"fa-solid","fa-trash","icon_trash","me-2"],[1,"fa-solid","fa-check"],[1,"text-end"],["colspan","12"]],template:function(c,d){c&1&&(e(0,"div",0),m(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Detalle factura"),t(),e(6,"h4",5),_("click",function(){return d.comeBackToList()}),m(7,"i",6),i(8," Regresar "),t()(),E(9,xe,132,47),t()(),E(10,fe,1,2,"tracking-entity",7)),c&2&&(a(),D("primaryText","Vista de ventas")("primaryLink","/sales-overview")("secondaryText","Listado facturas")("secondaryLink","/list-invoices"),a(8),s(d.invoice()?9:-1),a(),s(d.invoice()?10:-1))},dependencies:[W,G,z,K,J,H],styles:[".table_items[_ngcontent-%COMP%]{padding-top:4rem}th[_ngcontent-%COMP%]{color:var(--text);font-size:medium;font-weight:400}.total_price[_ngcontent-%COMP%]{font-size:1.3rem;margin-bottom:.4rem}"],changeDetection:0})};export{V as default};
