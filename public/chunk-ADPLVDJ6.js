import{a as Q}from"./chunk-7FLAGI4M.js";import{u as H,v as Y,w as K}from"./chunk-G7SYGITX.js";import{a as C}from"./chunk-IETRKHQE.js";import{b as U,c as E,d as L,e as z,h as G,k as q,n as B,t as J,u as W}from"./chunk-XXXEA7T5.js";import{m as f,p as O,q as N,w as $}from"./chunk-RV3QXS3Q.js";import{$a as k,Ab as c,Jb as s,Lb as j,Ma as S,Ra as w,Wa as T,X as R,ba as l,fb as A,ia as d,j as y,ja as u,kb as P,lb as D,nb as F,ob as V,pb as n,qb as r,rb as _,vb as I,wa as p,zb as g}from"./chunk-BXSYLYWC.js";function ie(a,t){if(a&1){let e=I();n(0,"div",8)(1,"span"),s(2),n(3,"i",17),g("click",function(){let i=d(e).$index,v=c(2);return u(v.removeEmail(i))}),r()()()}if(a&2){let e=t.$implicit;S(2),j(" ",e," ")}}function oe(a,t){if(a&1){let e=I();n(0,"div",0)(1,"div",1)(2,"h3"),s(3,"Enviar factura"),r(),n(4,"i",2),g("click",function(){d(e);let i=c();return u(i.closePopUp("cancel"))}),r()(),n(5,"form",3)(6,"label",4),s(7,"Bandeja "),n(8,"span",5),s(9,"*"),r()(),_(10,"input",6),n(11,"div",7),F(12,ie,4,1,"div",8,D),r(),n(14,"button",9),g("click",function(){d(e);let i=c();return u(i.addEmail())}),s(15," + Agregar email "),r(),n(16,"label",10),s(17,"Encabezado"),r(),_(18,"input",11),n(19,"label",12),s(20,"Mensaje"),r(),_(21,"textarea",13),n(22,"div",14)(23,"button",15),g("click",function(){d(e);let i=c();return u(i.closePopUp("cancel"))}),s(24," Cancelar "),r(),n(25,"button",16),g("click",function(){d(e);let i=c();return u(i.closePopUp("send"))}),s(26," Enviar "),r()()()()}if(a&2){let e=c();S(5),A("formGroup",e.newSendInvoiceEmailForm()),S(7),V(e.emails())}}var h=class a{constructor(t){this.dataMessage=t;this.data.set(t),this.buildEmail()}fb=l(J);dialogRef=l(H);customToastService=l(C);data=p(null);emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$";emails=p([]);newSendInvoiceEmailForm=p(this.fb.group({email:["",[E.required,E.pattern(this.emailPattern)]],subject:["",[]],message:["",[]]}));buildEmail(){let t=`Hola ${this.data()?.clientName},

Esta es la factura correspondiente por ${this.data()?.currency} ${this.data()?.total.toFixed(2)}

Si\xE9ntese libre de comunicarse con nosotros si existe alguna duda.

Ver pdf de factura adjunto a este correo.

Saludos.`,e="Factura de parte de Map Soluciones";this.newSendInvoiceEmailForm().controls.message.patchValue(t),this.newSendInvoiceEmailForm().controls.subject.patchValue(e)}addEmail(){let t=this.newSendInvoiceEmailForm().controls.email,e=t.value;if(e&&this.emails().includes(e)){this.newSendInvoiceEmailForm().controls.email.patchValue("");return}t.valid&&e?(this.emails().push(e),this.newSendInvoiceEmailForm().controls.email.patchValue("")):this.customToastService.add({message:"Formato de correo electr\xF3nico inv\xE1lido.",type:"error",duration:8e3})}removeEmail(t){this.emails().splice(t,1)}closePopUp(t){if(t!=="send"){this.dialogRef.close(null);return}this.onSend()}onSend(){if(!this.emails().length){this.customToastService.add({message:"Se ocupa al menos un correo electr\xF3nico de bandeja.",type:"error",duration:6e3});return}let t={sentAt:f(new Date),emails:this.emails(),message:this.newSendInvoiceEmailForm().controls.message.value??"",subject:this.newSendInvoiceEmailForm().controls.subject.value??""};this.dialogRef.close(JSON.stringify(t))}static \u0275fac=function(e){return new(e||a)(w(Y))};static \u0275cmp=T({type:a,selectors:[["custom-modal-send-invoice-email-recipient"]],decls:1,vars:1,consts:[[1,"square"],[1,"d-flex","justify-content-between","align-items-start"],[1,"fa-solid","fa-circle-xmark","btn_close",3,"click"],[1,"form",3,"formGroup"],["for","email"],[1,"asterisk"],["type","email","formControlName","email","placeholder","agregar correo bandeja"],[1,"form_email_list"],[1,"form_email_list_badge"],[1,"btn","btn-outline-primary","mt-2",3,"click"],["for","subject",1,"mt-4"],["type","text","formControlName","subject","placeholder","encabezado"],["for","message",1,"mt-4"],["formControlName","message","rows","12","placeholder","mensaje"],[1,"hstack","gap-3","buttons"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-success",3,"click"],[1,"fa-solid","fa-xmark",3,"click"]],template:function(e,o){e&1&&k(0,oe,27,1,"div",0),e&2&&P(o.data()?0:-1)},dependencies:[W,G,U,L,z,q,B],styles:[".square[_ngcontent-%COMP%]{border-radius:.5rem;padding:2rem;position:relative;height:100%;width:100%}.btn_close[_ngcontent-%COMP%]{cursor:pointer;color:var(--primary);font-size:2.2rem}.info[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.form[_ngcontent-%COMP%]{margin-bottom:3rem}.form[_ngcontent-%COMP%]   .form_email_list[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.form[_ngcontent-%COMP%]   .form_email_list[_ngcontent-%COMP%]   .form_email_list_badge[_ngcontent-%COMP%]{border-radius:2rem;background-color:var(--primary_orange);color:var(--white);font-size:1rem;padding:.3rem .6rem;margin-top:.2rem;margin-right:.1rem}.form[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{position:absolute;right:2rem;bottom:1rem}"],changeDetection:0})};var X=class a{dialog=l(K);invoiceService=l($);customToastService=l(C);_statusChange$=new y;statusChange$=this._statusChange$.asObservable();isSendEmailFromDetailComponentSubmitting=p(!1);calculateTotalsOnDetail(t){let{subtotal:e,discounts:o,iva:i}=t.reduce((b,m)=>{let x=m.quantity*m.price,M=m.quantity*(m.price*m.discount/100),Z=(x-M)*(O(m.taxRate??"08")/100);return{subtotal:b.subtotal+x,discounts:b.discounts+M,iva:b.iva+Z}},{subtotal:0,discounts:0,iva:0}),v=e-o+i;return{iva:i,discounts:o,subtotal:e,total:v}}getTaxRateLabel(t){return N(t)}getStatusBadgeFromInvoice(t){let e="badge bg-label-light";switch(t){case"borrador":e="badge bg-label-light";break;case"enviada":e="badge bg-label-primary";break;case"esperando_aprobaci\xF3n":e="badge bg-label-warning";break;case"esperando_pago":e="badge bg-label-danger";break;case"pagada":e="badge bg-label-success";break;case"removida":e="badge bg-label-removed";break;default:break}return e}displayModalInvoiceEmail(t){let e={clientName:t.client.name,currency:t.currency,total:t.total},o=this.dialog.open(h,{width:"70rem",autoFocus:!1,data:e});o.updatePosition({top:"100px"}),o.afterClosed().subscribe(i=>{if(i){this.isSendEmailFromDetailComponentSubmitting.set(!0);let v=JSON.parse(i);this.invoiceService.sendEmail(t.id,v).subscribe(b=>this.processResponse(b))}})}generateUpdatedAtProperty(){return{updatedAt:f(new Date)}}processResponse(t){t&&t.msg?(this.customToastService.add({message:t.msg,type:"success",duration:5e3}),this._statusChange$.next()):this.customToastService.add({message:t.message,type:"error",duration:5e3}),this.isSendEmailFromDetailComponentSubmitting.set(!1)}removeInvoice(t){let e=this.dialog.open(Q,{width:"60rem",height:"20rem",autoFocus:!1,data:`Est\xE1s seguro/a de que deseas eliminar esta factura ${t.invoiceNumber} ?`});e.updatePosition({top:"100px"}),e.afterClosed().subscribe(o=>{o&&this.invoiceService.removeOne(t.id,f(new Date)).subscribe(i=>this.processResponse(i))})}markAsSent(t){this.invoiceService.markAsSent(t,this.generateUpdatedAtProperty()).subscribe(e=>this.processResponse(e))}markAsAwaitingApproval(t){this.invoiceService.markAsAwaitingApproval(t,this.generateUpdatedAtProperty()).subscribe(e=>this.processResponse(e))}markAsAwaitingPayment(t){this.invoiceService.markAsAwaitingPayment(t,this.generateUpdatedAtProperty()).subscribe(e=>this.processResponse(e))}markAsPaid(t){this.invoiceService.markAsPaid(t,this.generateUpdatedAtProperty()).subscribe(e=>this.processResponse(e))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=R({token:a,factory:a.\u0275fac,providedIn:"root"})};export{X as a};
