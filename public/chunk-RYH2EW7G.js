import{a as tt}from"./chunk-F6G5AINB.js";import{a as Q,b as W,c as X,d as Y}from"./chunk-3EKZTFQQ.js";import{a as Z}from"./chunk-5BOVWHXY.js";import"./chunk-ZXERMP2K.js";import"./chunk-IBKVHNU3.js";import{a as H}from"./chunk-GZHOXXQG.js";import{a as J}from"./chunk-MXFBXJ6G.js";import{a as K}from"./chunk-5LJDG4R3.js";import"./chunk-WKFQL3IM.js";import{b as j,d as G,e as B,h as P,k as z,n as $,t as q,u as U}from"./chunk-UP3F5373.js";import{K as V,s as R}from"./chunk-4ZQGKSBB.js";import{$a as v,Ab as c,Jb as a,Kb as d,Lb as g,Ma as s,Sb as O,Tb as k,Wa as w,X as T,a as E,b as L,ba as p,fb as b,fc as M,ia as C,ib as A,ja as I,kb as _,na as y,nb as D,ob as N,pb as e,qb as i,rb as f,vb as S,wa as r,zb as u}from"./chunk-F6XVVQNR.js";var x=class t{lastOffsetInvoicesList=r(0);static \u0275fac=function(o){return new(o||t)};static \u0275prov=T({token:t,factory:t.\u0275fac,providedIn:"root"})};var it=(t,n)=>n.id;function nt(t,n){t&1&&f(0,"i",6)}function ot(t,n){t&1&&f(0,"i",7)}function at(t,n){t&1&&(e(0,"div",18)(1,"div",21)(2,"div",22)(3,"h4",23),a(4,"Loading"),i(),f(5,"i",24),e(6,"p",25),a(7,"Cargando..."),i()()()())}function lt(t,n){if(t&1&&(a(0," Todas "),e(1,"span",34),a(2),i()),t&2){let o=c(2);s(2),d(o.totalAll())}}function st(t,n){if(t&1&&(a(0," Borrador "),e(1,"span",34),a(2),i()),t&2){let o=c(2);s(2),d(o.totalDraft())}}function rt(t,n){if(t&1&&(e(0,"tr",33)(1,"td"),a(2),i(),e(3,"td"),a(4),i(),e(5,"td"),a(6),O(7,"readableDate"),i(),e(8,"td")(9,"span"),a(10),i()(),e(11,"td"),a(12),i()()),t&2){let o,l=n.$implicit,m=c(2);b("routerLink","/detail-invoice/"+l.id),s(2),d(l.invoiceNumber),s(2),d(l.client.name),s(2),d(k(7,8,l.initDate)),s(3),A(m.detailInvoiceService.getStatusBadgeFromInvoice((o=l==null?null:l.status)!==null&&o!==void 0?o:"")),s(),g(" ",l==null?null:l.status," "),s(2),d(l.total)}}function ct(t,n){if(t&1&&(e(0,"tr")(1,"div",35)(2,"div",36),a(3),i()()()),t&2){let o=c(2);s(3),g(" ",o.isActiveFilters()?"Sin resultados para esa b\xFAsqueda":"No existen facturas por el momento en el sistema"," ")}}function mt(t,n){if(t&1){let o=S();e(0,"div",19)(1,"div",3)(2,"div",11)(3,"div",26)(4,"h3"),a(5,"Facturas"),i(),e(6,"button",27),a(7," + Nueva factura "),i()(),e(8,"mat-tab-group",28),u("selectedTabChange",function(m){C(o);let h=c();return I(h.onTabChange(m))}),e(9,"mat-tab"),v(10,lt,3,1,"ng-template",29),i(),e(11,"mat-tab"),v(12,st,3,1,"ng-template",29),i()(),e(13,"div",30)(14,"table",31)(15,"thead")(16,"tr")(17,"th"),a(18,"N\xFAmero"),i(),e(19,"th"),a(20,"Cliente"),i(),e(21,"th"),a(22,"Fecha inicio"),i(),e(23,"th"),a(24,"Estado"),i(),e(25,"th"),a(26,"Pago total"),i()()(),e(27,"tbody",32),D(28,rt,13,10,"tr",33,it,!1,ct,4,1,"tr"),i()()()()()()}if(t&2){let o=c();s(28),N(o.invoices())}}function dt(t,n){if(t&1){let o=S();e(0,"div",20)(1,"app-pagination",37),u("offsetEmitter",function(m){C(o);let h=c();return I(h.detectChangeOffset(m))}),i()()}if(t&2){let o=c();s(),b("total",o.total())("factor",o.limit)("initialOffset",o.offset())}}var F=class t{fb=p(q);destroyRef=p(y);invoiceService=p(V);detailInvoiceService=p(tt);listInvoicesService=p(x);invoices=r([]);limit=10;offset=M(()=>this.listInvoicesService.lastOffsetInvoicesList());total=r(0);isLoading=r(!0);totalAll=r(0);totalDraft=r(0);invoiceStatusFilter=r("");filtersOpen=r(!1);filters=r({});isActiveFilters=r(!1);searchForm=r(this.fb.group({invoiceNumber:["",[]]}));ngOnInit(){this.fetchAllItems()}fetchAllItems(){this.filters.set(L(E({},this.filters()),{status:this.invoiceStatusFilter()})),this.invoiceService.fetchAll(this.limit,this.offset(),this.filters()).pipe(H(this.destroyRef)).subscribe(n=>{n&&n.count>=0&&(this.total.set(n.count),this.invoices.set(n.invoices),this.totalAll.set(n.total),this.fillOutStatusInvoice(n.statusCounts??null)),this.isLoading.set(!1)})}fillOutStatusInvoice(n){n&&this.totalDraft.set(n.borrador??0)}openCloseFilters(){this.filtersOpen.set(!this.filtersOpen())}onTabChange(n){let o=["","borrador","enviada"];this.invoiceStatusFilter.set(o[n.index]),this.fetchAllItems()}searchFormSubmit(){this.filters.set(this.searchForm().value),this.listInvoicesService.lastOffsetInvoicesList.set(0),this.isActiveFilters.set(!0),this.fetchAllItems()}restartFilters(){this.listInvoicesService.lastOffsetInvoicesList.set(0),this.isActiveFilters.set(!1),this.filters.set({}),this.searchForm().reset(),this.fetchAllItems()}detectChangeOffset(n){this.isLoading.set(!0),this.listInvoicesService.lastOffsetInvoicesList.set(n),this.fetchAllItems()}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=w({type:t,selectors:[["list-invoices"]],decls:25,vars:7,consts:[[1,"main_content"],[3,"primaryText","primaryLink"],[1,"filters","mb-4"],[1,"box"],["data-bs-toggle","collapse","data-bs-target","#collapseFilters","aria-expanded","false","aria-controls","collapseFilters",1,"d-flex","justify-content-between","align-items-center","cp","mb-2",3,"click"],[1,"mb-0"],[1,"fa-solid","fa-window-minimize"],[1,"fa-solid","fa-window-maximize"],["id","collapseFilters",1,"collapse"],[1,"card","card-body"],["autocomplete","off",1,"search_form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],["type","text","formControlName","invoiceNumber"],[1,"d-flex","justify-content-start","mt-4"],["type","submit",1,"btn","btn-success"],["type","button",1,"btn","btn-light","ms-2",3,"click"],[1,"row","animate__animated","animate__fadeIn"],[1,"table_clients"],[1,"d-flex","justify-content-center","w_100","mt-4"],[1,"col-12"],["role","alert",1,"alert","alert-info","text-center"],[1,"alert-heading"],[1,"fa","fa-spin","fa-refresh","fa-2x"],[1,"mb-o"],[1,"d-flex","justify-content-between","mb-3"],["routerLink","/new-invoice",1,"btn","btn-primary","mb-2"],[1,"mt-4","mb-3",3,"selectedTabChange"],["mat-tab-label",""],[1,"table-responsive"],[1,"table"],[1,"animate__animated","animate__fadeIn"],[1,"admin_tr",3,"routerLink"],[1,"text-primary","ms-2"],[1,"w-100","d-flex","justify-content-start"],[1,"alert","alert-warning"],[3,"offsetEmitter","total","factor","initialOffset"]],template:function(o,l){o&1&&(e(0,"div",0),f(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"div",4),u("click",function(){return l.openCloseFilters()}),e(5,"h3",5),a(6,"Filtrar facturas"),i(),v(7,nt,1,0,"i",6)(8,ot,1,0,"i",7),i(),e(9,"div",8)(10,"div",9)(11,"form",10),u("ngSubmit",function(){return l.searchFormSubmit()}),e(12,"div",11)(13,"div",12)(14,"label",13),a(15,"N\xFAmero"),i(),f(16,"input",14),i()(),e(17,"div",15)(18,"button",16),a(19,"Filtrar"),i(),e(20,"button",17),u("click",function(){return l.restartFilters()}),a(21," Restablecer filtros "),i()()()()()()(),v(22,at,8,0,"div",18)(23,mt,31,1,"div",19)(24,dt,2,3,"div",20),i()),o&2&&(s(),b("primaryText","Vista de ventas")("primaryLink","/sales-overview"),s(6),_(l.filtersOpen()?7:8),s(4),b("formGroup",l.searchForm()),s(11),_(l.isLoading()?22:-1),s(),_(l.isLoading()?-1:23),s(),_(l.total()?24:-1))},dependencies:[U,P,j,G,B,z,$,Y,Q,W,X,J,R,Z,K],encapsulation:2,changeDetection:0})};export{F as default};
