import{a as b}from"./chunk-QVQJSET7.js";import{a as z}from"./chunk-2JQHP4ZC.js";import{b as N,d as P,e as R,g as q,h as $,j,u as B}from"./chunk-XXXEA7T5.js";import{t as L}from"./chunk-ZUYKIS5S.js";import{$a as T,Ab as l,G as A,Jb as a,Kb as m,Ma as c,S as I,Wa as O,ba as u,fb as h,hb as k,ia as g,ic as D,ja as f,kb as y,lb as V,na as w,nb as S,ob as _,p as E,pb as n,qb as o,rb as p,sa as M,ta as F,vb as C,wa as r,zb as x}from"./chunk-BXSYLYWC.js";var U=(i,t)=>t.code;function H(i,t){if(i&1&&(n(0,"tr")(1,"td"),a(2),o(),n(3,"td"),a(4),o()()),i&2){let e=t.$implicit;c(2),m(e.code),c(2),m(e.name)}}function J(i,t){i&1&&(n(0,"tr")(1,"td",9)(2,"div",10)(3,"p"),a(4,"Sin actividades econ\xF3micas seleccionadas por el momento"),o()()()())}function K(i,t){i&1&&(n(0,"div",6)(1,"div",11)(2,"div",12)(3,"h4",13),a(4,"Loading"),o(),p(5,"i",14),n(6,"p",15),a(7,"Cargando..."),o()()()())}function Q(i,t){if(i&1){let e=C();n(0,"tr",17),x("click",function(){let d=g(e).$implicit,v=l(2);return f(v.selectOneActivity(d))}),n(1,"td")(2,"span",18),a(3,"_"),o()(),n(4,"td"),a(5),o(),n(6,"td"),a(7),o(),n(8,"td"),a(9),o()()}if(i&2){let e=t.$implicit,s=l(2);c(2),k("activitySelected",s.activityMatch(e)),c(3),m(e.code),c(2),m(e.name),c(2),m(e.description)}}function W(i,t){if(i&1&&(n(0,"tr")(1,"td"),a(2),o()()),i&2){let e=l(2);c(2),m(e.searchMessage())}}function X(i,t){if(i&1&&(n(0,"div",7)(1,"table",1)(2,"thead"),p(3,"th"),n(4,"th"),a(5,"C\xF3digo"),o(),n(6,"th"),a(7,"Nombre"),o(),n(8,"th"),a(9,"Descripci\xF3n"),o()(),n(10,"tbody"),S(11,Q,10,5,"tr",16,U,!1,W,3,1,"tr"),o()()()),i&2){let e=l();c(11),_(e.activitiesSuggestions())}}function Y(i,t){if(i&1){let e=C();n(0,"div",8)(1,"app-pagination",19),x("offsetEmitter",function(d){g(e);let v=l();return f(v.detectChangeOffset(d))}),o()()}if(i&2){let e=l();c(),h("total",e.total())("factor",e.limit)}}var G=class i{destroyRef=u(w);economicActivityService=u(L);activityInput=F([]);activityChange=M();activitiesSuggestions=r([]);arraySelectedActivities=D(()=>this.activityInput());limit=12;offset=r(0);total=r(0);isLoading=r(!1);inputSearch=r(new q("",[]));searchMessage=r("");ngOnInit(){this.activateListenerInputChange()}findActivitiesSuggestions(t){return this.economicActivityService.getActivitiesSuggestions(t,this.limit,this.offset())}selectOneActivity(t){if(!t?.code)return;let e={code:t.code,name:t.name};this.activityMatch(t)?this.arraySelectedActivities.update(s=>s.filter(d=>d.code!==e.code)):this.arraySelectedActivities.update(s=>[...s,e]),this.activityChange.emit(this.arraySelectedActivities())}activityMatch(t){return this.arraySelectedActivities().some(e=>e.code===t.code)}detectChangeOffset(t){this.isLoading.set(!0),this.offset.set(t),this.economicActivityService.getActivitiesSuggestions(this.inputSearch().value,this.limit,this.offset()).pipe(b(this.destroyRef)).subscribe(e=>{e&&e.isValid&&(this.activitiesSuggestions.set(e.suggestions),this.total.set(e.count)),this.isLoading.set(!1)})}activateListenerInputChange(){this.inputSearch().valueChanges.pipe(b(this.destroyRef),A(500),I(t=>!t||t.length<5?(this.activitiesSuggestions.set([]),E([])):this.findActivitiesSuggestions(t))).subscribe(t=>{t?t.isValid?(this.activitiesSuggestions.set(t.suggestions),this.total.set(t.count)):(this.activitiesSuggestions.set([]),this.displaySearchMessage(Object.keys(t).some(e=>e==="isValid")?"Sin resultados para esa b\xFAsqueda":"Escribe al menos 5 caracteres para la b\xFAsqueda"),this.total.set(0)):(this.activitiesSuggestions.set([]),this.total.set(0),this.displaySearchMessage("Error de conexi\xF3n al servidor.")),this.isLoading.set(!1),this.offset.set(0)})}displaySearchMessage(t){this.searchMessage.set(t),setTimeout(()=>{this.searchMessage.set("")},3e3)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["economic-activity-select"]],inputs:{activityInput:[1,"activityInput"]},outputs:{activityChange:"activityChange"},decls:19,vars:4,consts:[[1,"mt-3"],[1,"table"],[1,"mt-5"],[1,"row"],[1,"w_100"],["type","text","placeholder","por su c\xF3digo, nombre o descripci\xF3n",1,"w_100","input_search",3,"formControl"],[1,"row","animate__animated","animate__fadeIn"],[1,"table-responsive","mt-5"],[1,"d-flex","justify-content-center","w_100","mt-4"],["colspan","3"],[1,"alert","alert-warning"],[1,"col-12"],["role","alert",1,"alert","alert-info","text-center"],[1,"alert-heading"],[1,"fa","fa-spin","fa-refresh","fa-2x"],[1,"mb-o"],[1,"row_activity"],[1,"row_activity",3,"click"],[1,"row_activity_square"],[3,"offsetEmitter","total","factor"]],template:function(e,s){e&1&&(n(0,"div",0)(1,"table",1)(2,"thead")(3,"th"),a(4,"C\xF3digo"),o(),n(5,"th"),a(6,"Nombre"),o()(),n(7,"tbody"),S(8,H,5,2,"tr",null,V,!1,J,5,0,"tr"),o()()(),n(11,"form",2)(12,"div",3)(13,"label",4),a(14,"Buscar actividad econ\xF3mica"),o(),p(15,"input",5),o()(),T(16,K,8,0,"div",6)(17,X,14,1,"div",7)(18,Y,2,2,"div",8)),e&2&&(c(8),_(s.arraySelectedActivities()),c(7),h("formControl",s.inputSearch()),c(),y(s.isLoading()?16:17),c(2),y(s.total()?18:-1))},dependencies:[B,$,N,P,R,j,z],styles:[".activitySelected[_ngcontent-%COMP%]{background-color:var(--primary_orange)}.row_activity[_ngcontent-%COMP%]{cursor:pointer;font-size:1.3rem}.row_activity[_ngcontent-%COMP%]:hover{background-color:var(--light)}.row_activity_square[_ngcontent-%COMP%]{border:2px solid var(--light);border-radius:.3rem;color:transparent;display:block;height:1.4rem;width:1.4rem}"],changeDetection:0})};export{G as a};
