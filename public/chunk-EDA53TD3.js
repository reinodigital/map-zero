import{a as le}from"./chunk-A5MLRQVF.js";import"./chunk-NOTS5ZWT.js";import{a as oe}from"./chunk-S5LKHTCT.js";import"./chunk-7FLAGI4M.js";import{a as ae}from"./chunk-4SDHRU2H.js";import{u as ee,v as te,w as ie}from"./chunk-G7SYGITX.js";import{a as y}from"./chunk-QVQJSET7.js";import{a as re}from"./chunk-T5DHTF52.js";import{a as ne}from"./chunk-P3VFXC3H.js";import{a as Z}from"./chunk-IETRKHQE.js";import{u as Y}from"./chunk-XXXEA7T5.js";import{c as J,e as K,f as Q,m as X,y as R}from"./chunk-NXK32U4M.js";import{m as G,n as z,q}from"./chunk-SF27WFEL.js";import{$a as P,Ab as s,Ba as $,Jb as i,Kb as f,Lb as S,Ma as l,Ra as H,Tb as T,Ub as B,Vb as D,Wa as k,X as j,ba as _,fb as g,hb as W,ia as C,ib as V,j as N,ja as O,kb as h,na as w,nb as A,ob as I,pb as e,qb as t,rb as p,vb as x,wa as v,zb as u}from"./chunk-BXSYLYWC.js";var pe=(r,a)=>a.entity;function ue(r,a){if(r&1){let n=x();e(0,"li",8),u("click",function(){let o=C(n).$implicit,m=s();return O(m.onSelectOption(o.entity))}),e(1,"div",9)(2,"span",10),i(3," _ "),t(),e(4,"strong",11),i(5),t(),e(6,"span",12),i(7),t()()()}if(r&2){let n=a.$implicit,d=s();l(2),W("bg_blue",d.selectedOption()===n.entity),l(3),f(n.label),l(2),f(n.text)}}var M=class r{constructor(a){this.data=a;this.purchaseOrderId.set(a.purchaseOrderId)}dialogRef=_(ee);destroyRef=_(w);router=_(K);purchaseOrderService=_(R);detailCopyPurchaseOrderToService=_(E);customToastService=_(Z);purchaseOrderId=v(null);selectedOption=v(null);arrCopyToOptions=[{entity:"PurchaseOrder",label:"Orden de compra",text:"reutiliza contenido de esta orden de compra"}];onSelectOption(a){this.selectedOption.set(a)}closePopUp(){this.dialogRef.close()}executeCopy(){if(this.selectedOption())switch(this.selectedOption()){case"PurchaseOrder":break;default:break}}generateCopyToPurchaseOrder(){let a=X(new Date);this.purchaseOrderService.copyToDraft(this.purchaseOrderId(),a).pipe(y(this.destroyRef)).subscribe(n=>{n&&n.id?(this.customToastService.add({message:"Orden de compra como borrador generada correctamente.",type:"success",duration:5e3}),this.closePopUp(),this.router.navigateByUrl(`/detail-purchase-order/${n.id}`),this.detailCopyPurchaseOrderToService.triggerCurrentPurchaseOrderHasBeenCopied(n.id)):this.customToastService.add({message:n.message,type:"error",duration:5e3})})}static \u0275fac=function(n){return new(n||r)(H(te))};static \u0275cmp=k({type:r,selectors:[["modal-copy-purchase-order-to"]],decls:13,vars:1,consts:[[1,"modal_copy_to_purchase_order","p-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"fa-solid","fa-xmark","fs-3",3,"click"],[1,"list-group"],[1,"list-group-item","list-group-item-light","cp"],[1,"d-flex","justify-content-end","w_100","gap-3","mt-5"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"list-group-item","list-group-item-light","cp",3,"click"],[1,"d-flex","align-items-center"],[1,"circle_check","me-2"],[1,"fs-5","me-2"],[1,"fs-5"]],template:function(n,d){n&1&&(e(0,"div",0)(1,"div",1)(2,"h3"),i(3,"Copiar orden de compra a"),t(),e(4,"i",2),u("click",function(){return d.closePopUp()}),t()(),e(5,"ul",3),A(6,ue,8,4,"li",4,pe),t(),e(8,"div",5)(9,"button",6),u("click",function(){return d.closePopUp()}),i(10," Cancelar "),t(),e(11,"button",7),u("click",function(){return d.executeCopy()}),i(12," Crear borrador "),t()()()),n&2&&(l(6),I(d.arrCopyToOptions),l(5),g("disabled",!d.selectedOption()))},dependencies:[Y],styles:[".form[_ngcontent-%COMP%]{padding:2rem}label[_ngcontent-%COMP%]{color:var(--black)}.header_form[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.header_form[_ngcontent-%COMP%]   .icon_close[_ngcontent-%COMP%]{font-size:2.3rem}"],changeDetection:0})};var E=class r{dialog=_(ie);_currentPurchaseOrderCopied$=new N;currentPurchaseOrderCopied$=this._currentPurchaseOrderCopied$.asObservable();displayModalCopyPurchaseOrderTo(a){this.dialog.open(M,{width:"70rem",height:"auto",autoFocus:!1,data:{purchaseOrderId:a}}).updatePosition({top:"100px"})}triggerCurrentPurchaseOrderHasBeenCopied(a){this._currentPurchaseOrderCopied$.next(a)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"})};var me=(r,a)=>a.id;function _e(r,a){if(r&1&&(e(0,"button",13),p(1,"i",40),i(2," Editar "),t()),r&2){let n=s(2);g("routerLink","/edit-purchase-order/"+n.purchaseOrderId)}}function he(r,a){if(r&1){let n=x();e(0,"button",41),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.markAsApproved(o.purchaseOrderId))}),i(1," Marcar como aprobada "),t()}}function fe(r,a){if(r&1){let n=x();e(0,"button",41),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.markAsBilled(o.purchaseOrderId))}),i(1," Marcar como pagada "),t()}}function Ce(r,a){r&1&&p(0,"div",16)}function Oe(r,a){r&1&&p(0,"i",17)}function xe(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.markAsAwaitingApproval(o.purchaseOrderId))}),p(2,"i",42),i(3," Marcar como esperando por ser aprobada "),t()()}}function ve(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.displayModalPurchaseOrderEmail(o.purchaseOrder()))}),p(2,"i",43),i(3," Enviar "),t()()}}function Se(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.markAsApproved(o.purchaseOrderId))}),p(2,"i",44),i(3," Marcar como aprobada "),t()()}}function be(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.markAsSent(o.purchaseOrderId))}),p(2,"i",45),i(3," Marcar como enviada "),t()()}}function Pe(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.undoMarkAsAwaitingApproval(o.purchaseOrderId))}),p(2,"i",46),i(3," Desmarcar como esperando a ser aprobada "),t()()}}function ge(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.undoMarkAsApproved(o.purchaseOrderId))}),p(2,"i",46),i(3," Desmarcar como aprobada "),t()()}}function Te(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.undoMarkAsBilled(o.purchaseOrderId))}),p(2,"i",46),i(3," Desmarcar como pagada "),t()()}}function ye(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.markAsBilled(o.purchaseOrderId))}),p(2,"i",47),i(3," Marcar como pagada "),t()()}}function Ee(r,a){if(r&1&&(e(0,"li")(1,"button",48),p(2,"i",49),i(3," Editar "),t()()),r&2){let n=s(2);l(),g("routerLink","/edit-purchase-order/"+n.purchaseOrderId)}}function De(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let o=s(2);return O(o.detailPurchaseOrderService.removePurchaseOrder(o.purchaseOrder()))}),p(2,"i",50),i(3," Remover "),t()()}}function we(r,a){if(r&1&&(e(0,"tr")(1,"td")(2,"span"),i(3),t()(),e(4,"td")(5,"span"),i(6),t()(),e(7,"td")(8,"span"),i(9),t()(),e(10,"td")(11,"span"),i(12),t()(),e(13,"td")(14,"span"),i(15),t()(),e(16,"td")(17,"span"),i(18),t()(),e(19,"td")(20,"span"),i(21),t()(),e(22,"td")(23,"span"),i(24),t()(),e(25,"td",51)(26,"span"),i(27),t()()()),r&2){let n,d,o,m=a.$implicit,b=s(2);l(3),f(m.item.name),l(3),f(m.description),l(3),f(m.quantity),l(3),f(m.price),l(3),f(m.discount),l(3),f((n=m.account==null?null:m.account.name)!==null&&n!==void 0?n:"_"),l(3),S(" ",b.detailPurchaseOrderService.getTaxRateLabel((d=m.taxRate)!==null&&d!==void 0?d:"")," "),l(3),f((o=m.seller==null?null:m.seller.name)!==null&&o!==void 0?o:"_"),l(3),f(m.amount)}}function ke(r,a){r&1&&(e(0,"tr",32)(1,"td",52),i(2," No existen Art\xEDculos ni servicios en esta orden de compra. "),t()())}function Ae(r,a){if(r&1){let n=x();e(0,"div",8)(1,"div",9)(2,"span",10),i(3),t(),e(4,"span"),i(5),t()(),e(6,"div",11)(7,"button",12),u("click",function(){C(n);let o=s();return O(o.downloadPDF())}),i(8," Imprimir PDF "),t(),P(9,_e,3,1,"button",13)(10,he,2,0,"button",14)(11,fe,2,0,"button",14),e(12,"div",15),P(13,Ce,1,0,"div",16)(14,Oe,1,0,"i",17),e(15,"ul",18),P(16,xe,4,0,"li")(17,ve,4,0,"li")(18,Se,4,0,"li"),e(19,"button",19),u("click",function(){C(n);let o=s();return O(o.detailCopyPurchaseOrderToService.displayModalCopyPurchaseOrderTo(o.purchaseOrderId))}),p(20,"i",20),i(21," Copiar a "),t(),P(22,be,4,0,"li")(23,Pe,4,0,"li")(24,ge,4,0,"li")(25,Te,4,0,"li")(26,ye,4,0,"li")(27,Ee,4,1,"li")(28,De,4,0,"li"),e(29,"li"),p(30,"div",21),e(31,"small",22),i(32,"Acciones"),t()()()()()(),e(33,"div",23)(34,"div",24)(35,"label"),i(36,"Cliente"),t(),e(37,"span"),i(38),t()(),e(39,"div",24)(40,"label"),i(41,"Fecha"),t(),e(42,"span"),i(43),T(44,"readableDate"),t()(),e(45,"div",24)(46,"label"),i(47,"Fecha entrega"),t(),e(48,"span"),i(49),T(50,"readableDate"),t()(),e(51,"div",24)(52,"label"),i(53,"N\xFAmero orden de compra"),t(),e(54,"span"),i(55),t()(),e(56,"div",25)(57,"label"),i(58,"Estado"),t(),e(59,"span"),i(60),t()(),e(61,"div",24)(62,"label"),i(63,"Moneda"),t(),e(64,"span"),i(65),t()()(),e(66,"div",26)(67,"table",27)(68,"thead")(69,"tr")(70,"th",28)(71,"span"),i(72,"Item"),t()(),e(73,"th",29)(74,"span"),i(75,"Descripci\xF3n"),t()(),e(76,"th",30)(77,"span"),i(78," Cantidad "),t()(),e(79,"th",30)(80,"span"),i(81,"Precio"),t()(),e(82,"th",30)(83,"span"),i(84,"Descuento"),t()(),e(85,"th",30)(86,"span"),i(87,"Cuenta"),t()(),e(88,"th",30)(89,"span"),i(90,"Impuesto"),t()(),e(91,"th",30)(92,"span"),i(93,"Vendedor"),t()(),e(94,"th",31)(95,"span"),i(96,"Monto"),t()()()(),e(97,"tbody"),A(98,we,28,9,"tr",null,me,!1,ke,3,0,"tr",32),t()()(),e(101,"div",33)(102,"div",34)(103,"ul",35)(104,"li",36)(105,"span"),i(106,"Subtotal"),t(),e(107,"span"),i(108),T(109,"number"),t()(),e(110,"li",36)(111,"span"),i(112,"Descuento total"),t(),e(113,"span",37),i(114),T(115,"number"),t()(),e(116,"li",36)(117,"span"),i(118,"Impuesto total"),t(),e(119,"span"),i(120),T(121,"number"),t()(),p(122,"div",38),e(123,"li",39)(124,"span"),i(125,"Total"),t(),e(126,"strong"),i(127),T(128,"number"),t()()()()()}if(r&2){let n,d,o,m,b,L,U,c=s();l(3),f((n=c.purchaseOrder())==null?null:n.purchaseOrderNumber),l(),V(c.detailPurchaseOrderService.getStatusBadgeFromPurchaseOrder((d=(d=c.purchaseOrder())==null?null:d.status)!==null&&d!==void 0?d:"")),l(),S(" ",(o=c.purchaseOrder())==null?null:o.status," "),l(4),h(c.allowedStatusToBeEditedFromDraft.includes(c.purchaseOrder().status)?9:-1),l(),h(c.allowedStatusToBeApproved.includes(c.purchaseOrder().status)?10:-1),l(),h(c.allowedStatusToBeBilled.includes(c.purchaseOrder().status)?11:-1),l(2),h(c.detailPurchaseOrderService.isSendEmailFromDetailComponentSubmitting()?13:14),l(3),h(c.allowedStatusToBeAwaitingApproval.includes(c.purchaseOrder().status)?16:-1),l(),h(c.allowedStatusToBeSent.includes(c.purchaseOrder().status)?17:-1),l(),h(c.allowedStatusToBeApproved.includes(c.purchaseOrder().status)?18:-1),l(4),h(c.allowedStatusToMarkAsSent.includes(c.purchaseOrder().status)?22:-1),l(),h(c.allowedStatusToUnMarkAsAwaitingApproval.includes(c.purchaseOrder().status)?23:-1),l(),h(c.allowedStatusToUnMarkAsApproved.includes(c.purchaseOrder().status)?24:-1),l(),h(c.allowedStatusToUnMarkAsBilled.includes(c.purchaseOrder().status)?25:-1),l(),h(c.allowedStatusToBeBilled.includes(c.purchaseOrder().status)?26:-1),l(),h(c.allowedStatusToBeEdited.includes(c.purchaseOrder().status)?27:-1),l(),h(c.purchaseOrder().status!=="removida"?28:-1),l(10),f((m=c.purchaseOrder())==null||m.client==null?null:m.client.name),l(5),f(B(44,31,c.purchaseOrder().initDate)),l(6),S(" ",c.purchaseOrder().deliveryDate?B(50,33,c.purchaseOrder().deliveryDate):"_"," "),l(6),S(" ",c.purchaseOrder().purchaseOrderNumber," "),l(4),V(c.detailPurchaseOrderService.getStatusBadgeFromPurchaseOrder((b=(b=c.purchaseOrder())==null?null:b.status)!==null&&b!==void 0?b:"")),l(),S(" ",(L=c.purchaseOrder())==null?null:L.status," "),l(5),S(" ",c.purchaseOrder().currency," "),l(33),I((U=c.purchaseOrder())==null?null:U.purchaseOrderItems),l(10),f(D(109,35,c.subtotal(),"1.2-2")),l(6),S(" - ",D(115,38,c.totalDiscount(),"1.2-2")," "),l(6),f(D(121,41,c.totalTax(),"1.2-2")),l(7),S(" ",D(128,44,c.totalAmount(),"1.2-2")," ")}}function Ie(r,a){if(r&1&&p(0,"tracking-entity",7),r&2){let n=s();g("tracking",n.purchaseOrder().tracking)("entity",n.entityData())}}var F=class r{platformId=_($);activatedRoute=_(J);commonAdminService=_(ne);destroyRef=_(w);purchaseOrderService=_(R);entityData=v(null);detailPurchaseOrderService=_(le);detailCopyPurchaseOrderToService=_(E);allowedStatusToBeEditedFromDraft=["borrador"];allowedStatusToBeSent=["borrador","enviada","esperando_aprobaci\xF3n","aprobada"];allowedStatusToMarkAsSent=["borrador"];allowedStatusToBeAwaitingApproval=["borrador","enviada"];allowedStatusToBeApproved=["borrador","enviada","esperando_aprobaci\xF3n"];allowedStatusToBeBilled=["aprobada"];allowedStatusToBeEdited=["borrador","enviada","esperando_aprobaci\xF3n","aprobada","pagada"];allowedStatusToUnMarkAsSent=["enviada"];allowedStatusToUnMarkAsApproved=["aprobada"];allowedStatusToUnMarkAsAwaitingApproval=["esperando_aprobaci\xF3n"];allowedStatusToUnMarkAsBilled=["pagada"];get isBrowser(){return q(this.platformId)}purchaseOrderId;purchaseOrder=v(null);subtotal=v(0);totalDiscount=v(0);totalTax=v(0);totalAmount=v(0);constructor(){this.purchaseOrderId=this.activatedRoute.snapshot.params.id,this.entityData.set({refEntity:"PurchaseOrder",refEntityId:this.purchaseOrderId})}ngOnInit(){this.fetchPurchaseOrder(),this.detailPurchaseOrderService.statusPurchaseOrderChange$.pipe(y(this.destroyRef)).subscribe(()=>{this.fetchPurchaseOrder()}),this.listenWhenCurrentPurchaseOrderHasBeenCopied()}listenWhenCurrentPurchaseOrderHasBeenCopied(){this.detailCopyPurchaseOrderToService.currentPurchaseOrderCopied$.pipe(y(this.destroyRef)).subscribe(a=>{a&&(this.purchaseOrderId=a,this.fetchPurchaseOrder())})}downloadPDF(){this.purchaseOrderService.downloadPDF(this.purchaseOrderId).subscribe(a=>{if(a){let n=URL.createObjectURL(a),d=document.createElement("a");d.href=n,d.download=`Orden-de-compra-${this.purchaseOrderId}.pdf`,d.click(),setTimeout(()=>{URL.revokeObjectURL(n),d.remove()},100)}})}fetchPurchaseOrder(){this.purchaseOrderService.fetchOne(this.purchaseOrderId).pipe(y(this.destroyRef)).subscribe(a=>{a&&a.id&&(this.purchaseOrder.set(a),this.updateTotals())})}updateTotals(){let a=this.detailPurchaseOrderService.calculateTotalsOnDetail(this.purchaseOrder()?.purchaseOrderItems??[]);this.subtotal.set(a.subtotal),this.totalDiscount.set(a.discounts),this.totalTax.set(a.iva),this.totalAmount.set(a.total)}comeBackToList(){this.commonAdminService.comeBackToList("/list-purchase-orders")}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=k({type:r,selectors:[["detail-purchase-order"]],decls:11,vars:6,consts:[[1,"main_content"],[3,"primaryText","primaryLink","secondaryText","secondaryLink"],[1,"box"],[1,"d-flex","justify-content-between","mb-3"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[3,"tracking","entity"],[1,"d-flex","justify-content-between","mb-4"],[1,"d-flex","align-items-center"],[1,"me-3"],[1,"hstack","gap-3"],[1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"routerLink"],["type","button",1,"btn","btn-primary"],[1,"dropdown"],[1,"spinner","ms-1"],["data-bs-toggle","dropdown","aria-expanded","false",1,"fa-solid","fa-ellipsis-vertical","three_points_dropdown"],[1,"dropdown-menu"],["type","button",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-clone","icon_copy_to","me-2"],[1,"line_divider","mt-3","mb-2"],[1,"ms-3","fs-4"],[1,"row","mb-5"],[1,"col-12","col-md-3","col-lg-2"],[1,"col-12","col-md-4","col-lg-3"],[1,"row","table_items"],[1,"table","table-sm","mb-3"],[1,"col-2"],[1,"col-3"],[1,"col-1"],[1,"col-1","text-end"],[1,"no-elements"],[1,"row","mt-4"],[1,"col-md-6","col-lg-4","offset-md-6","offset-lg-8"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"text-danger"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"fa-solid","fa-pen-to-square","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-file-invoice-dollar","icon_accepted","me-2"],[1,"fa-solid","fa-paper-plane","icon_sent","me-2"],[1,"fa-solid","fa-check","icon_accepted","me-2"],[1,"fa-solid","fa-marker","icon_mark_as_sent","me-2"],[1,"fa-solid","fa-repeat","icon_trash","me-2"],[1,"fa-solid","fa-xmark","icon_declined","me-2"],["type","button",1,"dropdown-item",3,"routerLink"],[1,"fa-solid","fa-pen-to-square","icon_pencil","me-2"],[1,"fa-solid","fa-trash","icon_trash","me-2"],[1,"text-end"],["colspan","12"]],template:function(n,d){n&1&&(e(0,"div",0),p(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Detalle orden de compra"),t(),e(6,"h4",5),u("click",function(){return d.comeBackToList()}),p(7,"i",6),i(8," Regresar "),t()(),P(9,Ae,129,47),t()(),P(10,Ie,1,2,"tracking-entity",7)),n&2&&(l(),g("primaryText","Vista de compras")("primaryLink","/purchases-overview")("secondaryText","Listado \xF3rdenes de compra")("secondaryLink","/list-purchase-orders"),l(8),h(d.purchaseOrder()?9:-1),l(),h(d.purchaseOrder()?10:-1))},dependencies:[z,G,Q,oe,ae,re],styles:[".table_items[_ngcontent-%COMP%]{padding-top:4rem}th[_ngcontent-%COMP%]{color:var(--text);font-size:medium;font-weight:400}.total_price[_ngcontent-%COMP%]{font-size:1.3rem;margin-bottom:.4rem}"],changeDetection:0})};export{F as default};
