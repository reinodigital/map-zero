import{a as Q}from"./chunk-EFMPC73D.js";import{a as K}from"./chunk-CF4VNIXI.js";import"./chunk-TKLSY6OB.js";import{a as J}from"./chunk-DBZ6B75W.js";import{a as H}from"./chunk-4F6HHH7Z.js";import"./chunk-DZLN3OZ3.js";import{a as T}from"./chunk-KGOR65YN.js";import{a as G}from"./chunk-4C3OHNXD.js";import"./chunk-QULINWIQ.js";import"./chunk-3MY7L4GX.js";import{J as U,i as j,j as V,k as q,p as $,s as z}from"./chunk-7DHE3FAM.js";import{Ba as L,Ib as i,Jb as d,Kb as p,La as n,Rb as _,Sb as y,Tb as C,Va as M,_a as S,ba as v,eb as E,hb as h,ia as R,ja as F,jb as x,mb as N,na as A,nb as P,ob as e,pb as t,qb as s,ub as O,wa as u,yb as g,zb as f}from"./chunk-QAVPLLNK.js";var W=(a,l)=>l.id;function X(a,l){if(a&1&&(e(0,"button",13),s(1,"i",36),i(2," Editar "),t()),a&2){let r=f(2);E("routerLink","/edit-invoice/"+r.invoiceId)}}function Y(a,l){a&1&&s(0,"div",15)}function Z(a,l){a&1&&s(0,"i",16)}function ee(a,l){if(a&1&&(e(0,"li")(1,"button",37),s(2,"i",38),i(3," Editar "),t()()),a&2){let r=f(2);n(),E("routerLink","/edit-invoice/"+r.invoiceId)}}function te(a,l){if(a&1){let r=O();e(0,"li")(1,"button",39),g("click",function(){R(r);let c=f(2);return F(c.detailInvoiceService.removeInvoice(c.invoice()))}),s(2,"i",40),i(3," Remover "),t()()}}function ie(a,l){if(a&1&&(e(0,"tr")(1,"td")(2,"span"),i(3),t()(),e(4,"td")(5,"span"),i(6),t()(),e(7,"td")(8,"span"),i(9),t()(),e(10,"td")(11,"span"),i(12),t()(),e(13,"td")(14,"span"),i(15),t()(),e(16,"td")(17,"span"),i(18),t()(),e(19,"td")(20,"span"),i(21),t()(),e(22,"td",41)(23,"span"),i(24),t()()()),a&2){let r,m,c=l.$implicit,b=f(2);n(3),d(c.item.name),n(3),d(c.description),n(3),d(c.quantity),n(3),d(c.price),n(3),d(c.discount),n(3),d((r=c.account==null?null:c.account.name)!==null&&r!==void 0?r:"_"),n(3),p(" ",b.detailInvoiceService.getTaxRateLabel((m=c.taxRate)!==null&&m!==void 0?m:"")," "),n(3),d(c.amount)}}function ne(a,l){a&1&&(e(0,"tr",28)(1,"td",42),i(2," No existen Art\xEDculos ni servicios en esta factura. "),t()())}function ae(a,l){if(a&1&&(e(0,"div",8)(1,"div",9)(2,"span",10),i(3),t(),e(4,"span"),i(5),t()(),e(6,"div",11)(7,"button",12),i(8,"Imprimir PDF"),t(),S(9,X,3,1,"button",13),e(10,"div",14),S(11,Y,1,0,"div",15)(12,Z,1,0,"i",16),e(13,"ul",17),S(14,ee,4,1,"li")(15,te,4,0,"li"),e(16,"li"),s(17,"div",18),e(18,"small",19),i(19,"Acciones"),t()()()()()(),e(20,"div",20)(21,"div",21)(22,"label"),i(23,"Cliente"),t(),e(24,"span"),i(25),t()(),e(26,"div",21)(27,"label"),i(28,"Fecha inicio"),t(),e(29,"span"),i(30),_(31,"readableDate"),t()(),e(32,"div",21)(33,"label"),i(34,"Fecha expira"),t(),e(35,"span"),i(36),_(37,"readableDate"),t()(),e(38,"div",21)(39,"label"),i(40,"N\xFAmero factura"),t(),e(41,"span"),i(42),t()(),e(43,"div",21)(44,"label"),i(45,"Moneda"),t(),e(46,"span"),i(47),t()(),e(48,"div",21)(49,"label"),i(50,"Estado"),t(),e(51,"span"),i(52),t()(),e(53,"div",21)(54,"label"),i(55,"Referencia"),t(),e(56,"span"),i(57),t()()(),e(58,"div",22)(59,"table",23)(60,"thead")(61,"tr")(62,"th",24)(63,"span"),i(64,"Item"),t()(),e(65,"th",25)(66,"span"),i(67,"Descripci\xF3n"),t()(),e(68,"th",26)(69,"span"),i(70," Cantidad "),t()(),e(71,"th",26)(72,"span"),i(73,"Precio"),t()(),e(74,"th",26)(75,"span"),i(76,"Descuento"),t()(),e(77,"th",26)(78,"span"),i(79,"Cuenta"),t()(),e(80,"th",26)(81,"span"),i(82,"Impuesto"),t()(),e(83,"th",27)(84,"span"),i(85,"Monto"),t()()()(),e(86,"tbody"),N(87,ie,25,8,"tr",null,W,!1,ne,3,0,"tr",28),t()()(),e(90,"div",29)(91,"div",30)(92,"ul",31)(93,"li",32)(94,"span"),i(95,"Subtotal"),t(),e(96,"span"),i(97),_(98,"number"),t()(),e(99,"li",32)(100,"span"),i(101,"Descuento total"),t(),e(102,"span",33),i(103),_(104,"number"),t()(),e(105,"li",32)(106,"span"),i(107,"Impuesto total"),t(),e(108,"span"),i(109),_(110,"number"),t()(),s(111,"div",34),e(112,"li",35)(113,"span"),i(114,"Total"),t(),e(115,"strong"),i(116),_(117,"number"),t()()()()()),a&2){let r,m,c,b,I,w,D,B,o=f();n(3),d((r=o.invoice())==null?null:r.invoiceNumber),n(),h(o.detailInvoiceService.getStatusBadgeFromInvoice((m=(m=o.invoice())==null?null:m.status)!==null&&m!==void 0?m:"")),n(),p(" ",(c=o.invoice())==null?null:c.status," "),n(4),x(o.allowedStatusToBeEditedFromDraft.includes(o.invoice().status)?9:-1),n(2),x(o.detailInvoiceService.isSendEmailFromDetailComponentSubmitting()?11:12),n(3),x(o.allowedStatusToBeEdited.includes(o.invoice().status)?14:-1),n(),x(o.invoice().status!=="removida"?15:-1),n(10),d((b=o.invoice())==null||b.client==null?null:b.client.name),n(5),d(y(31,22,o.invoice().initDate)),n(6),p(" ",o.invoice().expireDate?y(37,24,o.invoice().expireDate):"_"," "),n(6),p(" ",o.invoice().invoiceNumber," "),n(5),p(" ",o.invoice().currency," "),n(4),h(o.detailInvoiceService.getStatusBadgeFromInvoice((I=(I=o.invoice())==null?null:I.status)!==null&&I!==void 0?I:"")),n(),p(" ",(w=o.invoice())==null?null:w.status," "),n(5),p(" ",(D=o.invoice().reference)!==null&&D!==void 0?D:"_"," "),n(30),P((B=o.invoice())==null?null:B.invoiceItems),n(10),d(C(98,26,o.subtotal(),"1.2-2")),n(6),p(" - ",C(104,29,o.totalDiscount(),"1.2-2")," "),n(6),d(C(110,32,o.totalTax(),"1.2-2")),n(7),p(" ",C(117,35,o.totalAmount(),"1.2-2")," ")}}function oe(a,l){if(a&1&&s(0,"tracking-entity",7),a&2){let r=f();E("tracking",r.invoice().tracking)("entity",r.entityData())}}var k=class a{platformId=v(L);activatedRoute=v($);commonAdminService=v(G);destroyRef=v(A);invoiceService=v(U);detailInvoiceService=v(Q);entityData=u(null);allowedStatusToBeEditedFromDraft=["borrador"];allowedStatusToBeSent=["borrador","enviada"];allowedStatusToMarkAsSent=["borrador"];allowedStatusToBeAccepted=["enviada"];allowedStatusToBeEdited=["borrador","enviada"];get isBrowser(){return q(this.platformId)}invoiceId;invoice=u(null);subtotal=u(0);totalDiscount=u(0);totalTax=u(0);totalAmount=u(0);constructor(){this.invoiceId=this.activatedRoute.snapshot.params.id,this.entityData.set({refEntity:"Invoice",refEntityId:this.invoiceId})}ngOnInit(){this.fetchInvoice(),this.detailInvoiceService.statusChange$.pipe(T(this.destroyRef)).subscribe(()=>{this.fetchInvoice()})}fetchInvoice(){this.invoiceService.fetchOne(this.invoiceId).pipe(T(this.destroyRef)).subscribe(l=>{l&&l.id&&(this.invoice.set(l),this.updateTotals())})}updateTotals(){let l=this.detailInvoiceService.calculateTotalsOnDetail(this.invoice()?.invoiceItems??[]);this.subtotal.set(l.subtotal),this.totalDiscount.set(l.discounts),this.totalTax.set(l.iva),this.totalAmount.set(l.total)}comeBackToList(){this.commonAdminService.comeBackToList("/list-invoices")}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=M({type:a,selectors:[["detail-invoice"]],decls:11,vars:6,consts:[[1,"main_content"],[3,"primaryText","primaryLink","secondaryText","secondaryLink"],[1,"box"],[1,"d-flex","justify-content-between","mb-3"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[3,"tracking","entity"],[1,"d-flex","justify-content-between","mb-4"],[1,"d-flex","align-items-center"],[1,"me-3"],[1,"hstack","gap-3"],[1,"btn","btn-outline-secondary"],["type","button",1,"btn","btn-primary",3,"routerLink"],[1,"dropdown"],[1,"spinner","ms-1"],["data-bs-toggle","dropdown","aria-expanded","false",1,"fa-solid","fa-ellipsis-vertical","three_points_dropdown"],[1,"dropdown-menu"],[1,"line_divider","mt-3","mb-2"],[1,"ms-3","fs-4"],[1,"row","mb-5"],[1,"col-12","col-md-3","col-lg-2"],[1,"row","table_items"],[1,"table","table-sm","mb-3"],[1,"col-2"],[1,"col-3"],[1,"col-1"],[1,"col-1","text-end"],[1,"no-elements"],[1,"row","mt-4"],[1,"col-md-6","col-lg-4","offset-md-6","offset-lg-8"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"text-danger"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"fa-solid","fa-pen-to-square","me-2"],["type","button",1,"dropdown-item",3,"routerLink"],[1,"fa-solid","fa-pen-to-square","icon_pencil","me-2"],["type","button",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-trash","icon_trash","me-2"],[1,"text-end"],["colspan","12"]],template:function(r,m){r&1&&(e(0,"div",0),s(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Detalle factura"),t(),e(6,"h4",5),g("click",function(){return m.comeBackToList()}),s(7,"i",6),i(8," Regresar "),t()(),S(9,ae,118,38),t()(),S(10,oe,1,2,"tracking-entity",7)),r&2&&(n(),E("primaryText","Vista de ventas")("primaryLink","/sales-overview")("secondaryText","Listado facturas")("secondaryLink","/list-invoices"),n(8),x(m.invoice()?9:-1),n(),x(m.invoice()?10:-1))},dependencies:[V,j,z,K,J,H],styles:[".table_items[_ngcontent-%COMP%]{padding-top:4rem}th[_ngcontent-%COMP%]{color:var(--text);font-size:medium;font-weight:400}.total_price[_ngcontent-%COMP%]{font-size:1.3rem;margin-bottom:.4rem}"],changeDetection:0})};export{k as default};
