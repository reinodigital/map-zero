import{a as se,b as ue,c as de,d as pe}from"./chunk-VZG3H7ZP.js";import"./chunk-O56ZJ2SI.js";import"./chunk-GFXBF4WM.js";import{a as me,b as ce}from"./chunk-RNYAU7XE.js";import{a as E}from"./chunk-N2AJ3Z2J.js";import{a as le}from"./chunk-J2Y4HOAS.js";import{b as j,c,d as z,e as W,h as K,i as H,k as J,l as X,m as Y,n as Z,o as ee,p as te,q as ie,t as ne,u as oe}from"./chunk-ALH4IQ5M.js";import{a as ae}from"./chunk-4TAYINGZ.js";import{a as re}from"./chunk-XO5AROVW.js";import{A as U,B as y,C as $,f as O,i as P,j as R,k as G,v as V,w as B,z as L}from"./chunk-MJVO5DD5.js";import{Ba as q,C as A,Ib as n,Jb as w,Kb as x,La as l,Rb as v,Tb as b,Va as k,_a as d,ba as s,eb as _,ec as h,ia as N,ja as Q,jb as p,mb as I,na as D,nb as F,ob as t,pb as e,qb as m,ub as M,wa as g,yb as f,zb as C}from"./chunk-54LR7GFL.js";var _e=(a,i)=>i.id,Se=(a,i)=>i.code;function he(a,i){a&1&&(t(0,"small",12),n(1," cliente es requerido "),e())}function ve(a,i){a&1&&(t(0,"small",12),n(1," fecha inicio es requerida "),e())}function be(a,i){a&1&&(t(0,"small",12),n(1," item es requerido "),e())}function ge(a,i){a&1&&(t(0,"small",12),n(1," cantidad debe ser > 0 "),e())}function Ce(a,i){a&1&&(t(0,"small",12),n(1," precio incorrecto "),e())}function we(a,i){if(a&1&&(t(0,"option",54),n(1),e()),a&2){let o=i.$implicit;_("value",o.id),l(),x(" ",`${o.code} - ${o.name}`," ")}}function xe(a,i){a&1&&(t(0,"small",12),n(1," contabilidad es requerido "),e())}function Ee(a,i){if(a&1&&(t(0,"option",54),n(1),e()),a&2){let o=i.$implicit;_("value",o.code),l(),w(o.label)}}function Ne(a,i){a&1&&(t(0,"small",12),n(1," impuesto es requerido "),e())}function Qe(a,i){if(a&1){let o=M();t(0,"tr",46)(1,"td")(2,"custom-select",47),f("itemSelectedEmitter",function(u){let S=N(o).index,fe=C();return Q(fe.onItemSelectedInRow(u,S))}),e(),d(3,be,2,0,"small",12),e(),t(4,"td"),m(5,"textarea",48),e(),t(6,"td"),m(7,"input",49),d(8,ge,2,0,"small",12),e(),t(9,"td"),m(10,"input",50),d(11,Ce,2,0,"small",12),e(),t(12,"td"),m(13,"input",51),e(),t(14,"td")(15,"select",52)(16,"option",53),n(17,"--Seleccione--"),e(),I(18,we,2,2,"option",54,_e),e(),d(20,xe,2,0,"small",12),e(),t(21,"td")(22,"select",55),I(23,Ee,2,2,"option",54,Se),e(),d(25,Ne,2,0,"small",12),e(),t(26,"td"),m(27,"ng-select",56),e(),t(28,"td")(29,"button",57),f("click",function(){let u=N(o).index,S=C();return Q(S.removeQuoteItem(u))}),m(30,"i",58),e()()()}if(a&2){let o=i.index,r=C();_("formGroupName",o)("id","row_"+o),l(3),p(r.validField("quoteItems."+o+".itemId")?3:-1),l(5),p(r.validField("quoteItems."+o+".quantity")?8:-1),l(3),p(r.validField("quoteItems."+o+".price")?11:-1),l(7),F(r.accounts()),l(2),p(r.validField("quoteItems."+o+".accountId")?20:-1),l(3),F(r.taxRates),l(2),p(r.validField("quoteItems."+o+".taxRate")?25:-1),l(2),_("items",r.sellers())("searchable",!0)}}function Ie(a,i){a&1&&(t(0,"tr",25)(1,"td",59)(2,"small"),n(3,' No se ha a\xF1adido fila, presione "Agregar fila" para incluir algunos. '),e()()())}function Fe(a,i){a&1&&(t(0,"div",41),n(1," Enviando "),m(2,"div",60),e())}function ye(a,i){a&1&&n(0," Enviar ")}var T=class a{platformId=s(q);fb=s(ne);destroyRef=s(D);authService=s(V);accountService=s(B);commonAdminService=s(ae);clientService=s(L);formErrorService=s(le);customToastService=s(re);sellers=g([]);accounts=g([]);formNewQuoteService=s(se);isFormSubmitting=h(()=>this.formNewQuoteService.isFormSubmitting());taxRates=$;clients=g([]);newQuoteForm=this.fb.group({client:[null,[c.required]],initDate:[this.currentDate,[c.required]],expireDate:[this.dateInSevenDay,[]],currency:["USD",[c.required]],terms:["",[]],quoteItems:this.fb.array([this.createQuoteItemFormGroup(),this.createQuoteItemFormGroup()])});subtotal=h(()=>this.formNewQuoteService.subtotal());totalDiscount=h(()=>this.formNewQuoteService.totalDiscount());totalTax=h(()=>this.formNewQuoteService.totalTax());totalAmount=h(()=>this.formNewQuoteService.totalAmount());get isBrowser(){return G(this.platformId)}get currentDate(){return y(new Date)}get dateInSevenDay(){let i=new Date,o=new Date(new Date().setDate(i.getDate()+7));return y(o)}ngOnInit(){this.formNewQuoteService.cleanTotalValues(),this.fetchAllShortClients(),this.fetchSellers(),this.fetchAccounts(),this.quoteItems.controls.forEach(i=>{this.setupItemGroupValueChangeListener(i)})}fetchAccounts(){this.accountService.fetchAll(999,0,{}).pipe(E(this.destroyRef)).subscribe(i=>{i&&i.accounts&&this.accounts.set(i.accounts)})}fetchAllShortClients(){this.clientService.fetchAllShortClients().pipe(E(this.destroyRef)).subscribe(i=>{i&&this.clients.set(i)})}fetchSellers(){this.authService.fetchAllSellers().subscribe(i=>{i&&i.length&&this.sellers.set(i)})}validField(i){let o=this.newQuoteForm.get(i);return o?o.touched&&o.invalid:!1}onExpireDateChange(i){this.newQuoteForm.controls.expireDate.patchValue(i)}get quoteItems(){return this.newQuoteForm.get("quoteItems")}createQuoteItemFormGroup(){let i=this.fb.group({itemId:[null,[c.required]],sellerUid:[null,[]],description:["",[]],quantity:[1,[c.required,c.min(1)]],price:["",[c.required]],discount:[0,[]],accountId:["",[c.required,c.minLength(1)]],taxRate:["08",[c.required,,c.minLength(1)]]});return this.setupItemGroupValueChangeListener(i),i}addQuoteItem(){this.quoteItems.push(this.createQuoteItemFormGroup()),this.formNewQuoteService.calculateTotals(this.quoteItems)}removeQuoteItem(i){this.quoteItems.removeAt(i),this.formNewQuoteService.calculateTotals(this.quoteItems)}setupItemGroupValueChangeListener(i){i.valueChanges.pipe(E(this.destroyRef),A(o=>o.quantity!==null&&o.price!==null&&o.discount!==null)).subscribe(()=>{this.formNewQuoteService.calculateTotals(this.quoteItems)})}onItemSelectedInRow(i,o){let r=this.quoteItems.at(o);r&&i&&(r.patchValue({description:i.description||"",price:i.salePrice??0,accountId:i.saleAccountId??""}),this.formNewQuoteService.calculateTotals(this.quoteItems))}onCustomSubmitBtnClicked(i){this.callToAction(i)}callToAction(i){if(this.formErrorService.throwFormErrors(this.newQuoteForm),!this.formNewQuoteService.verifyQuoteItems(this.quoteItems)){this.customToastService.add({message:"Uno o m\xE1s items tienen error.",type:"error",duration:6e3});return}if(!this.newQuoteForm.controls.client.value){this.customToastService.add({message:"Seleccione un cliente para continuar.",type:"error",duration:6e3});return}if(this.newQuoteForm.invalid){this.formErrorService.throwFormErrors(this.newQuoteForm);return}let o=this.newQuoteForm.value;switch(o.createdAt=U(new Date),i){case"save":o.status="borrador",o.action="save",this.formNewQuoteService.onSaveAction(o);break;case"mark_as_sent":o.status="enviada",o.action="mark_as_sent",this.formNewQuoteService.onSaveAction(o);break;case"send":o.status="borrador",o.action="send",this.formNewQuoteService.handleCreateOrEditQuoteSendingEmailAsWell(o);break;default:break}}comeBackToList(){this.commonAdminService.comeBackToList("/list-quotes")}static \u0275fac=function(o){return new(o||a)};static \u0275cmp=k({type:a,selectors:[["new-quote"]],decls:124,vars:26,consts:[[1,"main_content"],[1,"box"],[1,"d-flex","justify-content-between"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"form",3,"formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","defaultSeller"],[1,"asterisk"],["bindLabel","name","placeholder","--Seleccione--","formControlName","client",3,"items","searchable"],[1,"text-danger"],["for","initDate",1,"w_100"],["type","date","formControlName","initDate"],["for","expireDate",1,"w_100"],[1,"muted"],[3,"dateChanged"],["formControlName","currency"],["value","USD"],[1,"table","table-sm","mb-3","mt-5"],[1,"col-2"],[1,"col-1"],["formArrayName","quoteItems"],[3,"formGroupName","id",4,"ngFor","ngForOf"],[1,"no-elements"],["type","button",1,"btn","btn-sm","btn-outline-primary","mt-2",3,"click"],[1,"fa","fa-plus"],[1,"row","mt-4"],[1,"col-md-6","offset-md-6"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"col-12"],["for","description"],["formControlName","terms","rows","2",1,"w_100"],[1,"d-flex","align-items-center","mt-4"],["primaryText","Guardar","secondaryText","Guardando",3,"btnWasClicked","isFormSubmitting","buttonAction"],[1,"input-group","ms-3"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"d-flex","align-items-center"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-outline-secondary","dropdown-toggle","dropdown-toggle-split"],[1,"visually-hidden"],[1,"dropdown-menu"],[1,"dropdown-item","cp",3,"click"],[3,"formGroupName","id"],["formControlName","itemId",3,"itemSelectedEmitter"],["formControlName","description","rows","1"],["type","number","formControlName","quantity"],["type","number","formControlName","price"],["type","number","formControlName","discount","placeholder","%"],["formControlName","accountId"],["value",""],[3,"value"],["formControlName","taxRate"],["bindLabel","name","bindValue","uid","placeholder","--Seleccione--","formControlName","sellerUid",3,"items","searchable"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"fa","fa-trash"],["colspan","4"],[1,"spinner","ms-2"]],template:function(o,r){o&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),n(4,"Nueva cotizaci\xF3n"),e(),t(5,"h4",4),f("click",function(){return r.comeBackToList()}),m(6,"i",5),n(7," Regresar "),e()(),t(8,"form",6)(9,"div",7)(10,"div",8)(11,"label",9),n(12," Cliente "),t(13,"span",10),n(14,"*"),e()(),m(15,"ng-select",11),d(16,he,2,0,"small",12),e(),t(17,"div",8)(18,"label",13),n(19," Fecha inicio "),t(20,"span",10),n(21,"*"),e()(),m(22,"input",14),d(23,ve,2,0,"small",12),e(),t(24,"div",8)(25,"label",15),n(26," Fecha expira "),t(27,"span",16),n(28,"opcional"),e()(),t(29,"quick-date-picker",17),f("dateChanged",function(S){return r.onExpireDateChange(S)}),e()(),t(30,"div",8)(31,"label",15),n(32," Moneda "),t(33,"span",10),n(34,"*"),e()(),t(35,"select",18)(36,"option",19),n(37,"USD"),e()()()(),t(38,"table",20)(39,"thead")(40,"tr")(41,"th",21)(42,"label"),n(43,"Item"),e()(),t(44,"th",21)(45,"label"),n(46,"Descripci\xF3n"),e()(),t(47,"th",22)(48,"label"),n(49," Cantidad "),e()(),t(50,"th",22)(51,"label"),n(52,"Precio"),e()(),t(53,"th",22)(54,"label"),n(55,"Descuento (%)"),e()(),t(56,"th",22)(57,"label"),n(58,"Cuenta"),e()(),t(59,"th",22)(60,"label"),n(61,"Impuesto"),e()(),t(62,"th",22)(63,"label"),n(64,"Vendedor"),e()(),m(65,"th",22),e()(),t(66,"tbody",23),d(67,Qe,31,9,"tr",24)(68,Ie,4,0,"tr",25),e()(),t(69,"button",26),f("click",function(){return r.addQuoteItem()}),m(70,"i",27),n(71," Agregar fila "),e(),t(72,"div",28)(73,"div",29)(74,"ul",30)(75,"li",31)(76,"span"),n(77,"Subtotal"),e(),t(78,"span"),n(79),v(80,"number"),e()(),t(81,"li",31)(82,"span"),n(83,"Descuento total"),e(),t(84,"span",12),n(85),v(86,"number"),e()(),t(87,"li",31)(88,"span"),n(89,"Impuesto total"),e(),t(90,"span"),n(91),v(92,"number"),e()(),m(93,"div",32),t(94,"li",33)(95,"span")(96,"span"),n(97,"Total"),e()(),t(98,"strong"),n(99),v(100,"number"),e()()()()(),t(101,"div",7)(102,"div",34)(103,"label",35),n(104," T\xE9rminos "),t(105,"span",16),n(106,"opcional"),e()(),m(107,"textarea",36),e()(),t(108,"div",37)(109,"submit-button",38),f("btnWasClicked",function(S){return r.onCustomSubmitBtnClicked(S)}),e(),t(110,"div",39)(111,"button",40),f("click",function(){return r.callToAction(r.formNewQuoteService.sendAction)}),d(112,Fe,3,0,"div",41)(113,ye,1,0),e(),t(114,"button",42)(115,"span",43),n(116,"Toggle Dropdown"),e()(),t(117,"ul",44)(118,"li")(119,"a",45),f("click",function(){return r.callToAction(r.formNewQuoteService.sendAction)}),n(120," Enviar "),e()(),t(121,"li")(122,"a",45),f("click",function(){return r.callToAction(r.formNewQuoteService.markAsSentAction)}),n(123," Marcar como enviada "),e()()()()()()()()),o&2&&(l(8),_("formGroup",r.newQuoteForm),l(7),_("items",r.clients())("searchable",!0),l(),p(r.validField("clientId")?16:-1),l(7),p(r.validField("initDate")?23:-1),l(44),_("ngForOf",r.quoteItems.controls),l(),p(r.quoteItems.value.length?-1:68),l(11),w(b(80,14,r.subtotal(),"1.2-2")),l(6),x(" - ",b(86,17,r.totalDiscount(),"1.2-2")," "),l(6),w(b(92,20,r.totalTax(),"1.2-2")),l(8),x(" ",b(100,23,r.totalAmount(),"1.2-2")," "),l(10),_("isFormSubmitting",r.isFormSubmitting())("buttonAction",r.formNewQuoteService.saveAction),l(3),p(r.formNewQuoteService.isFormNewQuoteAndEmailSubmitting()?112:113))},dependencies:[R,O,P,ue,oe,K,te,ie,j,H,ee,z,W,J,Z,X,Y,ce,me,de,pe],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.5rem;text-align:left;border:1px solid #ddd}td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], td[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]{display:block;width:100%;height:100%;padding:.5rem;margin:0;border:none;background-color:transparent;box-sizing:border-box;font-size:inherit}td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]{border:none!important;background-color:transparent!important;height:100%;display:flex;align-items:center}td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]   .ng-value-wrapper[_ngcontent-%COMP%]{padding:.5rem 0}td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]   .ng-input[_ngcontent-%COMP%]{padding:.5rem 0}td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, td[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]:focus-within{outline:none}.total_price[_ngcontent-%COMP%]{font-size:1.4rem;margin-bottom:.4rem}"],changeDetection:0})};export{T as default};
