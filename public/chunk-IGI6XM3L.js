import{a as S}from"./chunk-N2AJ3Z2J.js";import{a as A}from"./chunk-Y5YTRTSY.js";import{b as P,d as L,e as N,g as R,h as q,j,u as $}from"./chunk-TUWVJ4C7.js";import{y as k}from"./chunk-SQGBK3PG.js";import{G as v,Ib as a,Jb as m,La as o,S as w,Va as O,_a as F,ba as b,eb as y,gb as T,ia as g,ja as f,jb as h,mb as V,na as E,nb as D,ob as i,p as x,pb as s,qb as p,sa as I,ta as M,ub as C,wa as c,yb as _,zb as d}from"./chunk-54LR7GFL.js";var G=(n,e)=>e.code;function U(n,e){n&1&&(i(0,"div",5)(1,"div",8)(2,"div",9)(3,"h4",10),a(4,"Loading"),s(),p(5,"i",11),i(6,"p",12),a(7,"Cargando..."),s()()()())}function z(n,e){if(n&1){let t=C();i(0,"tr",15),_("click",function(){let l=g(t).$implicit,u=d(2);return f(u.selectOneCabys(l.code))}),i(1,"td")(2,"span",16),a(3,"_"),s()(),i(4,"td"),a(5),s(),i(6,"td"),a(7),s(),i(8,"td"),a(9),s()()}if(n&2){let t=e.$implicit,r=d(2);o(2),T("cabysSelected",r.selectedCabys()===t.code),o(3),m(t.code),o(2),m(t.description),o(2),m(t.tax)}}function H(n,e){if(n&1&&(i(0,"tr")(1,"td"),a(2),s()()),n&2){let t=d(2);o(2),m(t.searchMessage())}}function J(n,e){if(n&1&&(i(0,"div",6)(1,"table",13)(2,"thead"),p(3,"th"),i(4,"th"),a(5,"Cabys"),s(),i(6,"th"),a(7,"Descripci\xF3n"),s(),i(8,"th"),a(9,"Impuesto"),s()(),i(10,"tbody"),V(11,z,10,5,"tr",14,G,!1,H,3,1,"tr"),s()()()),n&2){let t=d();o(11),D(t.cabysSuggestions())}}function K(n,e){if(n&1){let t=C();i(0,"div",7)(1,"app-pagination",17),_("offsetEmitter",function(l){g(t);let u=d();return f(u.detectChangeOffset(l))}),s()()}if(n&2){let t=d();o(),y("total",t.total())("factor",t.limit)}}var B=class n{destroyRef=b(E);cabysService=b(k);cabysInput=M(null);cabysChange=I();cabysSuggestions=c([]);selectedCabys=c(null);limit=12;offset=c(0);total=c(0);isLoading=c(!1);inputSearch=c(new R("",[]));searchMessage=c("");ngOnInit(){this.onInputChange(),this.selectedCabys.set(this.cabysInput())}findCabysSuggestions(e){return this.cabysService.getCabysSuggestions(e,this.limit,this.offset())}selectOneCabys(e){this.selectedCabys()!==e&&(this.selectedCabys.set(e),this.cabysChange.emit(e))}detectChangeOffset(e){this.isLoading.set(!0),this.offset.set(e),this.cabysService.getCabysSuggestions(this.inputSearch().value,this.limit,this.offset()).pipe(S(this.destroyRef)).subscribe(t=>{t&&t.isValid&&(this.cabysSuggestions.set(t.suggestions),this.total.set(t.count)),this.isLoading.set(!1)})}onInputChange(){this.inputSearch().valueChanges.pipe(S(this.destroyRef),v(500),w(e=>!e||e.length<5?(this.cabysSuggestions.set([]),x([])):this.findCabysSuggestions(e))).subscribe(e=>{e?e.isValid?(this.cabysSuggestions.set(e.suggestions),this.total.set(e.count)):(this.cabysSuggestions.set([]),this.displaySearchMessage(Object.keys(e).some(t=>t==="isValid")?"Sin resultados para esa b\xFAsqueda":"Escribe al menos 5 caracteres para la b\xFAsqueda"),this.total.set(0)):(this.cabysSuggestions.set([]),this.total.set(0),this.displaySearchMessage("Error de conexi\xF3n al servidor.")),this.isLoading.set(!1),this.offset.set(0)})}displaySearchMessage(e){this.searchMessage.set(e),setTimeout(()=>{this.searchMessage.set("")},3e3)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=O({type:n,selectors:[["cabys-select"]],inputs:{cabysInput:[1,"cabysInput"]},outputs:{cabysChange:"cabysChange"},decls:13,vars:4,consts:[[1,"row"],[1,"w_100"],["type","text","placeholder","por su c\xF3digo o su descripci\xF3n",1,"w_100","input_search",3,"formControl"],[1,"mt-5"],[1,"badge","bg-success"],[1,"row","animate__animated","animate__fadeIn"],[1,"table-responsive","mt-5"],[1,"d-flex","justify-content-center","w_100","mt-4"],[1,"col-12"],["role","alert",1,"alert","alert-info","text-center"],[1,"alert-heading"],[1,"fa","fa-spin","fa-refresh","fa-2x"],[1,"mb-o"],[1,"table","table-bordered"],[1,"row_cabys"],[1,"row_cabys",3,"click"],[1,"row_cabys_square"],[3,"offsetEmitter","total","factor"]],template:function(t,r){if(t&1&&(i(0,"form")(1,"div",0)(2,"label",1),a(3,"Buscar cabys "),s(),p(4,"input",2),s()(),i(5,"div",3)(6,"h4"),a(7," Cabys seleccionado: "),i(8,"span",4),a(9),s()()(),F(10,U,8,0,"div",5)(11,J,14,1,"div",6)(12,K,2,2,"div",7)),t&2){let l;o(4),y("formControl",r.inputSearch()),o(5),m((l=r.selectedCabys())!==null&&l!==void 0?l:"_"),o(),h(r.isLoading()?10:11),o(2),h(r.total()?12:-1)}},dependencies:[$,q,P,L,N,j,A],styles:[".cabysSelected[_ngcontent-%COMP%]{background-color:var(--primary_orange)}.row_cabys[_ngcontent-%COMP%]{cursor:pointer}.row_cabys[_ngcontent-%COMP%]:hover{background-color:var(--light)}.row_cabys_square[_ngcontent-%COMP%]{border:2px solid var(--light);border-radius:.3rem;color:transparent;display:block;height:1.4rem;width:1.4rem}"],changeDetection:0})};export{B as a};
