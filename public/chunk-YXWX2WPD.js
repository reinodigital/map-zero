import{a as tt}from"./chunk-ADPLVDJ6.js";import{a as J,b as K,c as Q,d as X}from"./chunk-ADBCP3CC.js";import{a as Z}from"./chunk-S5LKHTCT.js";import"./chunk-7FLAGI4M.js";import"./chunk-G7SYGITX.js";import{a as q}from"./chunk-QVQJSET7.js";import{a as U}from"./chunk-2JQHP4ZC.js";import{a as H}from"./chunk-WLTKHXUG.js";import"./chunk-IETRKHQE.js";import{b as V,d as G,e as j,h as B,k as W,n as z,t as Y,u as $}from"./chunk-XXXEA7T5.js";import{f as M,w as R}from"./chunk-RV3QXS3Q.js";import"./chunk-SF27WFEL.js";import{$a as d,Ab as c,Jb as o,Kb as p,Lb as x,Ma as l,Tb as P,Ub as k,Wa as w,X as F,a as A,b as L,ba as f,fb as v,gc as T,ia as g,ib as N,ja as C,kb as _,na as y,nb as D,ob as O,pb as e,qb as i,rb as u,vb as S,wa as r,zb as b}from"./chunk-BXSYLYWC.js";var I=class t{lastOffsetInvoicesList=r(0);selectedTabIndex=r(0);statusByIndexMap={0:"",1:"borrador",2:"esperando_aprobaci\xF3n",3:"esperando_pago",4:"pagada"};static \u0275fac=function(a){return new(a||t)};static \u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"})};var nt=(t,n)=>n.id;function at(t,n){t&1&&u(0,"i",6)}function ot(t,n){t&1&&u(0,"i",7)}function lt(t,n){t&1&&(e(0,"div",18)(1,"div",21)(2,"div",22)(3,"h4",23),o(4,"Loading"),i(),u(5,"i",24),e(6,"p",25),o(7,"Cargando..."),i()()()())}function st(t,n){if(t&1&&(o(0," Todas "),e(1,"span",34),o(2),i()),t&2){let a=c(2);l(2),p(a.totalAll())}}function rt(t,n){if(t&1&&(o(0," Borrador "),e(1,"span",34),o(2),i()),t&2){let a=c(2);l(2),p(a.totalDraft())}}function ct(t,n){if(t&1&&(o(0," Esperando aprobaci\xF3n "),e(1,"span",34),o(2),i()),t&2){let a=c(2);l(2),x(" ",a.totalAwaitingApproval()," ")}}function mt(t,n){if(t&1&&(o(0," Esperando pago "),e(1,"span",34),o(2),i()),t&2){let a=c(2);l(2),x(" ",a.totalAwaitingPayment()," ")}}function dt(t,n){if(t&1&&(o(0," Pagadas "),e(1,"span",34),o(2),i()),t&2){let a=c(2);l(2),p(a.totalPaid())}}function pt(t,n){if(t&1&&(e(0,"tr",33)(1,"td"),o(2),i(),e(3,"td"),o(4),i(),e(5,"td"),o(6),P(7,"readableDate"),i(),e(8,"td")(9,"span"),o(10),i()(),e(11,"td"),o(12),i()()),t&2){let a,s=n.$implicit,m=c(2);v("routerLink","/detail-invoice/"+s.id),l(2),p(s.invoiceNumber),l(2),p(s.client.name),l(2),p(k(7,8,s.initDate)),l(3),N(m.detailInvoiceService.getStatusBadgeFromInvoice((a=s==null?null:s.status)!==null&&a!==void 0?a:"")),l(),x(" ",s==null?null:s.status," "),l(2),p(s.total)}}function ft(t,n){if(t&1&&(e(0,"tr")(1,"div",35)(2,"div",36),o(3),i()()()),t&2){let a=c(2);l(3),x(" ",a.isActiveFilters()?"Sin resultados para esa b\xFAsqueda":"No existen facturas por el momento en el sistema"," ")}}function vt(t,n){if(t&1){let a=S();e(0,"div",19)(1,"div",3)(2,"div",11)(3,"div",26)(4,"h3"),o(5,"Facturas"),i(),e(6,"button",27),o(7," + Nueva factura "),i()(),e(8,"mat-tab-group",28),b("selectedTabChange",function(m){g(a);let h=c();return C(h.onTabChange(m))}),e(9,"mat-tab"),d(10,st,3,1,"ng-template",29),i(),e(11,"mat-tab"),d(12,rt,3,1,"ng-template",29),i(),e(13,"mat-tab"),d(14,ct,3,1,"ng-template",29),i(),e(15,"mat-tab"),d(16,mt,3,1,"ng-template",29),i(),e(17,"mat-tab"),d(18,dt,3,1,"ng-template",29),i()(),e(19,"div",30)(20,"table",31)(21,"thead")(22,"tr")(23,"th"),o(24,"N\xFAmero"),i(),e(25,"th"),o(26,"Cliente"),i(),e(27,"th"),o(28,"Fecha inicio"),i(),e(29,"th"),o(30,"Estado"),i(),e(31,"th"),o(32,"Pago total"),i()()(),e(33,"tbody",32),D(34,pt,13,10,"tr",33,nt,!1,ft,4,1,"tr"),i()()()()()()}if(t&2){let a=c();l(8),v("selectedIndex",a.selectedTabIndex()),l(26),O(a.invoices())}}function ut(t,n){if(t&1){let a=S();e(0,"div",20)(1,"app-pagination",37),b("offsetEmitter",function(m){g(a);let h=c();return C(h.detectChangeOffset(m))}),i()()}if(t&2){let a=c();l(),v("total",a.total())("factor",a.limit)("initialOffset",a.offset())}}var E=class t{fb=f(Y);destroyRef=f(y);invoiceService=f(R);detailInvoiceService=f(tt);listInvoicesService=f(I);invoices=r([]);limit=10;offset=T(()=>this.listInvoicesService.lastOffsetInvoicesList());total=r(0);isLoading=r(!0);totalAll=r(0);totalDraft=r(0);totalAwaitingApproval=r(0);totalAwaitingPayment=r(0);totalPaid=r(0);invoiceStatusFilter=r("");filtersOpen=r(!1);filters=r({});isActiveFilters=r(!1);searchForm=r(this.fb.group({invoiceNumber:["",[]]}));selectedTabIndex=T(()=>this.listInvoicesService.selectedTabIndex());ngOnInit(){this.fetchAllItems()}fetchAllItems(){this.filters.set(L(A({},this.filters()),{status:this.listInvoicesService.statusByIndexMap[this.selectedTabIndex()]})),this.invoiceService.fetchAll(this.limit,this.offset(),this.filters()).pipe(q(this.destroyRef)).subscribe(n=>{n&&n.count>=0&&(this.total.set(n.count),this.invoices.set(n.invoices),this.totalAll.set(n.total),this.fillOutStatusInvoice(n.statusCounts??null)),this.isLoading.set(!1)})}fillOutStatusInvoice(n){n&&(this.totalDraft.set(n.borrador??0),this.totalAwaitingApproval.set(n.esperando_aprobaci\u00F3n??0),this.totalAwaitingPayment.set(n.esperando_pago??0),this.totalPaid.set(n.pagada??0))}openCloseFilters(){this.filtersOpen.set(!this.filtersOpen())}onTabChange(n){this.listInvoicesService.selectedTabIndex.set(n.index),this.listInvoicesService.lastOffsetInvoicesList.set(0),this.fetchAllItems()}searchFormSubmit(){this.filters.set(this.searchForm().value),this.listInvoicesService.lastOffsetInvoicesList.set(0),this.isActiveFilters.set(!0),this.fetchAllItems()}restartFilters(){this.listInvoicesService.lastOffsetInvoicesList.set(0),this.isActiveFilters.set(!1),this.filters.set({}),this.listInvoicesService.selectedTabIndex.set(0),this.searchForm().reset(),this.fetchAllItems()}detectChangeOffset(n){this.isLoading.set(!0),this.listInvoicesService.lastOffsetInvoicesList.set(n),this.fetchAllItems()}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=w({type:t,selectors:[["list-invoices"]],decls:25,vars:7,consts:[[1,"main_content"],[3,"primaryText","primaryLink"],[1,"filters","mb-4"],[1,"box"],["data-bs-toggle","collapse","data-bs-target","#collapseFilters","aria-expanded","false","aria-controls","collapseFilters",1,"d-flex","justify-content-between","align-items-center","cp","mb-2",3,"click"],[1,"mb-0"],[1,"fa-solid","fa-window-minimize"],[1,"fa-solid","fa-window-maximize"],["id","collapseFilters",1,"collapse"],[1,"card","card-body"],["autocomplete","off",1,"search_form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],["type","text","formControlName","invoiceNumber"],[1,"d-flex","justify-content-start","mt-4"],["type","submit",1,"btn","btn-success"],["type","button",1,"btn","btn-light","ms-2",3,"click"],[1,"row","animate__animated","animate__fadeIn"],[1,"table_clients"],[1,"d-flex","justify-content-center","w_100","mt-4"],[1,"col-12"],["role","alert",1,"alert","alert-info","text-center"],[1,"alert-heading"],[1,"fa","fa-spin","fa-refresh","fa-2x"],[1,"mb-o"],[1,"d-flex","justify-content-between","mb-3"],["routerLink","/new-invoice",1,"btn","btn-primary","mb-2"],[1,"mt-4","mb-3",3,"selectedTabChange","selectedIndex"],["mat-tab-label",""],[1,"table-responsive"],[1,"table"],[1,"animate__animated","animate__fadeIn"],[1,"admin_tr",3,"routerLink"],[1,"text-primary","ms-2"],[1,"w-100","d-flex","justify-content-start"],[1,"alert","alert-warning"],[3,"offsetEmitter","total","factor","initialOffset"]],template:function(a,s){a&1&&(e(0,"div",0),u(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"div",4),b("click",function(){return s.openCloseFilters()}),e(5,"h3",5),o(6,"Filtrar facturas"),i(),d(7,at,1,0,"i",6)(8,ot,1,0,"i",7),i(),e(9,"div",8)(10,"div",9)(11,"form",10),b("ngSubmit",function(){return s.searchFormSubmit()}),e(12,"div",11)(13,"div",12)(14,"label",13),o(15,"N\xFAmero"),i(),u(16,"input",14),i()(),e(17,"div",15)(18,"button",16),o(19,"Filtrar"),i(),e(20,"button",17),b("click",function(){return s.restartFilters()}),o(21," Restablecer filtros "),i()()()()()()(),d(22,lt,8,0,"div",18)(23,vt,37,2,"div",19)(24,ut,2,3,"div",20),i()),a&2&&(l(),v("primaryText","Vista de ventas")("primaryLink","/sales-overview"),l(6),_(s.filtersOpen()?7:8),l(4),v("formGroup",s.searchForm()),l(11),_(s.isLoading()?22:-1),l(),_(s.isLoading()?-1:23),l(),_(s.total()?24:-1))},dependencies:[$,B,V,G,j,W,z,X,J,K,Q,U,M,Z,H],encapsulation:2,changeDetection:0})};export{E as default};
