import{a as J}from"./chunk-RR4UJ4H3.js";import{a as z,b as W}from"./chunk-RZK5OI6K.js";import"./chunk-KGOR65YN.js";import"./chunk-YRVU5RW6.js";import{a as G}from"./chunk-NEVGVLEA.js";import{a as j}from"./chunk-U4TVSC3Q.js";import{a as U}from"./chunk-QULINWIQ.js";import{b as D,c as o,d as w,e as R,h as O,k as V,n as L,o as k,p as M,q as P,t as q,u as B}from"./chunk-SRQMAJVA.js";import{A,k as _,p as F,r as T,v as N,z as I}from"./chunk-7OFENO7U.js";import{Ba as x,Ib as t,La as c,Va as y,_a as p,ba as r,eb as f,ia as b,ja as h,jb as u,ob as e,pb as i,qb as s,ub as g,wa as v,yb as C,zb as S}from"./chunk-QAVPLLNK.js";function $(a,n){a&1&&(e(0,"small",19),t(1," nombre debe tener m\xE1s de 2 caracteres "),i())}function H(a,n){a&1&&(e(0,"small",19),t(1," tel\xE9fono debe ser un n\xFAmero de 8 d\xEDgitos "),i())}function K(a,n){a&1&&(e(0,"small",19),t(1," formato incorrecto de correo "),i())}function Q(a,n){a&1&&(e(0,"small",19),t(1," c\xE9dula debe tener enter 9 a 12 caracteres "),i())}function Y(a,n){if(a&1){let l=g();e(0,"div",11)(1,"div",12)(2,"form",13),C("ngSubmit",function(){b(l);let d=S();return h(d.onSubmit())}),e(3,"div",14)(4,"div",15)(5,"label",16),t(6,"Nombre "),e(7,"span",17),t(8,"*"),i()(),s(9,"input",18),p(10,$,2,0,"small",19),i(),e(11,"div",15)(12,"label",20),t(13," Tipo contacto "),e(14,"span",17),t(15,"*"),i()(),e(16,"select",21)(17,"option",22),t(18,"CLIENTE"),i(),e(19,"option",23),t(20,"PROVEEDOR"),i()()(),e(21,"div",15)(22,"label",24),t(23," Tel\xE9fono "),e(24,"span",17),t(25,"*"),i()(),s(26,"input",25),p(27,H,2,0,"small",19),i(),e(28,"div",15)(29,"label",26),t(30," Correo electr\xF3nico "),e(31,"span",17),t(32,"*"),i()(),s(33,"input",27),p(34,K,2,0,"small",19),i(),e(35,"div",15)(36,"label",28),t(37," C\xE9dula "),e(38,"span",17),t(39,"*"),i()(),s(40,"input",29),p(41,Q,2,0,"small",19),i(),e(42,"div",15)(43,"label",30),t(44," Tipo C\xE9dula "),e(45,"span",17),t(46,"*"),i()(),e(47,"select",31)(48,"option",32),t(49,"F\xEDsica"),i(),e(50,"option",33),t(51,"Jur\xEDdica"),i(),e(52,"option",34),t(53,"DIMEX"),i(),e(54,"option",35),t(55,"NITE"),i()()(),e(56,"div",15)(57,"label",36),t(58," Moneda "),e(59,"span",17),t(60,"*"),i()(),e(61,"select",37)(62,"option",38),t(63,"USD"),i(),e(64,"option",39),t(65,"CRC"),i()()(),e(66,"div",15)(67,"label",40),t(68," Vendedor "),e(69,"span",41),t(70,"opcional"),i()(),s(71,"ng-select",42),i()(),e(72,"div",14)(73,"div",43)(74,"label",44),t(75," Notas "),e(76,"span",41),t(77,"opcional"),i()(),s(78,"textarea",45),i()(),e(79,"div",46)(80,"button",47),t(81,"Editar"),i()()()(),e(82,"div",48)(83,"economic-activity-select",49),C("activityChange",function(d){b(l);let X=S();return h(X.onEconomicActivityChange(d))}),i()()()}if(a&2){let l=S();c(2),f("formGroup",l.editClientForm()),c(8),u(l.validField("name")?10:-1),c(17),u(l.validField("mobile")?27:-1),c(7),u(l.validField("email")?34:-1),c(7),u(l.validField("identity")?41:-1),c(30),f("items",l.sellers())("searchable",!0),c(12),f("activityInput",l.editClientForm().controls.activities.value)}}var E=class a{platformId=r(x);fb=r(q);commonAdminService=r(G);router=r(T);activatedRoute=r(F);authService=r(N);clientService=r(I);formErrorService=r(j);customToastService=r(U);clientId;client=v(null);sellers=v([]);emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$";editClientForm=v(null);get isBrowser(){return _(this.platformId)}constructor(){this.clientId=this.activatedRoute.snapshot.params.id}ngOnInit(){this.fetchClient()}fetchClient(){this.clientService.fetchOne(this.clientId).subscribe(n=>{n&&n.id&&(this.client.set(n),this.fetchSellers())})}onEconomicActivityChange(n){this.editClientForm()?.controls.activities.patchValue(n)}fetchSellers(){this.authService.fetchAllSellers().subscribe(n=>{if(n&&n.length){this.sellers.set(n);let l=this.sellers().find(m=>m.name===this.client()?.defaultSeller)||null;this.fillOutClientForm(l?.name??null)}})}fillOutClientForm(n){this.editClientForm.set(this.fb.group({name:[this.client()?.name??"",[o.required,o.minLength(2)]],type:[this.client()?.type,[o.required]],email:[this.client()?.email??"",[o.required,o.pattern(this.emailPattern)]],mobile:[this.client()?.mobile??"",[o.required,o.minLength(8),o.maxLength(8)]],identity:[this.client()?.identity??"",[o.required,o.minLength(8),o.maxLength(12)]],identityType:[this.client()?.identityType,[o.required]],currency:[this.client()?.currency??"USD",[o.required]],notes:[this.client()?.notes??"",[]],defaultSeller:[n,[]],activities:[this.createActivitiesObjectWhenInit(),[]]}))}createActivitiesObjectWhenInit(){return this.client()?.activities.map(n=>({code:n.code,name:n.name}))??[]}validField(n){return this.editClientForm().controls[n].touched&&this.editClientForm().controls[n].invalid}onSubmit(){if(this.editClientForm()?.invalid){this.formErrorService.throwFormErrors(this.editClientForm());return}let n={};n.updatedAt=A(new Date);for(let l in this.editClientForm()?.value)if(this.editClientForm()?.value.hasOwnProperty(l)){let m=this.editClientForm().controls[l],d=m.value;m&&(n[l]=d),!d&&l==="defaultSeller"&&(n[l]=null)}this.clientService.update(this.clientId,n).subscribe(l=>{l&&l.msg?(this.customToastService.add({message:l.msg,type:"success",duration:5e3}),this.router.navigateByUrl("/list-clients")):this.customToastService.add({message:l.message,type:"error",duration:5e3})})}comeBackToList(){this.commonAdminService.comeBackToList("/list-clients")}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=y({type:a,selectors:[["edit-client"]],decls:16,vars:1,consts:[[1,"main_content"],[1,"box"],[1,"d-flex","justify-content-between","mb-4"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"d-flex","justify-content-between","align-items-center"],["id","pills-tab","role","tablist",1,"nav","nav-pills","mb-4","div_pills"],["role","presentation",1,"nav-item"],["id","pills-fields-tab","data-bs-toggle","pill","type","button","data-bs-target","#pills-fields","role","tab","aria-controls","pills-fields","aria-selected","true",1,"nav-link","active"],["id","pills-activities-tab","data-bs-toggle","pill","type","button","data-bs-target","#pills-activities","role","tab","aria-controls","pills-activities","aria-selected","false",1,"nav-link"],["id","pills-tabContent",1,"tab-content"],["id","pills-fields","role","tabpanel","aria-labelledby","pills-fields-tab","tabindex","0",1,"tab-pane","fade","active","show"],[1,"form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],[1,"asterisk"],["type","text","formControlName","name"],[1,"text-danger"],["for","type"],["formControlName","type"],["value","CLIENTE"],["value","PROVEEDOR"],["for","mobile"],["type","text","formControlName","mobile"],["for","email"],["type","text","formControlName","email"],["for","identity"],["type","text","formControlName","identity"],["for","identityType"],["formControlName","identityType",1,"w-100"],["value","01"],["value","02"],["value","03"],["value","04"],["for","currency"],["formControlName","currency",1,"w-100"],["value","USD"],["value","CRC"],["for","defaultSeller"],[1,"muted"],["bindLabel","name","bindValue","name","placeholder","--Seleccione--","formControlName","defaultSeller",3,"items","searchable"],[1,"col-12"],["for","notes"],["formControlName","notes","rows","2"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mt-5"],["type","submit",1,"btn","btn-success"],["id","pills-activities","role","tabpanel","aria-labelledby","pills-activities-tab","tabindex","0",1,"tab-pane","fade"],[3,"activityChange","activityInput"]],template:function(l,m){l&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),t(4,"Editar contacto"),i(),e(5,"h4",4),C("click",function(){return m.comeBackToList()}),s(6,"i",5),t(7," Regresar "),i()(),e(8,"div",6)(9,"ul",7)(10,"li",8)(11,"button",9),t(12," Formulario "),i(),e(13,"button",10),t(14," Actividades econ\xF3micas "),i()()()(),p(15,Y,84,8,"div",11),i()()),l&2&&(c(15),u(m.editClientForm()?15:-1))},dependencies:[B,O,M,P,D,k,w,R,V,L,W,z,J],encapsulation:2,changeDetection:0})};export{E as default};
