import{a as le}from"./chunk-WI4F6WA4.js";import"./chunk-GROVWUMT.js";import{a as oe}from"./chunk-5BOVWHXY.js";import"./chunk-ZXERMP2K.js";import{a as ae}from"./chunk-KVBJ4PGU.js";import{u as ee,v as te,w as ie}from"./chunk-IBKVHNU3.js";import{a as y}from"./chunk-GZHOXXQG.js";import{a as re}from"./chunk-5LJDG4R3.js";import{a as ne}from"./chunk-FUDPSQJN.js";import{a as Z}from"./chunk-WKFQL3IM.js";import{u as Y}from"./chunk-UP3F5373.js";import{A as X,M,i as z,j as G,k as q,p as J,r as K,s as Q}from"./chunk-4ZQGKSBB.js";import{$a as g,Ab as s,Ba as $,Jb as i,Kb as f,Lb as S,Ma as o,Ra as H,Sb as T,Tb as B,Ub as D,Wa as k,X as j,ba as _,fb as P,hb as W,ia as C,ib as V,j as U,ja as O,kb as h,na as w,nb as A,ob as I,pb as e,qb as t,rb as p,vb as x,wa as v,zb as u}from"./chunk-F6XVVQNR.js";var pe=(r,a)=>a.entity;function ue(r,a){if(r&1){let n=x();e(0,"li",8),u("click",function(){let l=C(n).$implicit,m=s();return O(m.onSelectOption(l.entity))}),e(1,"div",9)(2,"span",10),i(3," _ "),t(),e(4,"strong",11),i(5),t(),e(6,"span",12),i(7),t()()()}if(r&2){let n=a.$implicit,c=s();o(2),W("bg_blue",c.selectedOption()===n.entity),o(3),f(n.label),o(2),f(n.text)}}var R=class r{constructor(a){this.data=a;this.purchaseOrderId.set(a.purchaseOrderId)}dialogRef=_(ee);destroyRef=_(w);router=_(K);purchaseOrderService=_(M);detailCopyPurchaseOrderToService=_(E);customToastService=_(Z);purchaseOrderId=v(null);selectedOption=v(null);arrCopyToOptions=[{entity:"PurchaseOrder",label:"Orden de compra",text:"reutiliza contenido de esta orden de compra"}];onSelectOption(a){this.selectedOption.set(a)}closePopUp(){this.dialogRef.close()}executeCopy(){if(this.selectedOption())switch(this.selectedOption()){case"PurchaseOrder":break;default:break}}generateCopyToPurchaseOrder(){let a=X(new Date);this.purchaseOrderService.copyToDraft(this.purchaseOrderId(),a).pipe(y(this.destroyRef)).subscribe(n=>{n&&n.id?(this.customToastService.add({message:"Orden de compra como borrador generada correctamente.",type:"success",duration:5e3}),this.closePopUp(),this.router.navigateByUrl(`/detail-purchase-order/${n.id}`),this.detailCopyPurchaseOrderToService.triggerCurrentPurchaseOrderHasBeenCopied(n.id)):this.customToastService.add({message:n.message,type:"error",duration:5e3})})}static \u0275fac=function(n){return new(n||r)(H(te))};static \u0275cmp=k({type:r,selectors:[["modal-copy-purchase-order-to"]],decls:13,vars:1,consts:[[1,"modal_copy_to_purchase_order","p-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"fa-solid","fa-xmark","fs-3",3,"click"],[1,"list-group"],[1,"list-group-item","list-group-item-light","cp"],[1,"d-flex","justify-content-end","w_100","gap-3","mt-5"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"list-group-item","list-group-item-light","cp",3,"click"],[1,"d-flex","align-items-center"],[1,"circle_check","me-2"],[1,"fs-5","me-2"],[1,"fs-5"]],template:function(n,c){n&1&&(e(0,"div",0)(1,"div",1)(2,"h3"),i(3,"Copiar orden de compra a"),t(),e(4,"i",2),u("click",function(){return c.closePopUp()}),t()(),e(5,"ul",3),A(6,ue,8,4,"li",4,pe),t(),e(8,"div",5)(9,"button",6),u("click",function(){return c.closePopUp()}),i(10," Cancelar "),t(),e(11,"button",7),u("click",function(){return c.executeCopy()}),i(12," Crear borrador "),t()()()),n&2&&(o(6),I(c.arrCopyToOptions),o(5),P("disabled",!c.selectedOption()))},dependencies:[Y],styles:[".form[_ngcontent-%COMP%]{padding:2rem}label[_ngcontent-%COMP%]{color:var(--black)}.header_form[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.header_form[_ngcontent-%COMP%]   .icon_close[_ngcontent-%COMP%]{font-size:2.3rem}"],changeDetection:0})};var E=class r{dialog=_(ie);_currentPurchaseOrderCopied$=new U;currentPurchaseOrderCopied$=this._currentPurchaseOrderCopied$.asObservable();displayModalCopyPurchaseOrderTo(a){this.dialog.open(R,{width:"70rem",height:"auto",autoFocus:!1,data:{purchaseOrderId:a}}).updatePosition({top:"100px"})}triggerCurrentPurchaseOrderHasBeenCopied(a){this._currentPurchaseOrderCopied$.next(a)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=j({token:r,factory:r.\u0275fac,providedIn:"root"})};var me=(r,a)=>a.id;function _e(r,a){if(r&1&&(e(0,"button",13),p(1,"i",40),i(2," Editar "),t()),r&2){let n=s(2);P("routerLink","/edit-purchase-order/"+n.purchaseOrderId)}}function he(r,a){if(r&1){let n=x();e(0,"button",41),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.markAsApproved(l.purchaseOrderId))}),i(1," Marcar como aprobada "),t()}}function fe(r,a){if(r&1){let n=x();e(0,"button",41),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.markAsBilled(l.purchaseOrderId))}),i(1," Marcar como pagada "),t()}}function Ce(r,a){r&1&&p(0,"div",16)}function Oe(r,a){r&1&&p(0,"i",17)}function xe(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.markAsAwaitingApproval(l.purchaseOrderId))}),p(2,"i",42),i(3," Marcar como esperando por ser aprobada "),t()()}}function ve(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.displayModalPurchaseOrderEmail(l.purchaseOrder()))}),p(2,"i",43),i(3," Enviar "),t()()}}function Se(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.markAsApproved(l.purchaseOrderId))}),p(2,"i",44),i(3," Marcar como aprobada "),t()()}}function be(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.markAsSent(l.purchaseOrderId))}),p(2,"i",45),i(3," Marcar como enviada "),t()()}}function ge(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.undoMarkAsAwaitingApproval(l.purchaseOrderId))}),p(2,"i",46),i(3," Desmarcar como esperando a ser aprobada "),t()()}}function Pe(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.undoMarkAsApproved(l.purchaseOrderId))}),p(2,"i",46),i(3," Desmarcar como aprobada "),t()()}}function Te(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.undoMarkAsBilled(l.purchaseOrderId))}),p(2,"i",46),i(3," Desmarcar como pagada "),t()()}}function ye(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.markAsBilled(l.purchaseOrderId))}),p(2,"i",47),i(3," Marcar como pagada "),t()()}}function Ee(r,a){if(r&1&&(e(0,"li")(1,"button",48),p(2,"i",49),i(3," Editar "),t()()),r&2){let n=s(2);o(),P("routerLink","/edit-purchase-order/"+n.purchaseOrderId)}}function De(r,a){if(r&1){let n=x();e(0,"li")(1,"button",19),u("click",function(){C(n);let l=s(2);return O(l.detailPurchaseOrderService.removePurchaseOrder(l.purchaseOrder()))}),p(2,"i",50),i(3," Remover "),t()()}}function we(r,a){if(r&1&&(e(0,"tr")(1,"td")(2,"span"),i(3),t()(),e(4,"td")(5,"span"),i(6),t()(),e(7,"td")(8,"span"),i(9),t()(),e(10,"td")(11,"span"),i(12),t()(),e(13,"td")(14,"span"),i(15),t()(),e(16,"td")(17,"span"),i(18),t()(),e(19,"td")(20,"span"),i(21),t()(),e(22,"td")(23,"span"),i(24),t()(),e(25,"td",51)(26,"span"),i(27),t()()()),r&2){let n,c,l,m=a.$implicit,b=s(2);o(3),f(m.item.name),o(3),f(m.description),o(3),f(m.quantity),o(3),f(m.price),o(3),f(m.discount),o(3),f((n=m.account==null?null:m.account.name)!==null&&n!==void 0?n:"_"),o(3),S(" ",b.detailPurchaseOrderService.getTaxRateLabel((c=m.taxRate)!==null&&c!==void 0?c:"")," "),o(3),f((l=m.seller==null?null:m.seller.name)!==null&&l!==void 0?l:"_"),o(3),f(m.amount)}}function ke(r,a){r&1&&(e(0,"tr",32)(1,"td",52),i(2," No existen Art\xEDculos ni servicios en esta orden de compra. "),t()())}function Ae(r,a){if(r&1){let n=x();e(0,"div",8)(1,"div",9)(2,"span",10),i(3),t(),e(4,"span"),i(5),t()(),e(6,"div",11)(7,"button",12),i(8,"Imprimir PDF"),t(),g(9,_e,3,1,"button",13)(10,he,2,0,"button",14)(11,fe,2,0,"button",14),e(12,"div",15),g(13,Ce,1,0,"div",16)(14,Oe,1,0,"i",17),e(15,"ul",18),g(16,xe,4,0,"li")(17,ve,4,0,"li")(18,Se,4,0,"li"),e(19,"button",19),u("click",function(){C(n);let l=s();return O(l.detailCopyPurchaseOrderToService.displayModalCopyPurchaseOrderTo(l.purchaseOrderId))}),p(20,"i",20),i(21," Copiar a "),t(),g(22,be,4,0,"li")(23,ge,4,0,"li")(24,Pe,4,0,"li")(25,Te,4,0,"li")(26,ye,4,0,"li")(27,Ee,4,1,"li")(28,De,4,0,"li"),e(29,"li"),p(30,"div",21),e(31,"small",22),i(32,"Acciones"),t()()()()()(),e(33,"div",23)(34,"div",24)(35,"label"),i(36,"Cliente"),t(),e(37,"span"),i(38),t()(),e(39,"div",24)(40,"label"),i(41,"Fecha"),t(),e(42,"span"),i(43),T(44,"readableDate"),t()(),e(45,"div",24)(46,"label"),i(47,"Fecha entrega"),t(),e(48,"span"),i(49),T(50,"readableDate"),t()(),e(51,"div",24)(52,"label"),i(53,"N\xFAmero orden de compra"),t(),e(54,"span"),i(55),t()(),e(56,"div",25)(57,"label"),i(58,"Estado"),t(),e(59,"span"),i(60),t()(),e(61,"div",24)(62,"label"),i(63,"Moneda"),t(),e(64,"span"),i(65),t()()(),e(66,"div",26)(67,"table",27)(68,"thead")(69,"tr")(70,"th",28)(71,"span"),i(72,"Item"),t()(),e(73,"th",29)(74,"span"),i(75,"Descripci\xF3n"),t()(),e(76,"th",30)(77,"span"),i(78," Cantidad "),t()(),e(79,"th",30)(80,"span"),i(81,"Precio"),t()(),e(82,"th",30)(83,"span"),i(84,"Descuento"),t()(),e(85,"th",30)(86,"span"),i(87,"Cuenta"),t()(),e(88,"th",30)(89,"span"),i(90,"Impuesto"),t()(),e(91,"th",30)(92,"span"),i(93,"Vendedor"),t()(),e(94,"th",31)(95,"span"),i(96,"Monto"),t()()()(),e(97,"tbody"),A(98,we,28,9,"tr",null,me,!1,ke,3,0,"tr",32),t()()(),e(101,"div",33)(102,"div",34)(103,"ul",35)(104,"li",36)(105,"span"),i(106,"Subtotal"),t(),e(107,"span"),i(108),T(109,"number"),t()(),e(110,"li",36)(111,"span"),i(112,"Descuento total"),t(),e(113,"span",37),i(114),T(115,"number"),t()(),e(116,"li",36)(117,"span"),i(118,"Impuesto total"),t(),e(119,"span"),i(120),T(121,"number"),t()(),p(122,"div",38),e(123,"li",39)(124,"span"),i(125,"Total"),t(),e(126,"strong"),i(127),T(128,"number"),t()()()()()}if(r&2){let n,c,l,m,b,L,N,d=s();o(3),f((n=d.purchaseOrder())==null?null:n.purchaseOrderNumber),o(),V(d.detailPurchaseOrderService.getStatusBadgeFromPurchaseOrder((c=(c=d.purchaseOrder())==null?null:c.status)!==null&&c!==void 0?c:"")),o(),S(" ",(l=d.purchaseOrder())==null?null:l.status," "),o(4),h(d.allowedStatusToBeEditedFromDraft.includes(d.purchaseOrder().status)?9:-1),o(),h(d.allowedStatusToBeApproved.includes(d.purchaseOrder().status)?10:-1),o(),h(d.allowedStatusToBeBilled.includes(d.purchaseOrder().status)?11:-1),o(2),h(d.detailPurchaseOrderService.isSendEmailFromDetailComponentSubmitting()?13:14),o(3),h(d.allowedStatusToBeAwaitingApproval.includes(d.purchaseOrder().status)?16:-1),o(),h(d.allowedStatusToBeSent.includes(d.purchaseOrder().status)?17:-1),o(),h(d.allowedStatusToBeApproved.includes(d.purchaseOrder().status)?18:-1),o(4),h(d.allowedStatusToMarkAsSent.includes(d.purchaseOrder().status)?22:-1),o(),h(d.allowedStatusToUnMarkAsAwaitingApproval.includes(d.purchaseOrder().status)?23:-1),o(),h(d.allowedStatusToUnMarkAsApproved.includes(d.purchaseOrder().status)?24:-1),o(),h(d.allowedStatusToUnMarkAsBilled.includes(d.purchaseOrder().status)?25:-1),o(),h(d.allowedStatusToBeBilled.includes(d.purchaseOrder().status)?26:-1),o(),h(d.allowedStatusToBeEdited.includes(d.purchaseOrder().status)?27:-1),o(),h(d.purchaseOrder().status!=="removida"?28:-1),o(10),f((m=d.purchaseOrder())==null||m.client==null?null:m.client.name),o(5),f(B(44,31,d.purchaseOrder().initDate)),o(6),S(" ",d.purchaseOrder().deliveryDate?B(50,33,d.purchaseOrder().deliveryDate):"_"," "),o(6),S(" ",d.purchaseOrder().purchaseOrderNumber," "),o(4),V(d.detailPurchaseOrderService.getStatusBadgeFromPurchaseOrder((b=(b=d.purchaseOrder())==null?null:b.status)!==null&&b!==void 0?b:"")),o(),S(" ",(L=d.purchaseOrder())==null?null:L.status," "),o(5),S(" ",d.purchaseOrder().currency," "),o(33),I((N=d.purchaseOrder())==null?null:N.purchaseOrderItems),o(10),f(D(109,35,d.subtotal(),"1.2-2")),o(6),S(" - ",D(115,38,d.totalDiscount(),"1.2-2")," "),o(6),f(D(121,41,d.totalTax(),"1.2-2")),o(7),S(" ",D(128,44,d.totalAmount(),"1.2-2")," ")}}function Ie(r,a){if(r&1&&p(0,"tracking-entity",7),r&2){let n=s();P("tracking",n.purchaseOrder().tracking)("entity",n.entityData())}}var F=class r{platformId=_($);activatedRoute=_(J);commonAdminService=_(ne);destroyRef=_(w);purchaseOrderService=_(M);entityData=v(null);detailPurchaseOrderService=_(le);detailCopyPurchaseOrderToService=_(E);allowedStatusToBeEditedFromDraft=["borrador"];allowedStatusToBeSent=["borrador","enviada","esperando_aprobaci\xF3n","aprobada"];allowedStatusToMarkAsSent=["borrador"];allowedStatusToBeAwaitingApproval=["borrador","enviada"];allowedStatusToBeApproved=["borrador","enviada","esperando_aprobaci\xF3n"];allowedStatusToBeBilled=["aprobada"];allowedStatusToBeEdited=["borrador","enviada"];allowedStatusToUnMarkAsSent=["enviada"];allowedStatusToUnMarkAsApproved=["aprobada"];allowedStatusToUnMarkAsAwaitingApproval=["esperando_aprobaci\xF3n"];allowedStatusToUnMarkAsBilled=["pagada"];get isBrowser(){return q(this.platformId)}purchaseOrderId;purchaseOrder=v(null);subtotal=v(0);totalDiscount=v(0);totalTax=v(0);totalAmount=v(0);constructor(){this.purchaseOrderId=this.activatedRoute.snapshot.params.id,this.entityData.set({refEntity:"PurchaseOrder",refEntityId:this.purchaseOrderId})}ngOnInit(){this.fetchPurchaseOrder(),this.detailPurchaseOrderService.statusPurchaseOrderChange$.pipe(y(this.destroyRef)).subscribe(()=>{this.fetchPurchaseOrder()}),this.listenWhenCurrentPurchaseOrderHasBeenCopied()}listenWhenCurrentPurchaseOrderHasBeenCopied(){this.detailCopyPurchaseOrderToService.currentPurchaseOrderCopied$.pipe(y(this.destroyRef)).subscribe(a=>{a&&(this.purchaseOrderId=a,this.fetchPurchaseOrder())})}fetchPurchaseOrder(){this.purchaseOrderService.fetchOne(this.purchaseOrderId).pipe(y(this.destroyRef)).subscribe(a=>{a&&a.id&&(this.purchaseOrder.set(a),this.updateTotals())})}updateTotals(){let a=this.detailPurchaseOrderService.calculateTotalsOnDetail(this.purchaseOrder()?.purchaseOrderItems??[]);this.subtotal.set(a.subtotal),this.totalDiscount.set(a.discounts),this.totalTax.set(a.iva),this.totalAmount.set(a.total)}comeBackToList(){this.commonAdminService.comeBackToList("/list-purchase-orders")}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=k({type:r,selectors:[["detail-purchase-order"]],decls:11,vars:6,consts:[[1,"main_content"],[3,"primaryText","primaryLink","secondaryText","secondaryLink"],[1,"box"],[1,"d-flex","justify-content-between","mb-3"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[3,"tracking","entity"],[1,"d-flex","justify-content-between","mb-4"],[1,"d-flex","align-items-center"],[1,"me-3"],[1,"hstack","gap-3"],[1,"btn","btn-outline-secondary"],["type","button",1,"btn","btn-primary",3,"routerLink"],["type","button",1,"btn","btn-primary"],[1,"dropdown"],[1,"spinner","ms-1"],["data-bs-toggle","dropdown","aria-expanded","false",1,"fa-solid","fa-ellipsis-vertical","three_points_dropdown"],[1,"dropdown-menu"],["type","button",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-clone","icon_copy_to","me-2"],[1,"line_divider","mt-3","mb-2"],[1,"ms-3","fs-4"],[1,"row","mb-5"],[1,"col-12","col-md-3","col-lg-2"],[1,"col-12","col-md-4","col-lg-3"],[1,"row","table_items"],[1,"table","table-sm","mb-3"],[1,"col-2"],[1,"col-3"],[1,"col-1"],[1,"col-1","text-end"],[1,"no-elements"],[1,"row","mt-4"],[1,"col-md-6","col-lg-4","offset-md-6","offset-lg-8"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"text-danger"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"fa-solid","fa-pen-to-square","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-file-invoice-dollar","icon_accepted","me-2"],[1,"fa-solid","fa-paper-plane","icon_sent","me-2"],[1,"fa-solid","fa-check","icon_accepted","me-2"],[1,"fa-solid","fa-marker","icon_mark_as_sent","me-2"],[1,"fa-solid","fa-repeat","icon_trash","me-2"],[1,"fa-solid","fa-xmark","icon_declined","me-2"],["type","button",1,"dropdown-item",3,"routerLink"],[1,"fa-solid","fa-pen-to-square","icon_pencil","me-2"],[1,"fa-solid","fa-trash","icon_trash","me-2"],[1,"text-end"],["colspan","12"]],template:function(n,c){n&1&&(e(0,"div",0),p(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Detalle orden de compra"),t(),e(6,"h4",5),u("click",function(){return c.comeBackToList()}),p(7,"i",6),i(8," Regresar "),t()(),g(9,Ae,129,47),t()(),g(10,Ie,1,2,"tracking-entity",7)),n&2&&(o(),P("primaryText","Vista de compras")("primaryLink","/purchases-overview")("secondaryText","Listado \xF3rdenes de compra")("secondaryLink","/list-purchase-orders"),o(8),h(c.purchaseOrder()?9:-1),o(),h(c.purchaseOrder()?10:-1))},dependencies:[G,z,Q,oe,ae,re],styles:[".table_items[_ngcontent-%COMP%]{padding-top:4rem}th[_ngcontent-%COMP%]{color:var(--text);font-size:medium;font-weight:400}.total_price[_ngcontent-%COMP%]{font-size:1.3rem;margin-bottom:.4rem}"],changeDetection:0})};export{F as default};
