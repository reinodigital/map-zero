import{a as pe}from"./chunk-UEGWDIED.js";import"./chunk-NOTS5ZWT.js";import{b as de,c as ue}from"./chunk-OZFJSFYS.js";import{a as me,b as se}from"./chunk-KRH6V4OX.js";import"./chunk-G7SYGITX.js";import{a as w}from"./chunk-QVQJSET7.js";import{a as ce}from"./chunk-T5DHTF52.js";import{a as le}from"./chunk-P3VFXC3H.js";import{a as ae}from"./chunk-3L4S2P7E.js";import{a as oe}from"./chunk-IETRKHQE.js";import{b as W,c as m,d as z,e as K,h as H,i as J,k as Q,l as X,m as Y,n as Z,o as ee,p as te,q as re,t as ie,u as ne}from"./chunk-XXXEA7T5.js";import{h as L,i as q,l as B,m as U,n as $,o as j}from"./chunk-NXK32U4M.js";import{i as D,m as R,n as G,q as V}from"./chunk-SF27WFEL.js";import{$a as d,Ab as g,Ba as A,C as F,Jb as i,Kb as C,Lb as P,Ma as l,Tb as v,Vb as b,Wa as k,ba as s,fb as u,gc as S,ia as x,ja as E,kb as p,na as T,nb as N,ob as y,pb as t,qb as e,rb as c,vb as M,wa as O,zb as f}from"./chunk-BXSYLYWC.js";var fe=(a,r)=>r.id,Se=(a,r)=>r.code;function _e(a,r){a&1&&(t(0,"small",13),i(1," cliente es requerido "),e())}function ve(a,r){a&1&&(t(0,"small",13),i(1," fecha es requerida "),e())}function be(a,r){a&1&&(t(0,"small",13),i(1," item es requerido "),e())}function Oe(a,r){a&1&&(t(0,"small",13),i(1," cantidad debe ser > 0 "),e())}function ge(a,r){a&1&&(t(0,"small",13),i(1," precio incorrecto "),e())}function Ce(a,r){if(a&1&&(t(0,"option",57),i(1),e()),a&2){let n=r.$implicit;u("value",n.id),l(),P(" ",`${n.code} - ${n.name}`," ")}}function Pe(a,r){a&1&&(t(0,"small",13),i(1," contabilidad es requerido "),e())}function we(a,r){if(a&1&&(t(0,"option",57),i(1),e()),a&2){let n=r.$implicit;u("value",n.code),l(),C(n.label)}}function xe(a,r){a&1&&(t(0,"small",13),i(1," impuesto es requerido "),e())}function Ee(a,r){if(a&1){let n=M();t(0,"tr",49)(1,"td")(2,"custom-select",50),f("itemSelectedEmitter",function(h){let _=x(n).index,he=g();return E(he.onItemSelectedInRow(h,_))}),e(),d(3,be,2,0,"small",13),e(),t(4,"td"),c(5,"textarea",51),e(),t(6,"td"),c(7,"input",52),d(8,Oe,2,0,"small",13),e(),t(9,"td"),c(10,"input",53),d(11,ge,2,0,"small",13),e(),t(12,"td"),c(13,"input",54),e(),t(14,"td")(15,"select",55)(16,"option",56),i(17,"--Seleccione--"),e(),N(18,Ce,2,2,"option",57,fe),e(),d(20,Pe,2,0,"small",13),e(),t(21,"td")(22,"select",58),N(23,we,2,2,"option",57,Se),e(),d(25,xe,2,0,"small",13),e(),t(26,"td"),c(27,"ng-select",59),e(),t(28,"td")(29,"button",60),f("click",function(){let h=x(n).index,_=g();return E(_.removePurchaseOrderItem(h))}),c(30,"i",61),e()()()}if(a&2){let n=r.index,o=g();u("formGroupName",n)("id","row_"+n),l(3),p(o.validField("purchaseOrderItems."+n+".itemId")?3:-1),l(5),p(o.validField("purchaseOrderItems."+n+".quantity")?8:-1),l(3),p(o.validField("purchaseOrderItems."+n+".price")?11:-1),l(7),y(o.accounts()),l(2),p(o.validField("purchaseOrderItems."+n+".accountId")?20:-1),l(3),y(o.taxRates),l(2),p(o.validField("purchaseOrderItems."+n+".taxRate")?25:-1),l(2),u("items",o.sellers())("searchable",!0)}}function Ne(a,r){a&1&&(t(0,"tr",28)(1,"td",62)(2,"small"),i(3,' No se ha a\xF1adido fila, presione "Agregar fila" para incluir algunos. '),e()()())}function ye(a,r){a&1&&(t(0,"div",44),i(1," Enviando "),c(2,"div",63),e())}function Ie(a,r){a&1&&i(0," Enviar ")}var I=class a{platformId=s(A);fb=s(ie);destroyRef=s(T);authService=s(L);accountService=s(q);commonAdminService=s(le);clientService=s(B);formErrorService=s(ae);customToastService=s(oe);sellers=O([]);accounts=O([]);formNewPurchaseOrderService=s(pe);isFormSubmitting=S(()=>this.formNewPurchaseOrderService.isFormSubmitting());taxRates=j;clients=O([]);newPurchaseOrderForm=this.fb.group({client:[null,[m.required]],initDate:[this.currentDate,[m.required]],deliveryDate:["",[]],currency:["USD",[m.required]],deliveryInstructions:["",[]],purchaseOrderItems:this.fb.array([this.createPurchaseOrderItemFormGroup(),this.createPurchaseOrderItemFormGroup()])});subtotal=S(()=>this.formNewPurchaseOrderService.subtotal());totalDiscount=S(()=>this.formNewPurchaseOrderService.totalDiscount());totalTax=S(()=>this.formNewPurchaseOrderService.totalTax());totalAmount=S(()=>this.formNewPurchaseOrderService.totalAmount());get isBrowser(){return V(this.platformId)}get currentDate(){return $(new Date)}ngOnInit(){this.formNewPurchaseOrderService.cleanTotalValues(),this.fetchAllShortClients(),this.fetchSellers(),this.fetchAccounts(),this.purchaseOrderItems.controls.forEach(r=>{this.setupItemGroupValueChangeListener(r)})}fetchAccounts(){this.accountService.fetchAll(999,0,{}).pipe(w(this.destroyRef)).subscribe(r=>{r&&r.accounts&&this.accounts.set(r.accounts)})}fetchAllShortClients(){this.clientService.fetchAllShortClients().pipe(w(this.destroyRef)).subscribe(r=>{r&&this.clients.set(r)})}fetchSellers(){this.authService.fetchAllSellers().subscribe(r=>{r&&r.length&&this.sellers.set(r)})}validField(r){let n=this.newPurchaseOrderForm.get(r);return n?n.touched&&n.invalid:!1}get purchaseOrderItems(){return this.newPurchaseOrderForm.get("purchaseOrderItems")}createPurchaseOrderItemFormGroup(){let r=this.fb.group({itemId:[null,[m.required]],sellerUid:[null,[]],description:["",[]],quantity:[1,[m.required,m.min(1)]],price:["",[m.required]],discount:[0,[]],accountId:["",[m.required,m.minLength(1)]],taxRate:["08",[m.required,,m.minLength(1)]]});return this.setupItemGroupValueChangeListener(r),r}addPurchaseOrderItem(){this.purchaseOrderItems.push(this.createPurchaseOrderItemFormGroup()),this.formNewPurchaseOrderService.calculateTotals(this.purchaseOrderItems)}removePurchaseOrderItem(r){this.purchaseOrderItems.removeAt(r),this.formNewPurchaseOrderService.calculateTotals(this.purchaseOrderItems)}setupItemGroupValueChangeListener(r){r.valueChanges.pipe(w(this.destroyRef),F(n=>n.quantity!==null&&n.price!==null&&n.discount!==null)).subscribe(()=>{this.formNewPurchaseOrderService.calculateTotals(this.purchaseOrderItems)})}onItemSelectedInRow(r,n){let o=this.purchaseOrderItems.at(n);o&&r&&(o.patchValue({description:r.description||"",price:r.salePrice??0,accountId:r.purchaseAccountId??""}),this.formNewPurchaseOrderService.calculateTotals(this.purchaseOrderItems))}onCustomSubmitBtnClicked(r){this.callToAction(r)}callToAction(r){if(this.formErrorService.throwFormErrors(this.newPurchaseOrderForm),!this.formNewPurchaseOrderService.verifyPurchaseOrderItems(this.purchaseOrderItems)){this.customToastService.add({message:"Uno o m\xE1s items tienen error.",type:"error",duration:6e3});return}if(!this.newPurchaseOrderForm.controls.client.value){this.customToastService.add({message:"Seleccione un cliente para continuar.",type:"error",duration:6e3});return}if(this.newPurchaseOrderForm.invalid){this.formErrorService.throwFormErrors(this.newPurchaseOrderForm);return}let n=this.newPurchaseOrderForm.value;switch(n.createdAt=U(new Date),r){case"save":n.status="borrador",n.action="save",this.formNewPurchaseOrderService.onSaveAction(n);break;case"mark_as_sent":n.status="enviada",n.action="mark_as_sent",this.formNewPurchaseOrderService.onSaveAction(n);break;case"send":n.status="borrador",n.action="send",this.formNewPurchaseOrderService.handleCreateOrEditPurchaseOrderSendingEmailAsWell(n);break;default:break}}comeBackToList(){this.commonAdminService.comeBackToList("/list-purchase-orders")}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=k({type:a,selectors:[["new-purchase-order"]],decls:127,vars:30,consts:[[1,"main_content"],[3,"primaryText","primaryLink","secondaryText","secondaryLink"],[1,"box"],[1,"d-flex","justify-content-between"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"form",3,"formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4","mb-3"],["for","defaultSeller"],[1,"asterisk"],["bindLabel","name","placeholder","--Seleccione--","formControlName","client",3,"items","searchable"],[1,"text-danger"],["for","initDate",1,"w_100"],["type","date","formControlName","initDate"],["for","deliveryDate",1,"w_100"],[1,"muted"],["type","date","formControlName","deliveryDate"],["for","currency",1,"w_100"],["formControlName","currency"],["value","USD"],["value","CRC"],[1,"table","table-sm","mb-3","mt-5"],[1,"col-2"],[1,"col-1"],["formArrayName","purchaseOrderItems"],[3,"formGroupName","id",4,"ngFor","ngForOf"],[1,"no-elements"],["type","button",1,"btn","btn-sm","btn-outline-primary","mt-2",3,"click"],[1,"fa","fa-plus"],[1,"row","mt-4"],[1,"col-md-6","offset-md-6"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"col-12"],["for","deliveryInstructions"],["formControlName","deliveryInstructions","rows","2",1,"w_100"],[1,"d-flex","align-items-center","mt-4"],["primaryText","Guardar","secondaryText","Guardando",3,"btnWasClicked","isFormSubmitting","buttonAction"],[1,"input-group","ms-3"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"d-flex","align-items-center"],["type","button","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-outline-secondary","dropdown-toggle","dropdown-toggle-split"],[1,"visually-hidden"],[1,"dropdown-menu"],[1,"dropdown-item","cp",3,"click"],[3,"formGroupName","id"],["formControlName","itemId",3,"itemSelectedEmitter"],["formControlName","description","rows","1"],["type","number","formControlName","quantity"],["type","number","formControlName","price"],["type","number","formControlName","discount","placeholder","%"],["formControlName","accountId"],["value",""],[3,"value"],["formControlName","taxRate"],["bindLabel","name","bindValue","uid","placeholder","--Seleccione--","formControlName","sellerUid",3,"items","searchable"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"fa","fa-trash"],["colspan","4"],[1,"spinner","ms-2"]],template:function(n,o){n&1&&(t(0,"div",0),c(1,"breadcrumb",1),t(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Nueva orden de compra"),e(),t(6,"h4",5),f("click",function(){return o.comeBackToList()}),c(7,"i",6),i(8," Regresar "),e()(),t(9,"form",7)(10,"div",8)(11,"div",9)(12,"label",10),i(13," Cliente "),t(14,"span",11),i(15,"*"),e()(),c(16,"ng-select",12),d(17,_e,2,0,"small",13),e(),t(18,"div",9)(19,"label",14),i(20," Fecha "),t(21,"span",11),i(22,"*"),e()(),c(23,"input",15),d(24,ve,2,0,"small",13),e(),t(25,"div",9)(26,"label",16),i(27," Fecha entrega "),t(28,"span",17),i(29,"opcional"),e()(),c(30,"input",18),e(),t(31,"div",9)(32,"label",19),i(33," Moneda "),t(34,"span",11),i(35,"*"),e()(),t(36,"select",20)(37,"option",21),i(38,"USD"),e(),t(39,"option",22),i(40,"Colones"),e()()()(),t(41,"table",23)(42,"thead")(43,"tr")(44,"th",24)(45,"label"),i(46,"Item"),e()(),t(47,"th",24)(48,"label"),i(49,"Descripci\xF3n"),e()(),t(50,"th",25)(51,"label"),i(52," Cantidad "),e()(),t(53,"th",25)(54,"label"),i(55,"Precio"),e()(),t(56,"th",25)(57,"label"),i(58,"Descuento (%)"),e()(),t(59,"th",25)(60,"label"),i(61,"Cuenta"),e()(),t(62,"th",25)(63,"label"),i(64,"Impuesto"),e()(),t(65,"th",25)(66,"label"),i(67,"Vendedor"),e()(),c(68,"th",25),e()(),t(69,"tbody",26),d(70,Ee,31,9,"tr",27)(71,Ne,4,0,"tr",28),e()(),t(72,"button",29),f("click",function(){return o.addPurchaseOrderItem()}),c(73,"i",30),i(74," Agregar fila "),e(),t(75,"div",31)(76,"div",32)(77,"ul",33)(78,"li",34)(79,"span"),i(80,"Subtotal"),e(),t(81,"span"),i(82),v(83,"number"),e()(),t(84,"li",34)(85,"span"),i(86,"Descuento total"),e(),t(87,"span",13),i(88),v(89,"number"),e()(),t(90,"li",34)(91,"span"),i(92,"Impuesto total"),e(),t(93,"span"),i(94),v(95,"number"),e()(),c(96,"div",35),t(97,"li",36)(98,"span")(99,"span"),i(100,"Total"),e()(),t(101,"strong"),i(102),v(103,"number"),e()()()()(),t(104,"div",8)(105,"div",37)(106,"label",38),i(107," Instrucciones de entrega "),t(108,"span",17),i(109,"opcional"),e()(),c(110,"textarea",39),e()(),t(111,"div",40)(112,"submit-button",41),f("btnWasClicked",function(_){return o.onCustomSubmitBtnClicked(_)}),e(),t(113,"div",42)(114,"button",43),f("click",function(){return o.callToAction(o.formNewPurchaseOrderService.sendAction)}),d(115,ye,3,0,"div",44)(116,Ie,1,0),e(),t(117,"button",45)(118,"span",46),i(119,"Toggle Dropdown"),e()(),t(120,"ul",47)(121,"li")(122,"a",48),f("click",function(){return o.callToAction(o.formNewPurchaseOrderService.sendAction)}),i(123," Enviar "),e()(),t(124,"li")(125,"a",48),f("click",function(){return o.callToAction(o.formNewPurchaseOrderService.markAsSentAction)}),i(126," Marcar como enviada "),e()()()()()()()()),n&2&&(l(),u("primaryText","Vista de compras")("primaryLink","/purchases-overview")("secondaryText","Listado \xF3rdenes de compra")("secondaryLink","/list-purchase-orders"),l(8),u("formGroup",o.newPurchaseOrderForm),l(7),u("items",o.clients())("searchable",!0),l(),p(o.validField("clientId")?17:-1),l(7),p(o.validField("initDate")?24:-1),l(46),u("ngForOf",o.purchaseOrderItems.controls),l(),p(o.purchaseOrderItems.value.length?-1:71),l(11),C(b(83,18,o.subtotal(),"1.2-2")),l(6),P(" - ",b(89,21,o.totalDiscount(),"1.2-2")," "),l(6),C(b(95,24,o.totalTax(),"1.2-2")),l(8),P(" ",b(103,27,o.totalAmount(),"1.2-2")," "),l(10),u("isFormSubmitting",o.isFormSubmitting())("buttonAction",o.formNewPurchaseOrderService.saveAction),l(3),p(o.formNewPurchaseOrderService.isFormNewPurchaseOrderAndEmailSubmitting()?115:116))},dependencies:[G,D,R,de,ne,H,te,re,W,J,ee,z,K,Q,Z,X,Y,se,me,ue,ce],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.5rem;text-align:left;border:1px solid #ddd}td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], td[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]{display:block;width:100%;height:100%;padding:.5rem;margin:0;border:none;background-color:transparent;box-sizing:border-box;font-size:inherit}td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]{border:none!important;background-color:transparent!important;height:100%;display:flex;align-items:center}td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]   .ng-value-wrapper[_ngcontent-%COMP%]{padding:.5rem 0}td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]   .ng-input[_ngcontent-%COMP%]{padding:.5rem 0}td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, td[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, td[_ngcontent-%COMP%]   ng-select[_ngcontent-%COMP%]:focus-within{outline:none}.total_price[_ngcontent-%COMP%]{font-size:1.4rem;margin-bottom:.4rem}"],changeDetection:0})};export{I as default};
