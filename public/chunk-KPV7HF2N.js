import{a as z,b as J}from"./chunk-E6B3SAKU.js";import{a as j}from"./chunk-GRP2BXQC.js";import{b as w,c as r,d as A,e as R,h as L,k as V,n as M,o as O,p as k,q as B,t as G,u as U}from"./chunk-TUWVJ4C7.js";import{a as P}from"./chunk-5KXQMM4B.js";import{a as q}from"./chunk-XO5AROVW.js";import{A as I,k as y,p as F,r as T,v as N,z as D}from"./chunk-SQGBK3PG.js";import{Ba as x,Ib as t,La as s,Va as g,_a as c,ba as a,eb as C,ia as E,ja as b,jb as u,ob as e,pb as i,qb as d,ub as _,wa as f,yb as S,zb as v}from"./chunk-54LR7GFL.js";function X(o,l){o&1&&(e(0,"small",13),t(1," nombre debe tener m\xE1s de 2 caracteres "),i())}function $(o,l){o&1&&(e(0,"small",13),t(1," tel\xE9fono debe ser un n\xFAmero de 8 d\xEDgitos "),i())}function H(o,l){o&1&&(e(0,"small",13),t(1," formato incorrecto de correo "),i())}function K(o,l){o&1&&(e(0,"small",13),t(1," c\xE9dula debe tener enter 9 a 12 caracteres "),i())}function Q(o,l){if(o&1){let n=_();e(0,"form",7),S("ngSubmit",function(){E(n);let p=v();return b(p.onSubmit())}),e(1,"div",8)(2,"div",9)(3,"label",10),t(4,"Nombre "),e(5,"span",11),t(6,"*"),i()(),d(7,"input",12),c(8,X,2,0,"small",13),i(),e(9,"div",9)(10,"label",14),t(11,"Tel\xE9fono "),e(12,"span",11),t(13,"*"),i()(),d(14,"input",15),c(15,$,2,0,"small",13),i(),e(16,"div",9)(17,"label",16),t(18," Correo electr\xF3nico "),e(19,"span",11),t(20,"*"),i()(),d(21,"input",17),c(22,H,2,0,"small",13),i(),e(23,"div",9)(24,"label",18),t(25," C\xE9dula "),e(26,"span",11),t(27,"*"),i()(),d(28,"input",19),c(29,K,2,0,"small",13),i(),e(30,"div",9)(31,"label",20),t(32," Tipo C\xE9dula "),e(33,"span",11),t(34,"*"),i()(),e(35,"select",21)(36,"option",22),t(37,"F\xEDsica"),i(),e(38,"option",23),t(39,"Jur\xEDdica"),i(),e(40,"option",24),t(41,"DIMEX"),i(),e(42,"option",25),t(43,"NITE"),i()()(),e(44,"div",9)(45,"label",26),t(46," Moneda "),e(47,"span",11),t(48,"*"),i()(),e(49,"select",27)(50,"option",28),t(51,"USD"),i(),e(52,"option",29),t(53,"CRC"),i()()(),e(54,"div",9)(55,"label",30),t(56," Vendedor "),e(57,"span",31),t(58,"opcional"),i()(),d(59,"ng-select",32),i()(),e(60,"div",8)(61,"div",33)(62,"label",34),t(63," Notas "),e(64,"span",31),t(65,"opcional"),i()(),d(66,"textarea",35),i()(),e(67,"div",36)(68,"button",37),t(69,"Editar"),i()()()}if(o&2){let n=v();C("formGroup",n.editClientForm()),s(8),u(n.validField("name")?8:-1),s(7),u(n.validField("mobile")?15:-1),s(7),u(n.validField("email")?22:-1),s(7),u(n.validField("identity")?29:-1),s(30),C("items",n.sellers())("searchable",!0)}}var h=class o{platformId=a(x);fb=a(G);commonAdminService=a(P);router=a(T);activatedRoute=a(F);authService=a(N);clientService=a(D);formErrorService=a(j);customToastService=a(q);clientId;client=f(null);sellers=f([]);emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$";editClientForm=f(null);get isBrowser(){return y(this.platformId)}constructor(){this.clientId=this.activatedRoute.snapshot.params.id}ngOnInit(){this.fetchClient()}fetchClient(){this.clientService.fetchOne(this.clientId).subscribe(l=>{l&&l.id&&(this.client.set(l),this.fetchSellers())})}fetchSellers(){this.authService.fetchAllSellers().subscribe(l=>{if(l&&l.length){this.sellers.set(l);let n=this.sellers().find(m=>m.name===this.client()?.defaultSeller)||null;this.fillOutClientForm(n?.name??null)}})}fillOutClientForm(l){this.editClientForm.set(this.fb.group({name:[this.client()?.name??"",[r.required,r.minLength(2)]],email:[this.client()?.email??"",[r.required,r.pattern(this.emailPattern)]],mobile:[this.client()?.mobile??"",[r.required,r.minLength(8),r.maxLength(8)]],identity:[this.client()?.identity??"",[r.required,r.minLength(8),r.maxLength(12)]],identityType:[this.client()?.identityType,[r.required]],currency:[this.client()?.currency??"USD",[r.required]],notes:[this.client()?.notes??"",[]],defaultSeller:[l,[]]}))}validField(l){return this.editClientForm().controls[l].touched&&this.editClientForm().controls[l].invalid}onSubmit(){if(this.editClientForm()?.invalid){this.formErrorService.throwFormErrors(this.editClientForm());return}let l={};l.updatedAt=I(new Date);for(let n in this.editClientForm()?.value)if(this.editClientForm()?.value.hasOwnProperty(n)){let m=this.editClientForm().controls[n],p=m.value;m&&(l[n]=p),!p&&n==="defaultSeller"&&(l[n]=null)}this.clientService.update(this.clientId,l).subscribe(n=>{n&&n.msg?(this.customToastService.add({message:n.msg,type:"success",duration:5e3}),this.router.navigateByUrl("/list-clients")):this.customToastService.add({message:n.message,type:"error",duration:5e3})})}comeBackToList(){this.commonAdminService.comeBackToList("/list-clients")}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=g({type:o,selectors:[["edit-client"]],decls:9,vars:1,consts:[[1,"main_content"],[1,"box"],[1,"d-flex","justify-content-between"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"form",3,"formGroup"],[1,"form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],[1,"asterisk"],["type","text","formControlName","name"],[1,"text-danger"],["for","mobile"],["type","text","formControlName","mobile"],["for","email"],["type","text","formControlName","email"],["for","identity"],["type","text","formControlName","identity"],["for","identityType"],["formControlName","identityType",1,"w-100"],["value","01"],["value","02"],["value","03"],["value","04"],["for","currency"],["formControlName","currency",1,"w-100"],["value","USD"],["value","CRC"],["for","defaultSeller"],[1,"muted"],["bindLabel","name","bindValue","name","placeholder","--Seleccione--","formControlName","defaultSeller",3,"items","searchable"],[1,"col-12"],["for","notes"],["formControlName","notes","rows","2"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mt-5"],["type","submit",1,"btn","btn-success"]],template:function(n,m){n&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),t(4,"Editar cliente"),i(),e(5,"h4",4),S("click",function(){return m.comeBackToList()}),d(6,"i",5),t(7," Regresar "),i()(),c(8,Q,70,7,"form",6),i()()),n&2&&(s(8),u(m.editClientForm()?8:-1))},dependencies:[U,L,k,B,w,O,A,R,V,M,J,z],encapsulation:2,changeDetection:0})};export{h as default};
