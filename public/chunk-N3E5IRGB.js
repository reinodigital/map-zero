import{a as z}from"./chunk-WKFQL3IM.js";import{b as q,c as v,d as L,e as $,h as D,k as B,n as G,t as R,u as j}from"./chunk-5KSV7YSN.js";import{k as V,r as A,v as U}from"./chunk-G6MTQLVM.js";import{$a as _,Ab as m,Ba as F,Db as O,Jb as a,Kb as C,Lb as P,Ma as l,Wa as M,ba as c,fb as b,gb as k,hb as h,ia as N,ja as T,kb as w,lb as S,nb as x,ob as y,pb as n,qb as o,rb as p,vb as I,wa as d,zb as u}from"./chunk-F6XVVQNR.js";function H(r,e){if(r&1){let i=I();n(0,"div",38),u("click",function(){let s=N(i).$index,g=m();return T(g.selectPill(s))}),n(1,"div",39),a(2),o()()}if(r&2){let i=e.$implicit,t=e.$index,s=m();k("color","var(--white)")("background-color",t===s.currentPillSelected()?"var(--primary_orange)":"unset"),l(2),P(" ",i," ")}}function J(r,e){if(r&1&&(n(0,"div",20),a(1),o()),r&2){let i=e.$implicit,t=e.$index;O("id",t),l(),C(i)}}function K(r,e){r&1&&(n(0,"small",35),a(1," Debe proporcionar la nueva contrase\xF1a "),o())}function Q(r,e){if(r&1&&(n(0,"small",35),a(1),o()),r&2){let i=m(2);l(),P(" La nueva contrase\xF1a debe tener al menos ",i.formErrors("newPassword").minlength.requiredLength," caracteres ")}}function W(r,e){if(r&1&&_(0,K,2,0,"small",35)(1,Q,2,1,"small",35),r&2){let i=m();w(i.formErrors("newPassword")&&i.formErrors("newPassword").required?0:i.formErrors("newPassword")&&i.formErrors("newPassword").minlength?1:-1)}}function X(r,e){r&1&&(n(0,"small",35),a(1," Debe confirmar la nueva contrase\xF1a "),o())}function Y(r,e){if(r&1&&(n(0,"small",35),a(1),o()),r&2){let i=m(2);l(),P(" La contrase\xF1a debe tener al menos ",i.formErrors("confirmNewPassword").minlength.requiredLength," caracteres ")}}function Z(r,e){if(r&1&&_(0,X,2,0,"small",35)(1,Y,2,1,"small",35),r&2){let i=m();w(i.formErrors("confirmNewPassword")&&i.formErrors("confirmNewPassword").required?0:i.formErrors("confirmNewPassword")&&i.formErrors("confirmNewPassword").minlength?1:-1)}}function ee(r,e){r&1&&(n(0,"small",35),a(1," Las contrase\xF1as no coinciden "),o())}var E=class r{authService=c(U);router=c(A);platformId=c(F);isBrowser=V(this.platformId);customToastService=c(z);currentUser=d(null);maintenances=d([]);totalMaintenances=d(0);arrPills=["Mi perfil"];currentPillSelected=d(0);idPillArr=["pills-profile-tab"];fb=c(R);formChangePassword=d(this.fb.group({newPassword:["",[v.required,v.minLength(6)]],confirmNewPassword:["",[v.required,v.minLength(6)]]},{validators:[this.passwordsMatchValidator]}));hiddenNewPassword=d(!0);hiddenConfirmNewPassword=d(!0);constructor(){this.currentUser.set(this.authService.userProps)}clickOverPill(){if(this.isBrowser){let e=this.idPillArr[this.currentPillSelected()];document.querySelector(`#${e}`).click()}}selectPill(e){e!==this.currentPillSelected()&&(this.currentPillSelected.set(e),this.clickOverPill())}logout(){this.authService.logout().subscribe(e=>{e&&e.ok&&this.router.navigateByUrl("/login")})}isInvalidField(e){return this.formChangePassword().controls[e].touched&&this.formChangePassword().controls[e].invalid}formErrors(e){return this.formChangePassword().get(e)?.errors}passwordsMatchValidator(e){let i=e.get("newPassword")?.value,t=e.get("confirmNewPassword")?.value;return i===t?null:{passwordsMismatch:!0}}onSubmit(){if(this.formChangePassword().valid){let e=this.currentUser(),i={name:e.name,mobile:e.mobile,email:e.email??"",password:this.formChangePassword().get("newPassword")?.value,roles:e.roles};this.authService.update(e.uid,i).subscribe(t=>{t&&t.msg?(this.formChangePassword().reset(),this.customToastService.add({message:t.msg,type:"success",duration:3e3})):this.customToastService.add({message:t.message,type:"error",duration:1e4})})}else this.formChangePassword().markAllAsTouched()}toggleVisibilityNewPassword(){this.hiddenNewPassword.update(e=>!e)}toggleVisibilityConfirmNewPassword(){this.hiddenConfirmNewPassword.update(e=>!e)}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=M({type:r,selectors:[["profile"]],decls:67,vars:16,consts:[[1,"profile","container"],[1,"div_selects_pills"],[1,"square_pill",3,"color","backgroundColor"],["id","pills-tab","role","tablist",1,"nav","nav-pills","mb-3","div_pills",2,"display","none"],["role","presentation",1,"nav-item"],["id","pills-profile-tab","data-bs-toggle","pill","type","button","data-bs-target","#pills-profile","role","tab","aria-controls","pills-profile","aria-selected","true",1,"nav-link","active"],["id","pills-tabContent",1,"tab-content"],["id","pills-profile","role","tabpanel","aria-labelledby","pills-profile-tab","tabindex","0",1,"tab-pane","fade","active","show"],[1,"profile_content"],[1,"box"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"profile_content_title"],[1,"info_user"],[1,"single_info"],[1,"mb-3"],[1,"user_name"],[1,"fa-solid","fa-mobile-button","me-3"],[1,"mb-0","text_light"],[1,"fa-solid","fa-envelope-circle-check","me-2"],[1,"fa-solid","fa-dice-five","me-3"],[3,"id"],[1,"info_actions","mt-4","mb-4"],["type","button","data-bs-toggle","collapse","data-bs-target","#changePassword","aria-expanded","false","aria-controls","myCollapse","title","Cambiar contrase\xF1a",1,"btn","btn-primary","me-2"],["type","button","title","logout",1,"btn","btn-danger",3,"click"],[1,"info_change_password"],["id","changePassword",1,"collapse","mt-3"],[1,"form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","newPassword",1,"label_password"],[1,"asterisk"],[1,"fa-solid",3,"click"],["formControlName","newPassword",3,"type"],["for","confirmNewPassword",1,"label_password"],["formControlName","confirmNewPassword",3,"type"],[1,"text-danger"],[1,"row","mt-2"],["type","submit",1,"btn","btn-primary"],[1,"square_pill",3,"click"],[1,"d-flex","justify-content-center"]],template:function(i,t){if(i&1&&(n(0,"div",0)(1,"div",1),x(2,H,3,5,"div",2,S),o(),n(4,"ul",3)(5,"li",4)(6,"button",5),a(7," Mi perfil "),o()()(),n(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"h2",11),a(14,"Perfil"),o()(),n(15,"section",12)(16,"div",13)(17,"p",14)(18,"span",15),a(19),o()()(),n(20,"div",13),p(21,"i",16),n(22,"p",17),a(23),o()(),n(24,"div",13),p(25,"i",18),n(26,"p",17),a(27),o()(),n(28,"div",13),p(29,"i",19),n(30,"p",17)(31,"span"),x(32,J,2,2,"div",20,S),o()()()(),n(34,"section",21)(35,"button",22),a(36," Cambiar contrase\xF1a "),o(),n(37,"button",23),u("click",function(){return t.logout()}),a(38," Cerrar sesi\xF3n "),o()(),n(39,"section",24)(40,"div",25)(41,"form",26),u("ngSubmit",function(){return t.onSubmit()}),n(42,"div",27)(43,"div",28)(44,"label",29)(45,"div"),a(46," Contrase\xF1a nueva "),n(47,"span",30),a(48,"*"),o()(),n(49,"i",31),u("click",function(){return t.toggleVisibilityNewPassword()}),o()(),p(50,"input",32),_(51,W,2,1),o()(),n(52,"div",27)(53,"div",28)(54,"label",33)(55,"div"),a(56," Confirme la nueva contrase\xF1a "),n(57,"span",30),a(58,"*"),o()(),n(59,"i",31),u("click",function(){return t.toggleVisibilityConfirmNewPassword()}),o()(),p(60,"input",34),_(61,Z,2,1)(62,ee,2,0,"small",35),o()(),n(63,"div",36)(64,"div",28)(65,"button",37),a(66," Enviar "),o()()()()()()()()()()()),i&2){let s,g,f;l(2),y(t.arrPills),l(17),C((s=t.currentUser())==null?null:s.name),l(4),C((g=t.currentUser())==null?null:g.mobile),l(4),P(" ",(f=(f=t.currentUser())==null?null:f.email)!==null&&f!==void 0?f:"sin correo electr\xF3nico"," "),l(5),y(t.currentUser().roles),l(9),b("formGroup",t.formChangePassword()),l(8),h("fa-eye",t.hiddenNewPassword())("fa-eye-slash",!t.hiddenNewPassword()),l(),b("type",t.hiddenNewPassword()?"password":"text"),l(),w(t.isInvalidField("newPassword")?51:-1),l(8),h("fa-eye",t.hiddenConfirmNewPassword())("fa-eye-slash",!t.hiddenConfirmNewPassword()),l(),b("type",t.hiddenConfirmNewPassword()?"password":"text"),l(),w(t.isInvalidField("confirmNewPassword")?61:t.formChangePassword().errors&&t.formChangePassword().errors.passwordsMismatch&&t.formChangePassword().touched?62:-1)}},dependencies:[j,D,q,L,$,B,G],styles:[".profile[_ngcontent-%COMP%]{margin-bottom:5rem}.profile[_ngcontent-%COMP%]   .label_password[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.profile_content[_ngcontent-%COMP%]{width:100%}.profile_content[_ngcontent-%COMP%]   .profile_content_title[_ngcontent-%COMP%]{color:var(--primary_orange);cursor:pointer;font-size:2rem}.info_user[_ngcontent-%COMP%]   .single_info[_ngcontent-%COMP%]{display:flex;align-items:center}.info_user[_ngcontent-%COMP%]   .single_info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary_orange)}"]})};export{E as default};
