import{a as le}from"./chunk-NZ66KANC.js";import"./chunk-YLYPY7Y2.js";import{a as re}from"./chunk-5BOVWHXY.js";import"./chunk-ZXERMP2K.js";import{a as ae}from"./chunk-KVBJ4PGU.js";import{u as ee,v as te,w as ie}from"./chunk-IBKVHNU3.js";import{a as h}from"./chunk-GZHOXXQG.js";import{a as oe}from"./chunk-5LJDG4R3.js";import{a as ne}from"./chunk-FUDPSQJN.js";import{a as Z}from"./chunk-WKFQL3IM.js";import{u as Y}from"./chunk-UP3F5373.js";import{A as B,L as M,i as H,j as W,k as G,p as J,r as K,s as X}from"./chunk-4ZQGKSBB.js";import{$a as g,Ab as s,Ba as z,Jb as n,Kb as f,Lb as T,Ma as l,Ra as j,Sb as D,Tb as O,Ub as k,Wa as w,X as L,ba as _,fb as E,hb as $,ia as x,ib as R,j as N,ja as v,kb as C,na as I,nb as q,ob as A,pb as e,qb as t,rb as u,vb as S,wa as b,zb as m}from"./chunk-F6XVVQNR.js";var ue=(o,a)=>a.entity;function me(o,a){if(o&1){let i=S();e(0,"li",8),m("click",function(){let r=x(i).$implicit,p=s();return v(p.onSelectOption(r.entity))}),e(1,"div",9)(2,"span",10),n(3," _ "),t(),e(4,"strong",11),n(5),t(),e(6,"span",12),n(7),t()()()}if(o&2){let i=a.$implicit,d=s();l(2),$("bg_blue",d.selectedOption()===i.entity),l(3),f(i.label),l(2),f(i.text)}}var V=class o{constructor(a){this.data=a;this.quoteId.set(a.quoteId)}dialogRef=_(ee);destroyRef=_(I);router=_(K);quoteService=_(M);detailCopyQuoteToService=_(Q);customToastService=_(Z);quoteId=b(null);selectedOption=b(null);arrCopyToOptions=[{entity:"Quote",label:"Cotizaci\xF3n",text:"reutilizar el contenido en una nueva cotizaci\xF3n"},{entity:"Invoice",label:"Factura",text:"facturar esta cotizaci\xF3n a un cliente"},{entity:"PurchaseOrder",label:"Orden de compra",text:"ordenar compra de esta cotizaci\xF3n"}];onSelectOption(a){this.selectedOption.set(a)}closePopUp(){this.dialogRef.close()}executeCopy(){if(this.selectedOption())switch(this.selectedOption()){case"Quote":this.generateCopyToQuote();break;case"Invoice":this.generateCopyToInvoice();break;case"PurchaseOrder":break;default:break}}generateCopyToQuote(){let a=B(new Date);this.quoteService.copyToDraft(this.quoteId(),a).pipe(h(this.destroyRef)).subscribe(i=>{i&&i.id?(this.customToastService.add({message:"Cotizaci\xF3n como borrador generada correctamente.",type:"success",duration:5e3}),this.closePopUp(),this.router.navigateByUrl(`/detail-quote/${i.id}`),this.detailCopyQuoteToService.triggerCurrentQuoteHasBeenCopied(i.id)):this.customToastService.add({message:i.message,type:"error",duration:5e3})})}generateCopyToInvoice(){let a={createdAt:B(new Date),markAsInvoiced:null};this.quoteService.copyToInvoice(this.quoteId(),a).pipe(h(this.destroyRef)).subscribe(i=>{i&&i.id?(this.customToastService.add({message:"Factura como borrador generada correctamente.",type:"success",duration:5e3}),this.closePopUp(),this.router.navigateByUrl(`/edit-invoice/${i.id}`)):this.customToastService.add({message:i.message,type:"error",duration:5e3})})}static \u0275fac=function(i){return new(i||o)(j(te))};static \u0275cmp=w({type:o,selectors:[["modal-copy-quote-to"]],decls:13,vars:1,consts:[[1,"modal_copy_to_quote","p-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"fa-solid","fa-xmark","fs-3",3,"click"],[1,"list-group"],[1,"list-group-item","list-group-item-light","cp"],[1,"d-flex","justify-content-end","w_100","gap-3","mt-5"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"list-group-item","list-group-item-light","cp",3,"click"],[1,"d-flex","align-items-center"],[1,"circle_check","me-2"],[1,"fs-5","me-2"],[1,"fs-5"]],template:function(i,d){i&1&&(e(0,"div",0)(1,"div",1)(2,"h3"),n(3,"Copiar cotizaci\xF3n a"),t(),e(4,"i",2),m("click",function(){return d.closePopUp()}),t()(),e(5,"ul",3),q(6,me,8,4,"li",4,ue),t(),e(8,"div",5)(9,"button",6),m("click",function(){return d.closePopUp()}),n(10," Cancelar "),t(),e(11,"button",7),m("click",function(){return d.executeCopy()}),n(12," Crear borrador "),t()()()),i&2&&(l(6),A(d.arrCopyToOptions),l(5),E("disabled",!d.selectedOption()))},dependencies:[Y],styles:[".form[_ngcontent-%COMP%]{padding:2rem}label[_ngcontent-%COMP%]{color:var(--black)}.header_form[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.header_form[_ngcontent-%COMP%]   .icon_close[_ngcontent-%COMP%]{font-size:2.3rem}"],changeDetection:0})};var Q=class o{dialog=_(ie);_currentQuoteCopied$=new N;currentQuoteCopied$=this._currentQuoteCopied$.asObservable();displayModalCopyQuoteTo(a){this.dialog.open(V,{width:"70rem",height:"auto",autoFocus:!1,data:{quoteId:a}}).updatePosition({top:"100px"})}triggerCurrentQuoteHasBeenCopied(a){this._currentQuoteCopied$.next(a)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})};var pe=(o,a)=>a.id;function _e(o,a){if(o&1&&(e(0,"button",13),u(1,"i",39),n(2," Editar "),t()),o&2){let i=s(2);E("routerLink","/edit-quote/"+i.quoteId)}}function Ce(o,a){if(o&1){let i=S();e(0,"button",40),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.markAsAccepted(r.quoteId))}),n(1," Marcar como aceptada "),t()}}function fe(o,a){if(o&1){let i=S();e(0,"button",40),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.createInvoiceFromQuote(r.quote()))}),n(1," Crear factura "),t()}}function xe(o,a){o&1&&u(0,"div",16)}function ve(o,a){o&1&&u(0,"i",17)}function Se(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.markAsAccepted(r.quoteId))}),u(2,"i",41),n(3," Marcar como aceptada "),t()()}}function be(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.displayModalQuoteEmail(r.quote()))}),u(2,"i",42),n(3," Enviar "),t()()}}function Te(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.markAsSent(r.quoteId))}),u(2,"i",43),n(3," Marcar como enviada "),t()()}}function ye(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.undoMarkAsAccepted(r.quoteId))}),u(2,"i",44),n(3," Desmarcar como aceptada "),t()()}}function ge(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.undoMarkAsDeclined(r.quoteId))}),u(2,"i",44),n(3," Desmarcar como rechazada "),t()()}}function Ee(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.undoMarkAsInvoiced(r.quoteId))}),u(2,"i",44),n(3," Desmarcar como facturada "),t()()}}function De(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.markAsDeclined(r.quoteId))}),u(2,"i",45),n(3," Marcar como rechazada "),t()()}}function he(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.markAsInvoiced(r.quoteId))}),u(2,"i",46),n(3," Marcar como facturada "),t()()}}function Qe(o,a){if(o&1&&(e(0,"li")(1,"button",47),u(2,"i",48),n(3," Editar "),t()()),o&2){let i=s(2);l(),E("routerLink","/edit-quote/"+i.quoteId)}}function ke(o,a){if(o&1){let i=S();e(0,"li")(1,"button",19),m("click",function(){x(i);let r=s(2);return v(r.detailQuoteService.removeQuote(r.quote()))}),u(2,"i",49),n(3," Remover "),t()()}}function Ie(o,a){if(o&1&&(e(0,"tr")(1,"td")(2,"span"),n(3),t()(),e(4,"td")(5,"span"),n(6),t()(),e(7,"td")(8,"span"),n(9),t()(),e(10,"td")(11,"span"),n(12),t()(),e(13,"td")(14,"span"),n(15),t()(),e(16,"td")(17,"span"),n(18),t()(),e(19,"td")(20,"span"),n(21),t()(),e(22,"td")(23,"span"),n(24),t()(),e(25,"td",50)(26,"span"),n(27),t()()()),o&2){let i,d,r,p=a.$implicit,y=s(2);l(3),f(p.item.name),l(3),f(p.description),l(3),f(p.quantity),l(3),f(p.price),l(3),f(p.discount),l(3),f((i=p.account==null?null:p.account.name)!==null&&i!==void 0?i:"_"),l(3),T(" ",y.detailQuoteService.getTaxRateLabel((d=p.taxRate)!==null&&d!==void 0?d:"")," "),l(3),f((r=p.seller==null?null:p.seller.name)!==null&&r!==void 0?r:"_"),l(3),f(p.amount)}}function we(o,a){o&1&&(e(0,"tr",31)(1,"td",51),n(2," No existen Art\xEDculos ni servicios en esta cotizaci\xF3n. "),t()())}function qe(o,a){if(o&1){let i=S();e(0,"div",8)(1,"div",9)(2,"span",10),n(3),t(),e(4,"span"),n(5),t()(),e(6,"div",11)(7,"button",12),n(8,"Imprimir PDF"),t(),g(9,_e,3,1,"button",13)(10,Ce,2,0,"button",14)(11,fe,2,0,"button",14),e(12,"div",15),g(13,xe,1,0,"div",16)(14,ve,1,0,"i",17),e(15,"ul",18),g(16,Se,4,0,"li")(17,be,4,0,"li"),e(18,"button",19),m("click",function(){x(i);let r=s();return v(r.detailCopyQuoteToService.displayModalCopyQuoteTo(r.quoteId))}),u(19,"i",20),n(20," Copiar a "),t(),g(21,Te,4,0,"li")(22,ye,4,0,"li")(23,ge,4,0,"li")(24,Ee,4,0,"li")(25,De,4,0,"li")(26,he,4,0,"li")(27,Qe,4,1,"li")(28,ke,4,0,"li"),e(29,"li"),u(30,"div",21),e(31,"small",22),n(32,"Acciones"),t()()()()()(),e(33,"div",23)(34,"div",24)(35,"label"),n(36,"Cliente"),t(),e(37,"span"),n(38),t()(),e(39,"div",24)(40,"label"),n(41,"Fecha inicio"),t(),e(42,"span"),n(43),D(44,"readableDate"),t()(),e(45,"div",24)(46,"label"),n(47,"Fecha expira"),t(),e(48,"span"),n(49),D(50,"readableDate"),t()(),e(51,"div",24)(52,"label"),n(53,"N\xFAmero cotizaci\xF3n"),t(),e(54,"span"),n(55),t()(),e(56,"div",24)(57,"label"),n(58,"Moneda"),t(),e(59,"span"),n(60),t()(),e(61,"div",24)(62,"label"),n(63,"Estado"),t(),e(64,"span"),n(65),t()()(),e(66,"div",25)(67,"table",26)(68,"thead")(69,"tr")(70,"th",27)(71,"span"),n(72,"Item"),t()(),e(73,"th",28)(74,"span"),n(75,"Descripci\xF3n"),t()(),e(76,"th",29)(77,"span"),n(78," Cantidad "),t()(),e(79,"th",29)(80,"span"),n(81,"Precio"),t()(),e(82,"th",29)(83,"span"),n(84,"Descuento"),t()(),e(85,"th",29)(86,"span"),n(87,"Cuenta"),t()(),e(88,"th",29)(89,"span"),n(90,"Impuesto"),t()(),e(91,"th",29)(92,"span"),n(93,"Vendedor"),t()(),e(94,"th",30)(95,"span"),n(96,"Monto"),t()()()(),e(97,"tbody"),q(98,Ie,28,9,"tr",null,pe,!1,we,3,0,"tr",31),t()()(),e(101,"div",32)(102,"div",33)(103,"ul",34)(104,"li",35)(105,"span"),n(106,"Subtotal"),t(),e(107,"span"),n(108),D(109,"number"),t()(),e(110,"li",35)(111,"span"),n(112,"Descuento total"),t(),e(113,"span",36),n(114),D(115,"number"),t()(),e(116,"li",35)(117,"span"),n(118,"Impuesto total"),t(),e(119,"span"),n(120),D(121,"number"),t()(),u(122,"div",37),e(123,"li",38)(124,"span"),n(125,"Total"),t(),e(126,"strong"),n(127),D(128,"number"),t()()()()()}if(o&2){let i,d,r,p,y,P,U,c=s();l(3),f((i=c.quote())==null?null:i.quoteNumber),l(),R(c.detailQuoteService.getStatusBadgeFromQuote((d=(d=c.quote())==null?null:d.status)!==null&&d!==void 0?d:"")),l(),T(" ",(r=c.quote())==null?null:r.status," "),l(4),C(c.allowedStatusToBeEditedFromDraft.includes(c.quote().status)?9:-1),l(),C(c.allowedStatusToBeAccepted.includes(c.quote().status)?10:-1),l(),C(c.allowedStatusToBeInvoiced.includes(c.quote().status)?11:-1),l(2),C(c.detailQuoteService.isSendEmailFromDetailComponentSubmitting()?13:14),l(3),C(c.allowedStatusToBeAccepted.includes(c.quote().status)?16:-1),l(),C(c.allowedStatusToBeSent.includes(c.quote().status)?17:-1),l(4),C(c.allowedStatusToMarkAsSent.includes(c.quote().status)?21:-1),l(),C(c.allowedStatusToUnMarkAsAccepted.includes(c.quote().status)?22:-1),l(),C(c.allowedStatusToUnMarkAsDeclined.includes(c.quote().status)?23:-1),l(),C(c.allowedStatusToUnMarkAsInvoiced.includes(c.quote().status)?24:-1),l(),C(c.allowedStatusToBeDeclined.includes(c.quote().status)?25:-1),l(),C(c.allowedStatusToBeInvoiced.includes(c.quote().status)?26:-1),l(),C(c.allowedStatusToBeEdited.includes(c.quote().status)?27:-1),l(),C(c.quote().status!=="removida"?28:-1),l(10),f((p=c.quote())==null||p.client==null?null:p.client.name),l(5),f(O(44,31,c.quote().initDate)),l(6),T(" ",c.quote().expireDate?O(50,33,c.quote().expireDate):"_"," "),l(6),T(" ",c.quote().quoteNumber," "),l(5),T(" ",c.quote().currency," "),l(4),R(c.detailQuoteService.getStatusBadgeFromQuote((y=(y=c.quote())==null?null:y.status)!==null&&y!==void 0?y:"")),l(),T(" ",(P=c.quote())==null?null:P.status," "),l(33),A((U=c.quote())==null?null:U.quoteItems),l(10),f(k(109,35,c.subtotal(),"1.2-2")),l(6),T(" - ",k(115,38,c.totalDiscount(),"1.2-2")," "),l(6),f(k(121,41,c.totalTax(),"1.2-2")),l(7),T(" ",k(128,44,c.totalAmount(),"1.2-2")," ")}}function Ae(o,a){if(o&1&&u(0,"tracking-entity",7),o&2){let i=s();E("tracking",i.quote().tracking)("entity",i.entityData())}}var F=class o{platformId=_(z);activatedRoute=_(J);commonAdminService=_(ne);destroyRef=_(I);quoteService=_(M);entityData=b(null);detailQuoteService=_(le);detailCopyQuoteToService=_(Q);allowedStatusToBeEditedFromDraft=["borrador"];allowedStatusToBeSent=["borrador","enviada"];allowedStatusToMarkAsSent=["borrador"];allowedStatusToBeAccepted=["enviada"];allowedStatusToBeInvoiced=["aceptada"];allowedStatusToBeDeclined=["enviada"];allowedStatusToBeEdited=["borrador","enviada"];allowedStatusToUnMarkAsAccepted=["aceptada"];allowedStatusToUnMarkAsDeclined=["rechazada"];allowedStatusToUnMarkAsInvoiced=["facturada"];get isBrowser(){return G(this.platformId)}quoteId;quote=b(null);subtotal=b(0);totalDiscount=b(0);totalTax=b(0);totalAmount=b(0);constructor(){this.quoteId=this.activatedRoute.snapshot.params.id,this.entityData.set({refEntity:"Quote",refEntityId:this.quoteId})}ngOnInit(){this.fetchQuote(),this.detailQuoteService.statusChange$.pipe(h(this.destroyRef)).subscribe(()=>{this.fetchQuote()}),this.listenWhenCurrentQuoteHasBeenCopied()}listenWhenCurrentQuoteHasBeenCopied(){this.detailCopyQuoteToService.currentQuoteCopied$.pipe(h(this.destroyRef)).subscribe(a=>{a&&(this.quoteId=a,this.fetchQuote())})}fetchQuote(){this.quoteService.fetchOne(this.quoteId).pipe(h(this.destroyRef)).subscribe(a=>{a&&a.id&&(this.quote.set(a),this.updateTotals())})}updateTotals(){let a=this.detailQuoteService.calculateTotalsOnDetail(this.quote()?.quoteItems??[]);this.subtotal.set(a.subtotal),this.totalDiscount.set(a.discounts),this.totalTax.set(a.iva),this.totalAmount.set(a.total)}comeBackToList(){this.commonAdminService.comeBackToList("/list-quotes")}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=w({type:o,selectors:[["detail-quote"]],decls:11,vars:6,consts:[[1,"main_content"],[3,"primaryText","primaryLink","secondaryText","secondaryLink"],[1,"box"],[1,"d-flex","justify-content-between","mb-3"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[3,"tracking","entity"],[1,"d-flex","justify-content-between","mb-4"],[1,"d-flex","align-items-center"],[1,"me-3"],[1,"hstack","gap-3"],[1,"btn","btn-outline-secondary"],["type","button",1,"btn","btn-primary",3,"routerLink"],["type","button",1,"btn","btn-primary"],[1,"dropdown"],[1,"spinner","ms-1"],["data-bs-toggle","dropdown","aria-expanded","false",1,"fa-solid","fa-ellipsis-vertical","three_points_dropdown"],[1,"dropdown-menu"],["type","button",1,"dropdown-item",3,"click"],[1,"fa-solid","fa-clone","icon_copy_to","me-2"],[1,"line_divider","mt-3","mb-2"],[1,"ms-3","fs-4"],[1,"row","mb-5"],[1,"col-12","col-md-3","col-lg-2"],[1,"row","table_items"],[1,"table","table-sm","mb-3"],[1,"col-2"],[1,"col-3"],[1,"col-1"],[1,"col-1","text-end"],[1,"no-elements"],[1,"row","mt-4"],[1,"col-md-6","col-lg-4","offset-md-6","offset-lg-8"],[1,"list-group","list-group-flush"],[1,"total_price","d-flex","justify-content-between"],[1,"text-danger"],[1,"line_divider"],[1,"total_price","d-flex","justify-content-between","mt-3"],[1,"fa-solid","fa-pen-to-square","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-check","icon_accepted","me-2"],[1,"fa-solid","fa-paper-plane","icon_sent","me-2"],[1,"fa-solid","fa-marker","icon_mark_as_sent","me-2"],[1,"fa-solid","fa-repeat","icon_trash","me-2"],[1,"fa-solid","fa-xmark","icon_declined","me-2"],[1,"fa-solid","fa-file-invoice-dollar","icon_accepted","me-2"],["type","button",1,"dropdown-item",3,"routerLink"],[1,"fa-solid","fa-pen-to-square","icon_pencil","me-2"],[1,"fa-solid","fa-trash","icon_trash","me-2"],[1,"text-end"],["colspan","12"]],template:function(i,d){i&1&&(e(0,"div",0),u(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"h3",4),n(5,"Detalle cotizaci\xF3n"),t(),e(6,"h4",5),m("click",function(){return d.comeBackToList()}),u(7,"i",6),n(8," Regresar "),t()(),g(9,qe,129,47),t()(),g(10,Ae,1,2,"tracking-entity",7)),i&2&&(l(),E("primaryText","Vista de ventas")("primaryLink","/sales-overview")("secondaryText","Listado cotizaciones")("secondaryLink","/list-quotes"),l(8),C(d.quote()?9:-1),l(),C(d.quote()?10:-1))},dependencies:[W,H,X,re,ae,oe],styles:[".table_items[_ngcontent-%COMP%]{padding-top:4rem}th[_ngcontent-%COMP%]{color:var(--text);font-size:medium;font-weight:400}.total_price[_ngcontent-%COMP%]{font-size:1.3rem;margin-bottom:.4rem}"],changeDetection:0})};export{F as default};
