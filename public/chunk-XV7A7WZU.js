import{a as X}from"./chunk-TPFLEZ32.js";import{a as W,b as J}from"./chunk-DYL4BDVC.js";import"./chunk-GZHOXXQG.js";import"./chunk-MXFBXJ6G.js";import{a as z}from"./chunk-HT52MB4M.js";import{a as j}from"./chunk-VNY5M2TF.js";import{a as U}from"./chunk-W2PMZUXL.js";import{a as G}from"./chunk-WKFQL3IM.js";import{b as w,c as a,d as D,e as R,h as V,k as L,n as O,o as k,p as M,q as B,t as P,u as q}from"./chunk-5KSV7YSN.js";import{A,k as _,p as F,r as T,v as I,z as N}from"./chunk-G6MTQLVM.js";import{$a as p,Ab as f,Ba as y,Jb as i,Ma as c,Wa as g,ba as m,fb as v,ia as b,ja as h,kb as u,pb as e,qb as t,rb as s,vb as E,wa as C,zb as S}from"./chunk-F6XVVQNR.js";function H(o,n){o&1&&(e(0,"small",23),i(1," nombre debe tener m\xE1s de 2 caracteres "),t())}function K(o,n){o&1&&(e(0,"small",23),i(1," tel\xE9fono debe ser un n\xFAmero de 8 d\xEDgitos "),t())}function Q(o,n){o&1&&(e(0,"small",23),i(1," formato incorrecto de correo "),t())}function Y(o,n){o&1&&(e(0,"small",23),i(1," c\xE9dula debe tener enter 9 a 12 caracteres "),t())}function Z(o,n){if(o&1){let l=E();e(0,"form",17),S("ngSubmit",function(){b(l);let d=f();return h(d.onSubmit())}),e(1,"div",18)(2,"div",19)(3,"label",20),i(4,"Nombre "),e(5,"span",21),i(6,"*"),t()(),s(7,"input",22),p(8,H,2,0,"small",23),t(),e(9,"div",19)(10,"label",24),i(11," Tipo contacto "),e(12,"span",21),i(13,"*"),t()(),e(14,"select",25)(15,"option",26),i(16,"CLIENTE"),t(),e(17,"option",27),i(18,"PROVEEDOR"),t()()(),e(19,"div",19)(20,"label",28),i(21," Tel\xE9fono "),e(22,"span",21),i(23,"*"),t()(),s(24,"input",29),p(25,K,2,0,"small",23),t(),e(26,"div",19)(27,"label",30),i(28," Correo electr\xF3nico "),e(29,"span",21),i(30,"*"),t()(),s(31,"input",31),p(32,Q,2,0,"small",23),t(),e(33,"div",19)(34,"label",32),i(35," C\xE9dula "),e(36,"span",21),i(37,"*"),t()(),s(38,"input",33),p(39,Y,2,0,"small",23),t(),e(40,"div",19)(41,"label",34),i(42," Tipo C\xE9dula "),e(43,"span",21),i(44,"*"),t()(),e(45,"select",35)(46,"option",36),i(47,"F\xEDsica"),t(),e(48,"option",37),i(49,"Jur\xEDdica"),t(),e(50,"option",38),i(51,"DIMEX"),t(),e(52,"option",39),i(53,"NITE"),t()()(),e(54,"div",19)(55,"label",40),i(56," Moneda "),e(57,"span",21),i(58,"*"),t()(),e(59,"select",41)(60,"option",42),i(61,"USD"),t(),e(62,"option",43),i(63,"CRC"),t()()(),e(64,"div",19)(65,"label",44),i(66," Vendedor "),e(67,"span",45),i(68,"opcional"),t()(),s(69,"ng-select",46),t()(),e(70,"div",18)(71,"div",47)(72,"label",48),i(73," Notas "),e(74,"span",45),i(75,"opcional"),t()(),s(76,"textarea",49),t()(),e(77,"div",50)(78,"button",51),i(79,"Editar"),t()()()}if(o&2){let l=f();v("formGroup",l.editClientForm()),c(8),u(l.validField("name")?8:-1),c(17),u(l.validField("mobile")?25:-1),c(7),u(l.validField("email")?32:-1),c(7),u(l.validField("identity")?39:-1),c(30),v("items",l.sellers())("searchable",!0)}}function ee(o,n){if(o&1){let l=E();e(0,"economic-activity-select",52),S("activityChange",function(d){b(l);let $=f();return h($.onEconomicActivityChange(d))}),t()}if(o&2){let l=f();v("activityInput",l.editClientForm().controls.activities.value)}}var x=class o{platformId=m(y);fb=m(P);commonAdminService=m(j);router=m(T);activatedRoute=m(F);authService=m(I);clientService=m(N);formErrorService=m(U);customToastService=m(G);clientId;client=C(null);sellers=C([]);emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$";editClientForm=C(null);get isBrowser(){return _(this.platformId)}constructor(){this.clientId=this.activatedRoute.snapshot.params.id}ngOnInit(){this.fetchClient()}fetchClient(){this.clientService.fetchOne(this.clientId).subscribe(n=>{n&&n.id&&(this.client.set(n),this.fetchSellers())})}onEconomicActivityChange(n){this.editClientForm()?.controls.activities.patchValue(n)}fetchSellers(){this.authService.fetchAllSellers().subscribe(n=>{if(n&&n.length){this.sellers.set(n);let l=this.sellers().find(r=>r.name===this.client()?.defaultSeller)||null;this.fillOutClientForm(l?.name??null)}})}fillOutClientForm(n){this.editClientForm.set(this.fb.group({name:[this.client()?.name??"",[a.required,a.minLength(2)]],type:[this.client()?.type,[a.required]],email:[this.client()?.email??"",[a.required,a.pattern(this.emailPattern)]],mobile:[this.client()?.mobile??"",[a.required,a.minLength(8),a.maxLength(8)]],identity:[this.client()?.identity??"",[a.required,a.minLength(8),a.maxLength(12)]],identityType:[this.client()?.identityType,[a.required]],currency:[this.client()?.currency??"USD",[a.required]],notes:[this.client()?.notes??"",[]],defaultSeller:[n,[]],activities:[this.createActivitiesObjectWhenInit(),[]]}))}createActivitiesObjectWhenInit(){return this.client()?.activities.map(n=>({code:n.code,name:n.name}))??[]}validField(n){return this.editClientForm().controls[n].touched&&this.editClientForm().controls[n].invalid}onSubmit(){if(this.editClientForm()?.invalid){this.formErrorService.throwFormErrors(this.editClientForm());return}let n={};n.updatedAt=A(new Date);for(let l in this.editClientForm()?.value)if(this.editClientForm()?.value.hasOwnProperty(l)){let r=this.editClientForm().controls[l],d=r.value;r&&(n[l]=d),!d&&l==="defaultSeller"&&(n[l]=null)}this.clientService.update(this.clientId,n).subscribe(l=>{l&&l.msg?(this.customToastService.add({message:l.msg,type:"success",duration:5e3}),this.router.navigateByUrl("/list-clients")):this.customToastService.add({message:l.message,type:"error",duration:5e3})})}comeBackToList(){this.commonAdminService.comeBackToList("/list-clients")}static \u0275fac=function(l){return new(l||o)};static \u0275cmp=g({type:o,selectors:[["edit-client"]],decls:21,vars:4,consts:[[1,"main_content"],[3,"primaryText","primaryLink"],[1,"box"],[1,"d-flex","justify-content-between","mb-4"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"d-flex","justify-content-between","align-items-center"],["id","pills-tab","role","tablist",1,"nav","nav-pills","mb-4","div_pills"],["role","presentation",1,"nav-item"],["id","pills-fields-tab","data-bs-toggle","pill","type","button","data-bs-target","#pills-fields","role","tab","aria-controls","pills-fields","aria-selected","true",1,"nav-link","active"],["id","pills-activities-tab","data-bs-toggle","pill","type","button","data-bs-target","#pills-activities","role","tab","aria-controls","pills-activities","aria-selected","false",1,"nav-link"],["id","pills-tabContent",1,"tab-content"],["id","pills-fields","role","tabpanel","aria-labelledby","pills-fields-tab","tabindex","0",1,"tab-pane","fade","active","show"],[1,"form",3,"formGroup"],["id","pills-activities","role","tabpanel","aria-labelledby","pills-activities-tab","tabindex","0",1,"tab-pane","fade"],[3,"activityInput"],[1,"form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],[1,"asterisk"],["type","text","formControlName","name"],[1,"text-danger"],["for","type"],["formControlName","type"],["value","CLIENTE"],["value","PROVEEDOR"],["for","mobile"],["type","text","formControlName","mobile"],["for","email"],["type","text","formControlName","email"],["for","identity"],["type","text","formControlName","identity"],["for","identityType"],["formControlName","identityType",1,"w-100"],["value","01"],["value","02"],["value","03"],["value","04"],["for","currency"],["formControlName","currency",1,"w-100"],["value","USD"],["value","CRC"],["for","defaultSeller"],[1,"muted"],["bindLabel","name","bindValue","name","placeholder","--Seleccione--","formControlName","defaultSeller",3,"items","searchable"],[1,"col-12"],["for","notes"],["formControlName","notes","rows","2"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mt-5"],["type","submit",1,"btn","btn-success"],[3,"activityChange","activityInput"]],template:function(l,r){l&1&&(e(0,"div",0),s(1,"breadcrumb",1),e(2,"div",2)(3,"div",3)(4,"h3",4),i(5,"Editar contacto"),t(),e(6,"h4",5),S("click",function(){return r.comeBackToList()}),s(7,"i",6),i(8," Regresar "),t()(),e(9,"div",7)(10,"ul",8)(11,"li",9)(12,"button",10),i(13," Formulario "),t(),e(14,"button",11),i(15," Actividades econ\xF3micas "),t()()()(),e(16,"div",12)(17,"div",13),p(18,Z,80,7,"form",14),t(),e(19,"div",15),p(20,ee,1,1,"economic-activity-select",16),t()()()()),l&2&&(c(),v("primaryText","Listado de contactos")("primaryLink","/list-clients"),c(17),u(r.editClientForm()?18:-1),c(2),u(r.editClientForm()?20:-1))},dependencies:[q,V,M,B,w,k,D,R,L,O,J,W,X,z],encapsulation:2,changeDetection:0})};export{x as default};
