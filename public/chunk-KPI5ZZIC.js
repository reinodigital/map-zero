import{a as $}from"./chunk-B2MQD4SO.js";import{a as z}from"./chunk-SVF2QQ2X.js";import{a as j}from"./chunk-QULINWIQ.js";import{b as B,c as m,d as O,e as k,h as D,k as L,n as V,o as M,p as G,q as P,t as U,u as q}from"./chunk-UQEQGUXM.js";import{k as A,p as N,r as R,v as w}from"./chunk-K4252JJD.js";import{Ba as b,Ib as n,Kb as I,La as s,Va as C,_a as d,ba as r,eb as f,ia as S,ja as _,jb as p,kb as x,mb as g,nb as F,ob as i,pb as o,qb as c,ub as T,wa as u,yb as E,zb as v}from"./chunk-QAVPLLNK.js";function H(l,t){l&1&&(i(0,"small",13),n(1," nombre debe tener m\xE1s de 2 caracteres "),o())}function J(l,t){l&1&&(i(0,"small",13),n(1," tel\xE9fono debe ser un n\xFAmero de 8 d\xEDgitos "),o())}function K(l,t){l&1&&(i(0,"small",13),n(1," formato incorrecto de correo "),o())}function Q(l,t){if(l&1&&(i(0,"option",20),n(1),o()),l&2){let e=t.$implicit;f("value",e),s(),I(" ",e," ")}}function W(l,t){if(l&1){let e=T();i(0,"form",7),E("ngSubmit",function(){S(e);let h=v();return _(h.onSubmit())}),i(1,"div",8)(2,"div",9)(3,"label",10),n(4,"Nombre "),i(5,"span",11),n(6,"*"),o()(),c(7,"input",12),d(8,H,2,0,"small",13),o(),i(9,"div",9)(10,"label",14),n(11,"Tel\xE9fono "),i(12,"span",11),n(13,"*"),o()(),c(14,"input",15),d(15,J,2,0,"small",13),o(),i(16,"div",9)(17,"label",16),n(18," Correo electr\xF3nico "),i(19,"span",11),n(20,"*"),o()(),c(21,"input",17),d(22,K,2,0,"small",13),o(),i(23,"div",9)(24,"label",18),n(25,"Rol "),i(26,"span",11),n(27,"*"),o()(),i(28,"select",19),g(29,Q,2,2,"option",20,x),o()()(),i(31,"div",21)(32,"button",22),n(33,"Editar"),o()()()}if(l&2){let e=v();f("formGroup",e.editEmployeeForm()),s(8),p(e.validField("name")?8:-1),s(7),p(e.validField("mobile")?15:-1),s(7),p(e.validField("email")?22:-1),s(7),F(e.allowedRoles)}}var y=class l{platformId=r(b);fb=r(U);commonAdminService=r($);activatedRoute=r(N);authService=r(w);formErrorService=r(z);customToastService=r(j);router=r(R);allowedRoles=["ADMIN","ADMINISTRATIVE_ASSISTANT","SELLER","ACCOUNTANT"];employeeId;employee=u(null);emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$";editEmployeeForm=u(null);get isBrowser(){return A(this.platformId)}constructor(){this.employeeId=this.activatedRoute.snapshot.params.id}ngOnInit(){this.fetchEmployeeById()}fetchEmployeeById(){this.authService.fetchOne(this.employeeId).subscribe(t=>{t&&t.uid&&(this.employee.set(t),this.fillOutForm())})}fillOutForm(){this.editEmployeeForm.set(this.fb.group({name:[this.employee()?.name??"",[m.required,m.minLength(2)]],email:[this.employee()?.email??"",[m.required,m.pattern(this.emailPattern)]],mobile:[this.employee()?.mobile??"",[m.required,m.minLength(8),m.maxLength(8)]],rol:[this.employee()?.roles[0],[m.required]]}))}validField(t){return this.editEmployeeForm().controls[t].touched&&this.editEmployeeForm().controls[t].invalid}onSubmit(){if(this.editEmployeeForm()?.invalid){this.formErrorService.throwFormErrors(this.editEmployeeForm());return}let t={};for(let e in this.editEmployeeForm()?.value)if(this.editEmployeeForm()?.value.hasOwnProperty(e)){let a=this.editEmployeeForm()?.controls[e].value;a&&(e==="rol"?t.roles=[a]:t[e]=a)}this.authService.update(this.employeeId,t).subscribe(e=>{e&&e.msg?(this.customToastService.add({message:e.msg,type:"success",duration:1e4}),this.router.navigateByUrl("/list-employees")):this.customToastService.add({message:e.message,type:"error",duration:1e4})})}comeBackToList(){this.commonAdminService.comeBackToList("/list-employees")}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=C({type:l,selectors:[["edit-employee"]],decls:9,vars:1,consts:[[1,"main_content"],[1,"box"],[1,"d-flex","justify-content-between"],[1,""],[1,"cp",3,"click"],[1,"fa-solid","fa-angles-left"],[1,"form",3,"formGroup"],[1,"form",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-12","col-sm-6","col-lg-4"],["for","name"],[1,"asterisk"],["type","text","formControlName","name"],[1,"text-danger"],["for","mobile"],["type","text","formControlName","mobile"],["for","email"],["type","text","formControlName","email"],["for","rol"],["formControlName","rol"],[3,"value"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mt-5"],["type","submit",1,"btn","btn-success"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),n(4,"Editar empleado"),o(),i(5,"h4",4),E("click",function(){return a.comeBackToList()}),c(6,"i",5),n(7," Regresar "),o()(),d(8,W,34,4,"form",6),o()()),e&2&&(s(8),p(a.editEmployeeForm()?8:-1))},dependencies:[q,D,G,P,B,M,O,k,L,V],encapsulation:2})};export{y as default};
