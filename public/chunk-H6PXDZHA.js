import{a as P}from"./chunk-GD2AIEVN.js";import{a as O}from"./chunk-7FLAGI4M.js";import{w as S}from"./chunk-G7SYGITX.js";import{a as A}from"./chunk-IETRKHQE.js";import{m as u,p as h,q as g,y as v}from"./chunk-ZUYKIS5S.js";import{X as m,ba as o,j as l,wa as b}from"./chunk-BXSYLYWC.js";var f=class n{dialog=o(S);purchaseOrderService=o(v);customToastService=o(A);_statusPurchaseOrderChange$=new l;statusPurchaseOrderChange$=this._statusPurchaseOrderChange$.asObservable();isSendEmailFromDetailComponentSubmitting=b(!1);triggerStatusChange(){this._statusPurchaseOrderChange$.next()}calculateTotalsOnDetail(e){let{subtotal:r,discounts:t,iva:a}=e.reduce((i,s)=>{let c=s.quantity*s.price,p=s.quantity*(s.price*s.discount/100),k=(c-p)*(h(s.taxRate??"08")/100);return{subtotal:i.subtotal+c,discounts:i.discounts+p,iva:i.iva+k}},{subtotal:0,discounts:0,iva:0}),d=r-t+a;return{iva:a,discounts:t,subtotal:r,total:d}}getTaxRateLabel(e){return g(e)}getStatusBadgeFromPurchaseOrder(e){let r="badge bg-label-light";switch(e){case"borrador":r="badge bg-label-light";break;case"enviada":r="badge bg-label-primary";break;case"esperando_aprobaci\xF3n":r="badge bg-label-orange";break;case"aprobada":r="badge bg-label-success";break;case"pagada":r="badge bg-label-warning";break;case"removida":r="badge bg-label-removed";break;default:break}return r}displayModalPurchaseOrderEmail(e){let r={clientName:e.client.name,currency:e.currency,deliveryInstructions:e.deliveryInstructions,total:e.total},t=this.dialog.open(P,{width:"70rem",autoFocus:!1,data:r});t.updatePosition({top:"100px"}),t.afterClosed().subscribe(a=>{if(a){this.isSendEmailFromDetailComponentSubmitting.set(!0);let d=JSON.parse(a);this.purchaseOrderService.sendEmail(e.id,d).subscribe(i=>this.processResponse(i))}})}markAsSent(e){this.purchaseOrderService.markAsSent(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}markAsAwaitingApproval(e){this.purchaseOrderService.markAsAwaitingApproval(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}markAsApproved(e){this.purchaseOrderService.markAsApproved(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}markAsBilled(e){this.purchaseOrderService.markAsBilled(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}undoMarkAsAwaitingApproval(e){this.purchaseOrderService.undoMarkAsAwaitingApproval(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}undoMarkAsApproved(e){this.purchaseOrderService.undoMarkAsApproved(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}undoMarkAsBilled(e){this.purchaseOrderService.undoMarkAsBilled(e,this.generateUpdatedAtProperty()).subscribe(r=>this.processResponse(r))}generateUpdatedAtProperty(){return{updatedAt:u(new Date)}}processResponse(e){e&&e.msg?(this.customToastService.add({message:e.msg,type:"success",duration:5e3}),this.triggerStatusChange()):this.customToastService.add({message:e.message,type:"error",duration:5e3}),this.isSendEmailFromDetailComponentSubmitting.set(!1)}removePurchaseOrder(e){let r=this.dialog.open(O,{width:"60rem",height:"20rem",autoFocus:!1,data:`Est\xE1s seguro/a de que deseas eliminar esta orden de compra ${e.purchaseOrderNumber} ?`});r.updatePosition({top:"100px"}),r.afterClosed().subscribe(t=>{t&&this.purchaseOrderService.removeOne(e.id,u(new Date)).subscribe(a=>this.processResponse(a))})}static \u0275fac=function(r){return new(r||n)};static \u0275prov=m({token:n,factory:n.\u0275fac,providedIn:"root"})};export{f as a};
