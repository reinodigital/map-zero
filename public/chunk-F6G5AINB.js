import{a as S}from"./chunk-ZXERMP2K.js";import{w as I}from"./chunk-IBKVHNU3.js";import{a as f}from"./chunk-WKFQL3IM.js";import{A as c,D as b,E as p,K as v}from"./chunk-4ZQGKSBB.js";import{X as m,ba as s,j as d,wa as g}from"./chunk-F6XVVQNR.js";var h=class r{dialog=s(I);invoiceService=s(v);customToastService=s(f);_statusChange$=new d;statusChange$=this._statusChange$.asObservable();isSendEmailFromDetailComponentSubmitting=g(!1);calculateTotalsOnDetail(t){let{subtotal:e,discounts:o,iva:i}=t.reduce((n,a)=>{let l=a.quantity*a.price,u=a.quantity*(a.price*a.discount/100),T=(l-u)*(b(a.taxRate??"08")/100);return{subtotal:n.subtotal+l,discounts:n.discounts+u,iva:n.iva+T}},{subtotal:0,discounts:0,iva:0}),C=e-o+i;return{iva:i,discounts:o,subtotal:e,total:C}}getTaxRateLabel(t){return p(t)}getStatusBadgeFromInvoice(t){let e="badge bg-label-light";switch(t){case"borrador":e="badge bg-label-light";break;case"enviada":e="badge bg-label-primary";break;case"removida":e="badge bg-label-removed";break;default:break}return e}generateUpdatedAtProperty(){return{updatedAt:c(new Date)}}processResponse(t){t&&t.msg?(this.customToastService.add({message:t.msg,type:"success",duration:5e3}),this._statusChange$.next()):this.customToastService.add({message:t.message,type:"error",duration:5e3}),this.isSendEmailFromDetailComponentSubmitting.set(!1)}removeInvoice(t){let e=this.dialog.open(S,{width:"60rem",height:"20rem",autoFocus:!1,data:`Est\xE1s seguro/a de que deseas eliminar esta factura ${t.invoiceNumber} ?`});e.updatePosition({top:"100px"}),e.afterClosed().subscribe(o=>{o&&this.invoiceService.removeOne(t.id,c(new Date)).subscribe(i=>this.processResponse(i))})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})};export{h as a};
